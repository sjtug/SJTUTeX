% \iffalse meta-comment
%
% Copyright (C) 2009-2017 by weijianwen <weijianwen@gmail.com>
%           (C) 2018-2021 by SJTUG
%
% This file may be distributed and/or modified under the
% conditions of the LaTeX Project Public License, either version 1.3c
% of this license or (at your option) any later version.
% The latest version of this license is in
%    https://www.latex-project.org/lppl.txt
% and version 1.3c or later is part of all distributions of LaTeX
% version 2005/12/01 or later.
%
% This file has the LPPL maintenance status "maintained".
%
% The Current Maintainer of this work is Alexara Wu.
%
%<*internal>
\begingroup
  \def\nameoflatex{LaTeX2e}
\expandafter\endgroup\ifx\nameoflatex\fmtname\else
\csname fi\endcsname
%</internal>
%<*install>
\input docstrip.tex
\keepsilent
\askforoverwritefalse

\preamble

Copyright (C) 2009-2017 by weijianwen <weijianwen@gmail.com>
          (C) 2018-\the\year by SJTUG

This file may be distributed and/or modified under the
conditions of the LaTeX Project Public License, either version 1.3c
of this license or (at your option) any later version.
The latest version of this license is in
    https://www.latex-project.org/lppl.txt
and version 1.3c or later is part of all distributions of LaTeX
version 2005/12/01 or later.

This file has the LPPL maintenance status "maintained".

The Current Maintainer of this work is Alexara Wu.

\endpreamble

\generate{
  \usedir{tex/latex/sjtuthesis}
    \file{\jobname.cls}               {\from{\jobname.dtx}{class}}
    \file{\jobname-undergraduate.ltx} {\from{\jobname.dtx}{undergraduate}}
    \file{\jobname-graduate.ltx}      {\from{\jobname.dtx}{graduate}}
    \file{sjtu-text-font-termes.def}  {\from{\jobname.dtx}{textfont,termes}}
    \file{sjtu-text-font-pagella.def} {\from{\jobname.dtx}{textfont,pagella}}
    \file{sjtu-text-font-lm.def}      {\from{\jobname.dtx}{textfont,lm}}
    \file{sjtu-text-font-stixtwo.def} {\from{\jobname.dtx}{textfont,stixtwo}}
    \file{sjtu-text-font-xits.def}    {\from{\jobname.dtx}{textfont,xits}}
    \file{sjtu-text-font-newcm.def}   {\from{\jobname.dtx}{textfont,newcm}}
    \file{sjtu-text-font-cambria.def} {\from{\jobname.dtx}{textfont,cambria}}
    \file{sjtu-text-font-times.def}   {\from{\jobname.dtx}{textfont,times}}
    \file{sjtu-math-font-termes.def}  {\from{\jobname.dtx}{mathfont,termes}}
    \file{sjtu-math-font-pagella.def} {\from{\jobname.dtx}{mathfont,pagella}}
    \file{sjtu-math-font-lm.def}      {\from{\jobname.dtx}{mathfont,lm}}
    \file{sjtu-math-font-stixtwo.def} {\from{\jobname.dtx}{mathfont,stixtwo}}
    \file{sjtu-math-font-xits.def}    {\from{\jobname.dtx}{mathfont,xits}}
    \file{sjtu-math-font-newcm.def}   {\from{\jobname.dtx}{mathfont,newcm}}
    \file{sjtu-math-font-cambria.def} {\from{\jobname.dtx}{mathfont,cambria}}
    \file{sjtu-cjk-font-windows.def}  {\from{\jobname.dtx}{cjkfont,windows}}
    \file{sjtu-cjk-font-mac.def}      {\from{\jobname.dtx}{cjkfont,mac}}
    \file{sjtu-cjk-font-ubuntu.def}   {\from{\jobname.dtx}{cjkfont,ubuntu}}
    \file{sjtu-cjk-font-adobe.def}    {\from{\jobname.dtx}{cjkfont,adobe}}
    \file{sjtu-cjk-font-fandol.def}   {\from{\jobname.dtx}{cjkfont,fandol}}
    \file{sjtu-cjk-font-founder.def}  {\from{\jobname.dtx}{cjkfont,founder}}
    \file{sjtudoc.cls}                {\from{\jobname.dtx}{document}}
%</install>
%<*internal>
  \usedir{source/latex/sjtuthesis}
    \file{\jobname.ins}               {\from{\jobname.dtx}{install}}
%</internal>
%<*install>
}

\Msg{* Happy TeXing!}

\endbatchfile
%</install>
%<*internal>
\fi
%</internal>
%<*driver>
\ProvidesFile{sjtuthesis.dtx}
%</driver>
%<class|document>\NeedsTeXFormat{LaTeX2e}
%<class>\ProvidesClass{sjtuthesis}
%<document>\ProvidesClass{sjtudoc}
%<undergraduate>\ProvidesFile{sjtuthesis-undergraduate.ltx}
%<graduate>\ProvidesFile{sjtuthesis-graduate.ltx}
%<class|undergraduate|graduate|document>  [2021/06/03 1.1.0rc1 Shanghai Jiao Tong University Thesis Template]
%<*textfont>
%<termes>\ProvidesFile{sjtu-text-font-termes.def}
%<termes>  [2021/06/03 1.1.0rc1 Termes text fonts definition (SJTUThesis)]
%<pagella>\ProvidesFile{sjtu-text-font-pagella.def}
%<pagella>  [2021/06/03 1.1.0rc1 Pagella text fonts definition (SJTUThesis)]
%<stixtwo>\ProvidesFile{sjtu-text-font-stixtwo.def}
%<stixtwo>  [2021/06/03 1.1.0rc1 STIX Two text fonts definition (SJTUThesis)]
%<xits>\ProvidesFile{sjtu-text-font-xits.def}
%<xits>  [2021/06/03 1.1.0rc1 XITS text fonts definition (SJTUThesis)]
%<lm>\ProvidesFile{sjtu-text-font-lm.def}
%<lm>  [2021/06/03 1.1.0rc1 Latin Modern text fonts definition (SJTUThesis)]
%<newcm>\ProvidesFile{sjtu-text-font-newcm.def}
%<newcm>  [2021/06/03 1.1.0rc1 New Computer Modern text fonts definition (SJTUThesis)]
%<cambria>\ProvidesFile{sjtu-text-font-cambria.def}
%<cambria>  [2021/06/03 1.1.0rc1 Cambria text fonts definition (SJTUThesis)]
%<times>\ProvidesFile{sjtu-text-font-times.def}
%<times>  [2021/06/03 1.1.0rc1 Times text fonts definition (SJTUThesis)]
%</textfont>
%<*mathfont>
%<termes>\ProvidesFile{sjtu-math-font-termes.def}
%<termes>  [2021/06/03 1.1.0rc1 Termes math fonts definition (SJTUThesis)]
%<pagella>\ProvidesFile{sjtu-math-font-pagella.def}
%<pagella>  [2021/06/03 1.1.0rc1 Pagella math fonts definition (SJTUThesis)]
%<stixtwo>\ProvidesFile{sjtu-math-font-stixtwo.def}
%<stixtwo>  [2021/06/03 1.1.0rc1 STIX Two math fonts definition (SJTUThesis)]
%<xits>\ProvidesFile{sjtu-math-font-xits.def}
%<xits>  [2021/06/03 1.1.0rc1 XITS math fonts definition (SJTUThesis)]
%<lm>\ProvidesFile{sjtu-math-font-lm.def}
%<lm>  [2021/06/03 1.1.0rc1 Latin Modern math fonts definition (SJTUThesis)]
%<newcm>\ProvidesFile{sjtu-math-font-newcm.def}
%<newcm>  [2021/06/03 1.1.0rc1 New Computer Modern math fonts definition (SJTUThesis)]
%<cambria>\ProvidesFile{sjtu-math-font-cambria.def}
%<cambria>  [2021/06/03 1.1.0rc1 Cambria math fonts definition (SJTUThesis)]
%</mathfont>
%<*cjkfont>
%<windows>\ProvidesFile{sjtu-cjk-font-windows.def}
%<windows>  [2021/06/03 1.1.0rc1 Windows CJK fonts definition (SJTUThesis)]
%<mac>\ProvidesFile{sjtu-cjk-font-mac.def}
%<mac>  [2021/06/03 1.1.0rc1 macOS CJK fonts definition (SJTUThesis)]
%<ubuntu>\ProvidesFile{sjtu-cjk-font-ubuntu.def}
%<ubuntu>  [2021/06/03 1.1.0rc1 Ubuntu CJK fonts definition (SJTUThesis)]
%<adobe>\ProvidesFile{sjtu-cjk-font-adobe.def}
%<adobe>  [2021/06/03 1.1.0rc1 Adobe CJK fonts definition (SJTUThesis)]
%<fandol>\ProvidesFile{sjtu-cjk-font-fandol.def}
%<fandol>  [2021/06/03 1.1.0rc1 Fandol CJK fonts definition (SJTUThesis)]
%<founder>\ProvidesFile{sjtu-cjk-font-founder.def}
%<founder>  [2021/06/03 1.1.0rc1 Founder CJK fonts definition (SJTUThesis)]
%</cjkfont>
%<*document|class>
\hyphenation{SJTU-Thesis}
\def\sjtuthesis{SJTU\textsc{Thesis}}
\def\version{1.1.0rc1}
%</document|class>
%<*driver>
\documentclass{sjtudoc}
\EnableCrossrefs
\CodelineIndex
\RecordChanges
% \OnlyDescription
\begin{document}
  \DocInput{\jobname.dtx}
  \clearpage
  \PrintChanges
  \clearpage
  \PrintIndex
\end{document}
%</driver>
% \fi
%
% \DoNotIndex{\def,\long,\edef,\xdef,\gdef,\let,\global}
% \DoNotIndex{\if,\ifnum,\ifdim,\ifcat,\ifmmode,\ifvmode,\ifhmode,%
%             \iftrue,\iffalse,\ifvoid,\ifx,\ifeof,\ifcase,\else,\or,\fi}
% \DoNotIndex{\begin,\end,\bgroup,\egroup,\begingroup,\endgroup}
% \DoNotIndex{\expandafter,\csname,\endcsname}
% \DoNotIndex{\hsize,\vsize,\hskip,\vskip,\kern,\hfil,\hfill,\hss}
% \DoNotIndex{\hspace,\vspace}
% \DoNotIndex{\p@,\m@ne,\z@,\@ne,\tw@,\@plus,\@minus}
% \DoNotIndex{\newcounter,\setcounter,\addtocounter,}
% \DoNotIndex{\newdim,\newlength,\setlength,\addtolength}
% \DoNotIndex{\newcommand,\renewcommand,\providecommand,\DeclareRobustCommand}
% \DoNotIndex{\newenvironment,\renewenvironment}
% \DoNotIndex{\RequirePackage,\LoadClass,\ProvidesClass}
% \DoNotIndex{\DeclareOption,\CurrentOption,\ExecuteOptions,\ProcessOptions}
% \DoNotIndex{\rmfamily,\sffamily,\ttfamily,\bfseries,\mdseries,\itshape,%
%             \textrm,\textsf,\texttt,\textbf,\textmd,\textit,\textsl,\textsc}
% \DoNotIndex{\iint,\iiint,\iiiint,\oint,\oiint,\oiiint,%
%             \intclockwise,\varointclockwise,\ointctrclockwise,\sumint,%
%             \intbar,\intBar,\fint,\cirfnint,\awint,\rppolint,%
%             \scpolint,\npolint,\pointint,\sqint,\intlarhk,\intx,%
%             \intcap,\intcup,\upint,\lowint}
% \DoNotIndex{\a,\b,\c,\d,\e,\f,\g,\h,\i,\j,\k,\l,%
%             \m,\n,\o,\p,\q,\r,\s,\t,\u,\v,\w,\x,\y,\z,%
%             \A,\B,\C,\D,\E,\F,\G,\H,\I,\J,\K,\L,%
%             \M,\N,\O,\P,\Q,\R,\S,\T,\U,\V,\W,\X,\Y,\Z,%
%             \do\#,\$,\%,\&,\@,\\,\{,\},\^,\_,\~,\ ,\,,\!,\',\",\/,\*,\-}
% \DoNotIndex{\quad,\par,\relax,\ccwd}
% \DoNotIndex{\bp@}
%
% \GetFileInfo{\jobname.dtx}
%
% \changes{v0.10}{2018/01/09}{项目转移至 \href{https://github.com/sjtug/SJTUThesis}{SJTUG} 名下，并增加了英文模版，修改了默认字体设置。}
% \changes{v0.9.5}{2017/01/27}{改用 GB/7714-2015 参考文献风格。}
% \changes{v0.9.4}{2016/08/25}{增加算法和流程图。}
% \changes{v0.9}{2015/06/19}{适配 \pkg{ctex} 2.x 宏包，需要使用 TeXLive 2015 编译。}
% \changes{v0.8}{2015/03/15}{使用 \pkg{biber}/\pkg{biblatex} 组合替代 \BibTeX，带来更强大稳定的参考文献处理能力；添加 \pkg{enumitem} 宏包增强列表环境控制能力；完善宏包文字描述。}
% \changes{v0.7}{2015/02/15}{增加盲审选项，调用外部工具插入扫描件。}
% \changes{v0.6.5}{2015/02/14}{修正一些小问题，缩减 git 仓库体积，仓库由 sjtu-thesis-template-latex 更名为 \sjtuthesis。}
% \changes{v0.6}{2014/12/17}{学士、硕士、博士学位论文模板合并在了一起。}
% \changes{v0.5.3}{2013/05/26}{更正 \env{subsubsection} 格式错误，这个错误导致如“1.1 小结”这样的标题没有被正确加粗。}
% \changes{v0.5.2}{2012/12/27}{更正拼写错误。在 \file{diss.tex} 加入 \file{ack.tex}。}
% \changes{v0.5.1}{2012/12/21}{在 \LaTeX{} 命令和中文字符之间留了空格，在 \file{Makefile} 中增加 release 功能。}
% \changes{v0.5}{2012/12/05}{修改说明文件的措辞，更正 \file{Makefile} 文件，使用 \pkg{metalog} 宏包替换 \pkg{xltxtra} 宏包，使用 \pkg{mathtools} 宏包替换 \pkg{amsmath} 宏包，移除了所有 CJKtilde 符号。}
% \changes{v0.4}{2012/05/30}{包含交大学士、硕士、博士学位论文模板。模板在 \href{https://github.com/weijianwen/SJTUThesis}{GitHub} 上管理和更新。}
% \changes{v0.3a}{2010/12/05}{移植到 \XeTeX/\LaTeX 上。}
% \changes{v0.2a}{2009/12/25}{模板由 \cls{CASthesis} 改名为 \cls{sjtumaster}。在 \file{diss.tex} 中可以方便地改变正文字号、切换但双面打印。增加了不编号的一章“全文总结”。添加了可伸缩符号（等号、箭头）的例子，增加了长标题换行的例子。}
% \changes{v0.1c}{2009/11/20}{增加了 Linux 下使用 \pkg{ctex} 宏包的注意事项、\file{bib} 条目的规范要求，修正了 \pkg{ctexbook} 与 \pkg{listings} 共同使用时的断页错误。}
% \changes{v0.1b}{2009/11/13}{完善了模板使用说明，增加了定理环境、并列子图、三线表格的例子。}
% \changes{v0.1a}{2009/11/12}{上海交通大学硕士学位论文 \LaTeX{} 模板发布。}
%
% \title{\bfseries\color{sjtublue}\sjtuthesis：上海交通大学学位论文模板}
% \author{\href{https://sjtug.org/}{SJTUG}}
% \date{\filedate\qquad v\fileversion}
%
% \maketitle
% \thispagestyle{empty}
% \vspace{\stretch{1}}
% \begin{center}
% \end{center}
% \vspace{\stretch{1}}
% \begin{abstract}
% 此宏包旨在建立一个简单易用的上海交通大学论文模板，包括学士、硕士、博士学位论文
% 以及普通课程论文。
% \end{abstract}
% \vspace{\stretch{1}}
% \def\abstractname{免责声明}
% \begin{abstract}
% \noindent
% \begin{enumerate}
% \item 本模板的发布遵守 \LaTeX{} Project Public License，使用前请认真阅读协议内
%   容。
% \item 本模板根据 \href{https://www.gs.sjtu.edu.cn/info/1143/5801.htm}
%   {《上海交通大学博士、硕士学位论文撰写指南》} 以及
%   \href{http://bysj.jwc.sjtu.edu.cn/shownews.aspx?newsno=C1uSkpxqiKCad13AzOcvQA....}
%   {《上海交通大学本科生毕业设计（论文）撰写规范》} 编写而成，同时参考了
%   \href{http://jdgs.sjtu.edu.cn/uploads/%E5%AD%A6%E4%BD%8D%E8%AE%BA%E6%96%87-%E7%AD%94%E8%BE%A9%E7%94%B3%E8%AF%B7%E6%B5%81%E7%A8%8B/11%E5%AD%A6%E4%BD%8D%E8%AE%BA%E6%96%87%E6%A0%BC%E5%BC%8F%E7%9A%84%E7%BB%9F%E4%B8%80%E8%A6%81%E6%B1%82.docx}
%   {《上海交通大学研究生学位论文格式的统一要求》}。旨在供上海交通大学准毕业生撰
%   写学位论文使用。
% \item 此模板仅为撰写指南的参考实现，不保证审查老师不提意见。任何由于使用本模板
%   而引起的论文格式审查问题均与本模板作者无关。
% \item 任何个人或组织以本模板为基础进行修改、扩展而生成的新的专用模板，请严格遵
%   守 \LaTeX{} Project Public License 协议。由于违犯协议而引起的任何纠纷争端均与
%   本模板作者无关。
% \end{enumerate}
% \end{abstract}
% \vspace{\stretch{3}}
%
% \clearpage
% \begin{multicols}{2}[
%   \setlength{\columnseprule}{.4pt}
%   \setlength{\columnsep}{18pt}]
%   \tableofcontents
% \end{multicols}
% \clearpage
%
% \section{介绍}
%
% 这是为撰写上海交通大学学士、硕士、博士学位论文以及课程论文而准备的 \LaTeX{} 模
% 板。
%
% 最早的一版学位模板由一位热心的物理系同学制作，中文字符处理采用了当时最为流行的
% \CJKLaTeX{} 方案。在此基础上，weijianwen 根据交大研究生院对学位论文的要求，完成
% 了一份基本可用的交大 \LaTeX{} 学位论文模板。由于 \CJKLaTeX{} 方案不易使用，
% weijianwen 与 William Wang 开始着手把模板向\XeTeX{} 引擎移植。之后 weijianwen
% 又断断续续做了一些完善模板的工作，在原有硕士学位论文模板的基础上完成了交大学士
% 和博士学位论文模板。
%
% 2012 年 5 月模板开始在 GitHub 上管理和更新，2018 年 1 月项目转移至 SJTUG 名
% 下。2019 年 6 月 Alexara Wu 重构了整个宏包的代码，并使用 doc 和 DocStrip 工具
% 进行代码的管理，升级版本号为 1.0。
%
% \note{模板的作用在于减少论文写作过程中格式调整的时间，前提是遵守模板的用法，否
%   则即便用了\sjtuthesis 也难以保证输出的论文符合学校规范。}
%
% \section{简明教程}
%
% \subsection{文件组成}
%
% 表~\ref{tab:files} 列出了 \sjtuthesis 的主要文件及其功能介绍。
%
% \begin{table}[!hbt]
%   \centering
%   \caption{模板的文件组成}
%   \label{tab:files}
%   \begin{tabular}{l|l|p{4cm}}
%     \toprule
%     \strong{类别} & \strong{文件}               & \strong{说明}     \\
%     \midrule
%     文档类        & \file{sjtuthesis.cls}       & 文档类文件        \\
%                   & \file{sjtuthesis-*.ltx}     & 文档类辅助文件    \\
%     \midrule
%     视觉系统      & \file{sjtu-vi-logo-*.pdf}   & 校标图片          \\
%                   & \file{sjtu-vi-badge-*.pdf}  & 校徽图片          \\
%                   & \file{sjtu-vi-name-*.pdf}   & 校名图片          \\
%     \midrule
%     字体配置文件   & \file{sjtu-cjk-font-*.def}    & 中文字体配置 \\
%                  & \file{sjtu-math-font-*.def}   &  数学字体配置 \\
%                  & \file{sjtu-text-font-*.def}   &  正文字体配置 \\
%
%     \bottomrule
%   \end{tabular}
% \end{table}
%
% \subsection{获取 \sjtuthesis}
%
% 你可以在 \href{https://github.com/sjtug/SJTUThesis/releases}{GitHub Release}
% 中找到 \sjtuthesis 的所有版本，推荐使用最新版本以避免一些问题。
%
% \subsection{使用 \sjtuthesis 文档类}
% \label{ssec:usage}
%
% 以下是一份简单的 \TeX{} 文档，它演示了 \sjtuthesis{} 的最基本用法。
% 注意在使用文档类时，需要将涉及到的所有源文件使用 UTF-8 编码保存。
%
% \begin{latex}
% % main.tex
% \documentclass{sjtuthesis}
% \begin{document}
%   \maketitle
%   \frontmatter
%   \mainmatter
%   \chapter{欢迎}
%   \section{欢迎使用 \sjtuthesis}
%   你好，\LaTeX{}!
% \end{document}
% \end{latex}
%
% 按照 \ref{ssec:compile} 小节中的方式编译该文档，您应当得到一篇 5 页的文章。
% 当然，这篇文章的绝大 部分都是空白的。
%
% \subsection{编译方式}
% \label{ssec:compile}
%
% 推荐使用 \XeLaTeX{} 引擎编译本模板，也可以使用 \LuaLaTeX{} 引擎。
% 很多用户对 \LaTeX{} 命令执行的次数不太清楚。一个基本的原则是多次运行 \LaTeX{}
% 命令直至不再出现警告。
%
% 假设您的 \TeX{} 源文件名为 \file{main.tex}，并且使用 \texttt{biber} 作为管理引
% 用文献的后端程序。下面给出编译论文的详细过程（\# 开头的行为注释）：
%
% \begin{shell}
% # 1.发现文件中的引用关系，文件后缀 .tex 可省略
% xelatex main
% # 2.编译参考文件源文件，生成 .bbl 文件
% biber main
% # 3.解决文件中的交叉引用
% xelatex main
% # 4.生成完整的 pdf 文件
% xelatex main
% # 5.更新目录
% xelatex main
% \end{shell}
%
% 手动逐步编译的方式比较繁琐，而且容易出错。推荐使用自动工具 \texttt{latexmk}。
% \texttt{latexmk} 命令支持全自动生成 \LaTeX{} 编写的文档，并且支持使用不同的工
% 具链来进行生成，它会自动运行多次工具直到交叉引用都被解决。
%
% \begin{shell}
% # 一条命令就够了！
% latexmk -xelatex thesis
% \end{shell}
%
% \subsection{模板选项}
% \label{ssec:options}
%
% 所谓“模板选项”，指需要在引入文档类的时候指定的选项:
%
% \begin{latex}
% \documentclass(*\oarg{模板选项}*){sjtuthesis}
% \end{latex}
%
% 部分选项采用 \kvopt{\meta{key}}{\meta{value}} 的形式。当 \meta{value} 省略时，
% 将采用默认值。在下文的说明中，将用\textbf{粗体}表示默认值。
%
% \pagebreak
%
% \subsubsection{通用选项}
%
% \DescribeFunction{type}
%   \begin{sjtusyntax}[emph={[1]type}]
%     type = (*<(doctor)|master|bachelor|course>*)
%   \end{sjtusyntax}
% 论文类型。四种选项分别代表博士学位论文、硕士学位论文、本科毕业论文和课程论
% 文。
%
% \DescribeFunction{lang}
%   \begin{sjtusyntax}[emph={[1]lang}]
%     lang = (*<(zh)|en>*)
%   \end{sjtusyntax}
% 论文主要语言。可选中文或英文，该选项会改变文档中的一些标题的名字。
%
% \DescribeFunction{zihao}
%   \begin{sjtusyntax}[emph={[1]zihao}]
%     zihao = (*<-4|5|(auto)|false>*)
%   \end{sjtusyntax}
% 论文默认字号。默认为 \opt{auto}，将根据论文类型自动设置研究生为小四号或本科生
% 为五号。
%
% \DescribeFunction{review}
% 盲审模式开关。开启盲审模式将隐去作者姓名、导师姓名、班级、学号等个人信息，
% 删去版权使用授权书、原创性声明和致谢页。默认关闭。
%
% \DescribeFunction{oneside, twoside}
% 指明论文的单双面模式，默认为 \opt{twoside}。
%
% \DescribeFunction{openright, openany}
% 指明论文章节的开始页，可以改为 \opt{openright} 从奇数页开始，默认为 \opt{openany} 从任意页开始。
%
% \subsubsection{额外宏包选项}
%
% \DescribeFunction{unimath}
% 是否使用 \pkg{unicode-math}，默认不使用。
%
% \DescribeFunction{nothm}
% 是否取消预设的定理环境。默认不取消，以采用
% \sjtuthesis 预定义的一系列数学环境。在启用 \pkg{ntheorem} 或 \pkg{amsthm}
% 宏包后有效。
%
% \begin{center}\small
% \begin{tabular}{*{7}{l}}\toprule
%   assumption  & axiom   & conjecture & corollary    & definition  & example   & exercise  \\
%   假设        & 公理    & 猜想       & 推论         & 定义        & 例        & 练习      \\\midrule
%   lemma       & problem & proof      & proposition  & remark      & solution  & theorem   \\
%   引理        & 问题    & 证明       & 命题         & 注          & 解        & 定理      \\\bottomrule
% \end{tabular}
% \end{center}
%
% \subsubsection{字体选项}
%
% \DescribeFunction{cjk-font}
%   \begin{sjtusyntax}[emph={[1]cjk-font}]
%     cjk-font = (*<(auto)|(fandol)|windows|mac|ubuntu|adobe|founder|none>*)
%   \end{sjtusyntax}
% 指定中文字体集。\sjtuthesis 预定义了一些中文字体组合。默认为 \opt{auto}，跟随操作系统设定。找不到对应定义的中文字体集时的回退选项为 \opt{fandol}。
%
% \note{不再支持使用 \opt{fontset} 指定字体集。
% Linux 系统下默认的中文字库 \opt{fandol} 容易出现缺字的情况。
% 我们建议 Linux 用户自行配置合适的字体。}
%
% \DescribeFunction{text-font}
%   \begin{sjtusyntax}[emph={[1]text-font}]
%     text-font = (*<(termes)|times|stixtwo|xits|pagella|cambria|newcm|lm|none>*)
%   \end{sjtusyntax}
% 指定西文字体集。\sjtuthesis 预定义了一些西文字体组合，具体配置见表 \ref{tab:latinfont}。
%
% \DescribeFunction{math-font}
%   \begin{sjtusyntax}[emph={[1]math-font}]
%     math-font = (*<(auto)|(termes)|stixtwo|xits|pagella|cambria|newcm|lm|none>*)
%   \end{sjtusyntax}
% 指定数学字体集。\sjtuthesis 预定义了一些数学字体组合，具体配置见表 \ref{tab:latinfont} 数学字体列。
% 默认为 \opt{auto} 以跟随 \opt{text-font} 的设置。
% 找不到定义的数学字体集时的回退选项为 \opt{termes}。
%
% 请注意加载 \opt{stixtwo}，\opt{xits}，\opt{newcm}，\opt{cambria} 数学字体时
% 会自动加载 \pkg{unicode-math} 宏包，强制将 \opt{unimath} 开启。
%
% \begin{table}[ht]
% \centering\small
% \begin{threeparttable}
%   \caption{西文字体与数学字体配置}
%   \label{tab:latinfont}
%   \begin{tabular}{ccccc}
%     \toprule
%       & \strong{正文字体} & \strong{无衬线字体} & \strong{等宽字体} & \strong{数学字体} \\
%     \midrule
%       |termes|          & TG Termes\tnote{a}  & TG Heros        & TG Cursor        & TG Termes Math  \\
%       |times|\tnote{b}  & Times New Roman     & Arial           & Courier New      & TG Termes Math       \\
%       |stixtwo|            & STIX Two Text       & Source Sans Pro & Source Code Pro  & STIX Two Math   \\
%       |xits|            & XITS                & Source Sans Pro & Source Code Pro  & XITS Math       \\
%       |pagella|         & TG Pagella          & TG Heros        & TG Cursor        & TG Pagella Math \\
%       |cambria|         & Cambria             & Calibri         & Consolas         & Cambria Math    \\
%       |newcm|           & New CM\tnote{c} & New CM Sans        & New CM Mono         & New CM \\
%       |lm|              & LM Roman            & LM Sans         & LM Mono          & LM Math         \\
%     \bottomrule
%   \end{tabular}
%   \begin{tablenotes}
%     \item[a] “TG”是 TeX Gyre 的缩写。
%     \item[b] 本行中，Times New Roman、Arial 和 Courier New 是商业字体，
%       在 Windows 和 macOS 系统上均默认安装。
%     \item[b] “LM”是 Latin Modern 的缩写。
%     \item[c] “CM”是 Computer Modern 的缩写。
%   \end{tablenotes}
% \end{threeparttable}
% \end{table}
%
% \subsection{参数设置}
%
% \DescribeFunction{\sjtusetup}
%   \begin{sjtusyntax}[morekeywords={\sjtusetup}]
%     \sjtusetup(*\marg{键值列表}*)
%   \end{sjtusyntax}
% 本模板提供了一系列选项，可由您自行配置。载入文档类之后，以下
% 所有选项均可通过统一的命令 \cs{sjtusetup} 来设置。
%
% \cs{sjtusetup} 的参数是一组由（英文）逗号隔开的选项列表，列表中的选项通常是
% \kvopt{\meta{key}}{\meta{value}} 的形式。对于同一项，后面的设置将会覆盖前面的
% 设置。在下文的说明中，将用\textbf{粗体}表示默认值。\cs{sjtusetup} 支持不同类型
% 以及多种层次的选项设定。键值列表中，“|=|”左右的空格不影响设置；但需注意，参数
% 列表中不可以出现空行。
%
% \begin{latex}[morekeywords={\sjtusetup}]
% \sjtusetup{
%   info = {
%     title             = {上海交通大学学位论文 \LaTeX{} 模板示例文档},
%     title*            = {A Sample Document for \LaTeX-based SJTU Thesis Template},
%     author            = {某\quad{}某},
%     author*           = {Mo Mo},
%   },
%   style = {
%     header-logo-color = red,
%   }
% }
% \end{latex}
%
% \subsubsection{论文格式}
%
% \DescribeFunction{style}
%   \begin{sjtusyntax}[emph={[1]style}]
%     style = (*\marg{键值列表}*)
%   \end{sjtusyntax}
% 该选项包含许多子项目，用于设置论文格式。具体内容见下。
%
% \DescribeFunction{frontmatter-numbering}
%   \begin{sjtusyntax}[emph={[2]frontmatter-numbering}]
%     frontmatter-numbering = (*<true|false>*)
%   \end{sjtusyntax}
% 选择前文内容是否编号。学士论文默认为 \opt{false}，其余默认为 \opt{true}。
%
% \DescribeFunction{indent-headings}
%   \begin{sjtusyntax}[emph={[2]indent-headings}]
%     indent-headings =  (*<fixed|auto|false>*)
%   \end{sjtusyntax}
% 选择节标题是否缩进。\opt{fixed} 将使用统一的段首缩进 \cs{parindent}；
% \opt{auto} 会缩进两个字，具体距离和字体大小有关；\opt{false} 不缩进。
% 学士论文默认为 \opt{fixed}，其余默认为 \opt{false}。
%
% \DescribeFunction{header}
%   \begin{sjtusyntax}[emph={[2]header}]
%     header = (*<(single)|double>*)
%   \end{sjtusyntax}
% 选择研究生论文页眉风格。
%
% \DescribeFunction{title-logo-color}
%   \begin{sjtusyntax}[emph={[2]title-logo-color}]
%     title-logo-color = (*<red|(blue)|black>*)
%   \end{sjtusyntax}
% 选择本科论文标题页中的校名、校徽的颜色。
%
% \DescribeFunction{header-logo-color}
%   \begin{sjtusyntax}[emph={[2]header-logo-color}]
%     header-logo-color = (*<red|blue|(black)>*)
%   \end{sjtusyntax}
% 选择本科论文页眉中的校标颜色。
%
% \DescribeFunction{float-number-separator}
%   \begin{sjtusyntax}[emph={[2]float-number-separator}]
%     float-number-separator = (*\marg{分隔符}*)
%   \end{sjtusyntax}
% 图、表等浮动体编号中的分隔符。
%
% \DescribeFunction{equation-number-separator}
%   \begin{sjtusyntax}[emph={[2]equation-number-separator}]
%     equation-number-separator = (*\marg{分隔符}*)
%   \end{sjtusyntax}
% 公式编号中的分隔符。
%
% \DescribeFunction{footnote}
%   \begin{sjtusyntax}[emph={[2]footnote}]
%     footnote = (*<indent|(hang)>*)
%   \end{sjtusyntax}
% 脚注的缩进风格。使用 \opt{indent} 段首缩进（第一行缩进两中文字）
% 还是 \opt{hang} 悬挂缩进（除首行外缩进 1.5 字符）。
% 默认为悬挂缩进。
%
% \subsubsection{信息录入}
%
% \DescribeFunction{info}
%   \begin{sjtusyntax}[emph={[1]info}]
%     info = (*\marg{键值列表}*)
%   \end{sjtusyntax}
% 该选项包含许多子项目，用于录入论文信息。
% 具体内容见下。以下带“*”的项目表示对应的英文字段。
%
% \DescribeFunction{title}
% \DescribeFunction{title*}
%   \vspace{-1ex}
%   \begin{sjtusyntax}[emph={[2]title,title*}]
%     title  = (*\marg{中文标题}*)
%     title* = (*\marg{英文标题}*)
%   \end{sjtusyntax}
% 论文标题。如果您的标题过长，建议使用“|\\|”手动断行。
%
% \DescribeFunction{display-title}
% \DescribeFunction{display-title*}
%   \vspace{-1ex}
%   \begin{sjtusyntax}[emph={[2]display-title,display-title*}]
%     display-title  = (*\marg{中文标题页标题}*)
%     display-title* = (*\marg{英文标题页标题}*)
%   \end{sjtusyntax}
% 标题页论文中题目。默认为跟随对应语言的论文标题。
%
% \DescribeFunction{running-title}
% \DescribeFunction{running-title*}
%   \vspace{-1ex}
%   \begin{sjtusyntax}[emph={[2]running-title,running-title*}]
%     running-title  = (*\marg{中文页眉标题}*)
%     running-title* = (*\marg{英文页眉标题}*)
%   \end{sjtusyntax}
% 论文页眉题目。默认为跟随对应语言的论文标题。
%
% \DescribeFunction{keywords}
% \DescribeFunction{keywords*}
%   \vspace{-1ex}
%   \begin{sjtusyntax}[emph={[2]keywords,keywords*}]
%     keywords  = (*\marg{中文关键字}*)
%     keywords* = (*\marg{英文关键字}*)
%   \end{sjtusyntax}
% 关键字列表。各关键字之间需使用英文逗号隔开。
% 为防止歧义，可以用分组括号“|{...}|”把各字段括起来。
%
% \DescribeFunction{author}
% \DescribeFunction{author*}
%   \vspace{-1ex}
%   \begin{sjtusyntax}[emph={[2]author,author*}]
%     author  = (*\marg{姓名}*)
%     author* = (*\marg{英文姓名或拼音}*)
%   \end{sjtusyntax}
% 作者姓名。
%
% \DescribeFunction{id}
%   \begin{sjtusyntax}[emph={[2]id}]
%     id  = (*\marg{学号}*)
%   \end{sjtusyntax}
% 学号。
%
% \DescribeFunction{supervisor}
% \DescribeFunction{supervisor*}
% \DescribeFunction{assisupervisor}
% \DescribeFunction{assisupervisor*}
%   \vspace{-3ex}
%   \begin{sjtusyntax}[emph={[2]supervisor,supervisor*,assisupervisor,assisupervisor*}]
%     supervisor      = (*\marg{姓名}*)
%     supervisor*     = (*\marg{英文姓名或拼音}*)
%     assisupervisor  = (*\marg{姓名}*)
%     assisupervisor* = (*\marg{英文姓名或拼音}*)
%   \end{sjtusyntax}
% 导师、副导师姓名。
%
% \DescribeFunction{degree}
% \DescribeFunction{degree*}
%   \vspace{-1ex}
%   \begin{sjtusyntax}[emph={[2]degree,degree*}]
%     degree  = (*\marg{学位中文名称}*)
%     degree* = (*\marg{学位英文名称}*)
%   \end{sjtusyntax}
% 申请学位中英文名称。
%
% \DescribeFunction{department}
% \DescribeFunction{department*}
%   \vspace{-1ex}
%   \begin{sjtusyntax}[emph={[2]department,department*}]
%     department  = (*\marg{院系中文名称}*)
%     department* = (*\marg{院系英文名称}*)
%   \end{sjtusyntax}
% 院系中英文名称。
%
% \DescribeFunction{major}
% \DescribeFunction{major*}
%   \vspace{-1ex}
%   \begin{sjtusyntax}[emph={[2]major,major*}]
%     major  = (*\marg{专业中文名称}*)
%     major* = (*\marg{专业英文名称}*)
%   \end{sjtusyntax}
% 专业中英文名称。
%
% \DescribeFunction{course}
% \DescribeFunction{course*}
%   \vspace{-1ex}
%   \begin{sjtusyntax}[emph={[2]course,course*}]
%     course  = (*\marg{课程中文名称}*)
%     course* = (*\marg{课程英文名称}*)
%   \end{sjtusyntax}
% 课程中英文名称。仅课程论文有效。
%
% \DescribeFunction{fund}
% \DescribeFunction{fund*}
%   \vspace{-1ex}
%   \begin{sjtusyntax}[emph={[2]fund,fund*}]
%     fund  = (*\marg{资助基金中文名称}*)
%     fund* = (*\marg{资助基金英文名称}*)
%   \end{sjtusyntax}
% 资助基金列表。各资助基金名称之间需使用英文逗号隔开。
% 为防止歧义，可以用分组括号“|{...}|”把各字段括起来。
%
% \DescribeFunction{date}
%   \begin{sjtusyntax}[emph={[2]date}]
%     date  = (*\marg{日期}*)
%   \end{sjtusyntax}
% 答辩日期。默认值为文档编译日期。也可以自己指定，要求使用 ISO 格式，
% 即 |yyyy-mm-dd|。
%
% \subsubsection{设置名称}
%
% \DescribeFunction{name}
%   \begin{sjtusyntax}[emph={[1]name}]
%     name = (*\marg{键值列表}*)
%   \end{sjtusyntax}
% 该选项包含许多子项目，用于设置论文中一些标题的名称。
% 具体内容见表 \ref{tab:names}。
%
% \begin{table}[!hbt]
%   \centering\small
%   \caption{\opt{name} 选项的默认设置}
%   \label{tab:names}
%   \begin{tabular}{l|l|l}
%     \toprule
%     \strong{选项} & \strong{|lang = zh|} & \strong{|lang = en|} \\
%     \midrule
%      |appendix|         & 附录                                  & Appendix              \\
%      |contents|         & 目|\hspace{\ccwd}|录                  & Contents              \\
%      |listfigure|       & 插图索引                              & List of Figures       \\
%      |listtable|        & 表格索引                              & List of Tables        \\
%      |listalgorithm|    & 算法索引                              & List of Algorithms    \\
%      |figure|           & 图                                    & Figure                \\
%      |figure*|          & Figure                                & 图                    \\
%      |table|            & 表                                    & Table                 \\
%      |table*|           & Table                                 & 表                    \\
%      |algorithm|        & 算法                                  & Algorithm             \\
%      |nom|              & 主要符号对照表                        & Nomenclature          \\
%      |summary|          & 全文总结                              & Summary               \\
%      |bib|              & 参考文献                              & Bibliography          \\
%      |index|            & 索|\hspace{\ccwd}|引                  & Index                 \\
%      |ack|              & 致|\hspace{\ccwd}|谢                  & Acknowledgements      \\
%      |achv|             & 学术论文和科研成果目录                & Research Achievements \\
%      |resume|           & 个人简历                              & Resume                \\
%     \bottomrule
%   \end{tabular}
% \end{table}
%
% \subsection{内容编写}
%
% \subsubsection{标题页和声明页}
%
% \DescribeFunction{\maketitle}
% 生成标题页。
%
% \DescribeFunction{\copyrightpage}
%   \begin{sjtusyntax}[morekeywords={\copyrightpage}]
%     \copyrightpage
%     \copyrightpage(*\oarg{授权书扫描件}*)
%   \end{sjtusyntax}
% 生成空白版权使用授权书。
% 接受一个可选参数用于插入版权使用授权书扫描件。
%
% \subsubsection{前文部分}
%
% \DescribeFunction{\frontmatter}
% 声明前文部分开始。
%
% \DescribeFunction{abstract}
% \DescribeFunction{abstract*}
%   \vspace{-1ex}
%   \begin{sjtusyntax}[emph={[2]abstract,abstract*}]
%     \begin{abstract}
%       (*\meta{中文摘要}*)
%     \end{abstract}
%     \begin{abstract*}
%       (*\meta{英文摘要}*)
%     \end{abstract*}
%   \end{sjtusyntax}
% 摘要环境。不带星号和带星号的版本分别用来输入中文摘要和英文摘要。
%
% \DescribeFunction{\tableofcontents}
% \DescribeFunction{\listoffigures}
% \DescribeFunction{\listoffigures*}
% \DescribeFunction{\listoftables}
% \DescribeFunction{\listoftables*}
% \DescribeFunction{\listofalgorithms}
% \DescribeFunction{\listofalgorithms*}
% \vspace{-10ex}
% \begin{table}[ht]
% \centering\small
% \begin{threeparttable}
%   \caption{目录和索引表}
%   \label{tab:list}
%   \begin{tabular}{lp{4cm}}
%     \toprule
%     \strong{用途}     & \strong{命令}          \\\midrule
%     目录              & \cs{tableofcontents}   \\\midrule
%     插图索引          & \cs{listoffigures}     \\
%                       & \cs{listoffigures*}    \\\midrule
%     表格索引          & \cs{listoftables}      \\
%                       & \cs{listoftables*}     \\\midrule
%     算法索引\tnote{a} & \cs{listofalgorithms}  \\
%                       & \cs{listofalgorithms*} \\
%     \bottomrule
%   \end{tabular}
%   \begin{tablenotes}
%     \item[a] 启用 \pkg{algorithm2e} 或 \pkg{algorithm} 后有效。
%   \end{tablenotes}
% \end{threeparttable}
% \end{table}
%
% 目录、插图、表格和算法等索引命令如表 \ref{tab:list} 所示，将其插入到期望的
% 位置即可。带*的命令表示对应的索引表不会出现在目录中。
%
% \DescribeFunction{nomenclature}
% \DescribeFunction{nomenclature*}
%   \vspace{-1ex}
%   \begin{sjtusyntax}[emph={[2]nomenclature,nomenclature*}]
%     \begin{nomenclature}
%       (*\meta{符号对照表}*)
%     \end{nomenclature}
%   \end{sjtusyntax}
% 符号对照表环境。带星号的版本不会出现在目录中。
% 符号对照表环境仅设置标题，内部实现可由用户自行决定。
% 可以使用 \pkg{longtable}，也可以使用 \pkg{nomencl} 宏包。
%
% \subsubsection{正文部分}
%
% \DescribeFunction{\mainmatter}
% 声明正文部分开始。正文部分是论文的核心，您可以分章节撰写。
% 如有需求，也可以采用多文件编译的方式。
%
% \DescribeFunction{\footnote}
%   \begin{sjtusyntax}[morekeywords={\footnote}]
%     \footnote(*\oarg{脚注文字}*)
%   \end{sjtusyntax}
% 插入脚注。编号采用中文字体的带圈数字，只支持 1 到 10 号，请保证每页脚注
% 不超过 10 个。
%
% \DescribeFunction{\SJTUunsetfloatfontsize}
% \DescribeFunction{\SJTUsetfloatfontsize}
% 按学校要求图表内使用五号字体，不受正文环境影响。\vspace{-1ex}
% 可在文中使用 \cs{SJTUunsetfloatfontsize} 取消此默认设置，
% 或者使用 \cs{SJTUsetfloatfontsize} 恢复此默认设置。\vspace{1ex}
%
% \DescribeFunction{\appendix}
%   \begin{sjtusyntax}[morekeywords={\appendix}]
%     \appendix
%     \chapter{...}
%   \end{sjtusyntax}
% 附录由 \cs{appendix} 命令开启，然后像正文一样书写。
%
% \subsubsection{后文部分}
%
% \DescribeFunction{\backmatter}
% 声明后文部分开始。 后文部分包含参考文献、致谢等。
%
% \DescribeFunction{acknowledgements}
%   \begin{sjtusyntax}[emph={[2]acknowledgements}]
%     \begin{acknowledgements}
%       (*\meta{致谢内容}*)
%     \end{acknowledgements}
%   \end{sjtusyntax}
% 致谢环境。盲审模式下致谢将被隐去。
%
% \DescribeFunction{achievements}
% \DescribeFunction{achievements*}
%   \vspace{-1ex}
%   \begin{sjtusyntax}[emph={[2]achievements,achievements*}]
%     \begin{achievements}
%       \item (*\meta{获得的科研成果}*)
%     \end{achievements}
%     \begin{achievements*}
%       \item (*\meta{获得的科研成果（隐去姓名）}*)
%     \end{achievements*}
%   \end{sjtusyntax}
% 科研成果环境。普通模式下显示不带星号的版本中的内容，
% 盲审模式下显示带星号的版本中的内容。
%
% \DescribeFunction{resume}
%   \begin{sjtusyntax}[emph={[2]resume}]
%     \begin{resume}
%       (*\meta{简历内容}*)
%     \end{resume}
%   \end{sjtusyntax}
% 简历环境。盲审模式下简历将被隐去。
%
% \DescribeFunction{digest}
%   \begin{sjtusyntax}[emph={[2]digest}]
%     \begin{digest}
%       (*\meta{大摘要}*)
%     \end{digest}
%   \end{sjtusyntax}
% 学士论文大摘要。仅在语言设置为中文，论文类型为学士论文的条件下有效。
%
% \section{致谢}
%
% \sjtuthesis 模板的许多实现细节离不开 \href{https://github.com/sjtug/SJTUThesis/graphs/contributors}
%  {热心同学们} 的贡献，在此感谢所有为模板贡献过代码的同学们, 以及所有测试和使用
% 模板的各位同学！
%
% \section{实现细节}
%
% 报错和警告命令。
%    \begin{macrocode}
%<*class>
\newcommand\sjtu@error[1]{%
  \ClassError{sjtuthesis}{#1}{}%
}
\newcommand\sjtu@warning[1]{%
  \ClassWarning{sjtuthesis}{#1}{}%
}
%    \end{macrocode}
%
% 检查编译引擎，要求使用 \XeLaTeX 或 \LuaLaTeX。
%    \begin{macrocode}
\RequirePackage{iftex}
\ifXeTeX\else
  \ifLuaTeX\else
    \sjtu@error{%
      The SJTUThesis class requires either XeTeX or LuaTeX.\\\\
      You must change your typesetting engine to, e.g.,
      "xelatex" or "lualatex" instead of "latex" or "pdflatex".
    }
  \fi
\fi
%    \end{macrocode}
%
% \subsection{定义文档选项}
%
%    \begin{macrocode}
\RequirePackage{kvdefinekeys}
\RequirePackage{kvsetkeys}
\RequirePackage{kvoptions}
\SetupKeyvalOptions{
  family=sjtu,
  prefix=sjtu@,
  setkeys=\kvsetkeys}
%    \end{macrocode}
%
% \begin{macro}{\sjtusetup}
% 提供一个 \cs{sjtusetup} 命令支持 \emph{key-value} 的方式来设置。
%    \begin{macrocode}
\newcommand\sjtusetup[1]{%
  \kvsetkeys{sjtu}{#1}%
}
%    \end{macrocode}
% \end{macro}
%
% 同时用 \emph{key-value} 的方式来定义这些接口：
% \begin{latex}
%   \sjtu@define@key{<family>}{
%     <key> = {
%       name = <name>,
%       choices = {
%         <choice1>,
%         <choice2>,
%       },
%       initial = <initial>,
%       default = <default>,
%     },
%   }
% \end{latex}
%
% 其中 |choices| 设置允许使用的值；
% \meta{initial} 是选项的初始值，默认为 |choices| 第一个；
% \meta{default} 是选项的默认值，默认为 \meta{initial}；
% \meta{code} 是相应的内容被设置时执行的代码。
%
%    \begin{macrocode}
\newcommand\sjtu@define@key[2]{%
  \kvsetkeys{#1@key}{#2}%
}
\newcommand\sjtu@set@family@handler[1]{%
  \kv@set@family@handler{#1@key}{%
%    \end{macrocode}
%
% |initial| 是定义该 \meta{key} 时的初始值，缺省为空。
%
%    \begin{macrocode}
    \def\sjtu@@initial{}%
    \def\sjtu@@choices{}%
    \@namedef{#1@##1@@default}{}%
    \@namedef{#1@##1@@check}{}%
    \@namedef{#1@##1@@code}{}%
%    \end{macrocode}
%
% \cs{sjtusetup} 会将 \meta{value} 存到 \cs{\meta{family}@\meta{key}}，
% 但是宏的名字包含 “-” 这样的特殊字符时不方便直接调用，比如 |key = math-style|，
% 这时可以用 |name| 设置 \meta{key} 的别称，比如 |key = math@style|，
% 这样就可以通过 \cs{\meta{family}@math@style} 来引用。
%
%    \begin{macrocode}
    \@namedef{#1@##1@@name}{##1}%
    \kv@define@key{#1@value}{name}{%
      \@namedef{#1@##1@@name}{####1}%
    }%
%    \end{macrocode}
%
% 保存下 |choices = {}| 定义的内容，在定义 \cs{\meta{family}@\meta{name}} 后再执行。
%
%    \begin{macrocode}
    \kv@define@key{#1@value}{choices}{%
      \def\sjtu@@choices{####1}%
      \@namedef{#1@##1@@reset}{}%
%    \end{macrocode}
%
% \cs{\meta{family}@\meta{key}@check} 检查 |value| 是否有效，
% 并设置 \cs{if\meta{family}@\meta{name}@\meta{value}}。
%
%    \begin{macrocode}
      \@namedef{#1@##1@@check}{%
        \@ifundefined{%
          if#1@\@nameuse{#1@##1@@name}@\@nameuse{#1@\@nameuse{#1@##1@@name}}%
        }{%
          \sjtu@error{Invalid value `##1 = \@nameuse{#1@\@nameuse{#1@##1@@name}}'}%
        }%
        \@nameuse{#1@##1@@reset}%
        \@nameuse{#1@\@nameuse{#1@##1@@name}@\@nameuse{#1@\@nameuse{#1@##1@@name}}true}%
      }%
    }%
    \kv@define@key{#1@value}{initial}{%
      \def\sjtu@@initial{####1}%
      \expandafter\ifx\csname #1@##1@@default\endcsname\@empty
        \@namedef{#1@##1@@default}{####1}%
      \fi
    }%
    \kv@define@key{#1@value}{default}{%
      \@namedef{#1@##1@@default}{####1}%
    }%
    \kvsetkeys{#1@value}{##2}%
    \@namedef{#1@\@nameuse{#1@##1@@name}}{}%
%    \end{macrocode}
%
% 第一个 \meta{choice} 设为 \meta{initial}，
% 若 \meta{default} 为定义，则设置为 \meta{initial}，
% 并且对每个 \meta{choice} 定义 \cs{if\meta{family}@\meta{name}@\meta{choice}}。
%
%    \begin{macrocode}
    \kv@set@family@handler{#1@choice}{%
      \ifx\sjtu@@initial\@empty
        \def\sjtu@@initial{####1}%
      \fi
      \expandafter\ifx\csname #1@##1@@default\endcsname\@empty
        \@namedef{#1@##1@@default}{####1}%
      \fi
      \expandafter\newif\csname if#1@\@nameuse{#1@##1@@name}@####1\endcsname
      \expandafter\g@addto@macro\csname #1@##1@@reset\endcsname{%
        \@nameuse{#1@\@nameuse{#1@##1@@name}@####1false}%
      }%
    }%
    \kvsetkeys@expandafter{#1@choice}{\sjtu@@choices}%
%    \end{macrocode}
%
% 将 \meta{initial} 赋值到 \cs{\meta{family}@\meta{name}}，如果非空则执行相应的代码。
%
%    \begin{macrocode}
    \expandafter\let\csname #1@\@nameuse{#1@##1@@name}\endcsname\sjtu@@initial
    \expandafter\ifx\csname #1@\@nameuse{#1@##1@@name}\endcsname\@empty\else
      \@nameuse{#1@##1@@check}%
    \fi
%    \end{macrocode}
%
% 定义 \cs{sjtusetup} 接口。
%
%    \begin{macrocode}
    \kv@define@key{#1}{##1}[\@nameuse{#1@##1@@default}]{%
      \@namedef{#1@\@nameuse{#1@##1@@name}}{####1}%
      \@nameuse{#1@##1@@check}%
      \@nameuse{#1@##1@@code}%
    }%
  }
}
%    \end{macrocode}
%
% 定义接口向 |key| 添加 |code|：
%
%    \begin{macrocode}
\newcommand\sjtu@option@hook[3]{%
  \expandafter\g@addto@macro\csname #1@#2@@code\endcsname{#3}%
}
%    \end{macrocode}
%
%    \begin{macrocode}
\sjtu@set@family@handler{sjtu}
\sjtu@define@key{sjtu}{
%    \end{macrocode}
%
% 论文类型。
%    \begin{macrocode}
  type = {
    choices = {
      doctor,
      master,
      bachelor,
      course,
    },
  },
%    \end{macrocode}
%
% 论文语言。
%    \begin{macrocode}
  lang = {
    choices = {
      zh,
      en,
    },
  },
%    \end{macrocode}
%
% 字号。
%    \begin{macrocode}
  zihao = {
    choices = {
      -4,
      5,
      auto,
      false,
    },
    initial = auto,
  },
}
%    \end{macrocode}
%
% 正文字体。
%    \begin{macrocode}
\DeclareStringOption[termes]{text-font}
\@namedef{sjtu@text@font}{\csname sjtu@text-font\endcsname}
%    \end{macrocode}
%
% 数学字体。
%    \begin{macrocode}
\DeclareStringOption[auto]{math-font}
\@namedef{sjtu@math@font}{\csname sjtu@math-font\endcsname}
%    \end{macrocode}
%
% 中文字体。
%    \begin{macrocode}
\DeclareStringOption[auto]{cjk-font}
\@namedef{sjtu@cjk@font}{\csname sjtu@cjk-font\endcsname}
%    \end{macrocode}
%
% 是否偏好使用 \pkg{unicode-math}。
%    \begin{macrocode}
\DeclareBoolOption[false]{unimath}
%    \end{macrocode}
%
% 取消预设的定理环境。
%    \begin{macrocode}
\DeclareBoolOption[false]{nothm}
%    \end{macrocode}
%
% 盲审模式开关。
%    \begin{macrocode}
\DeclareBoolOption[false]{review}
%    \end{macrocode}
%
% 设置默认 \opt{openany}。
%    \begin{macrocode}
\DeclareBoolOption[false]{openright}
\DeclareComplementaryOption{openany}{openright}
%    \end{macrocode}
%
% 将选项传递给 \pkg{ctexbook}。
%    \begin{macrocode}
\DeclareDefaultOption{\PassOptionsToClass{\CurrentOption}{ctexbook}}
%    \end{macrocode}
%
% 解析用户传递过来的选项，并加载 \pkg{ctexbook}。
%    \begin{macrocode}
\ProcessKeyvalOptions*
%    \end{macrocode}
%
% 设置学位层次。
%    \begin{macrocode}
\newif\ifsjtu@type@graduate
\sjtu@type@graduatefalse
\ifsjtu@type@doctor
  \sjtu@type@graduatetrue
\fi
\ifsjtu@type@master
  \sjtu@type@graduatetrue
\fi
%    \end{macrocode}
%
% 设置默认字号。
%    \begin{macrocode}
\ifsjtu@zihao@auto
  \ifsjtu@type@graduate
    \def\sjtu@zihao{-4}
  \else
    \def\sjtu@zihao{5}
  \fi
\fi
\PassOptionsToClass{zihao=\sjtu@zihao}{ctexbook}
%    \end{macrocode}
%
% 设置默认 \opt{openany}。
%    \begin{macrocode}
\ifsjtu@openright
  \PassOptionsToClass{openright}{book}
\else
  \PassOptionsToClass{openany}{book}
\fi
%    \end{macrocode}
%
% 本科论文设置默认 \opt{oneside}。
%    \begin{macrocode}
\ifsjtu@type@graduate\else
  \PassOptionsToClass{oneside}{book}
\fi
%    \end{macrocode}
%
% 使用 \XeTeX{} 引擎时，\pkg{fontspec} 宏包会被 \pkg{xeCJK} 自动调用。传递给
% \pkg{fontspec} 宏包 \opt{no-math} 选项，避免部分数学符号字体自动调整为 CMR。
% 并使用 \opt{quiet} 忽略警告。
%    \begin{macrocode}
\PassOptionsToPackage{no-math,quiet}{fontspec}
%    \end{macrocode}
%
% 使用 \pkg{ctexbook} 类，优于调用 \pkg{ctex} 宏包。
%    \begin{macrocode}
\LoadClass[a4paper,UTF8,scheme=plain,fontset=none,linespread=1.3]{ctexbook}[2018/04/01]
%    \end{macrocode}
%
% 根据选项载入配置文件。
%    \begin{macrocode}
\AtEndOfClass{
  \ifsjtu@type@graduate
    \input{sjtuthesis-graduate.ltx}
  \else
    \input{sjtuthesis-undergraduate.ltx}
  \fi
}
%    \end{macrocode}
%
% \subsection{载入宏包}
% \label{sec:loadpackage}
%
% 引用的宏包和相应的定义。
%    \begin{macrocode}
\RequirePackage{xparse}
\RequirePackage{etoolbox}
\RequirePackage{filehook}
\RequirePackage{environ}
\RequirePackage{calc}
%    \end{macrocode}
%
% 使用 \pkg{geometry} 设置页面。
%    \begin{macrocode}
\RequirePackage{geometry}
%    \end{macrocode}
%
% 使用 \pkg{fancyhdr} 设置页眉页脚。
%    \begin{macrocode}
\RequirePackage{fancyhdr}
%    \end{macrocode}
%
% 使用 \pkg{pageslts} 设置页码。
%    \begin{macrocode}
\RequirePackage{pageslts}
%    \end{macrocode}
%
% 使用 \pkg{amsmath} 处理数学公式。
%    \begin{macrocode}
\RequirePackage{amsmath}
%    \end{macrocode}
%
% 颜色支持宏包。
%    \begin{macrocode}
\RequirePackage{xcolor}
%    \end{macrocode}
%
% 图形支持宏包。
%    \begin{macrocode}
\RequirePackage{graphicx}
%    \end{macrocode}
%
% 表格支持宏包。
%    \begin{macrocode}
\RequirePackage{array}
%    \end{macrocode}
%
% 题注支持宏包。
%    \begin{macrocode}
\RequirePackage{caption}
\RequirePackage[list=off]{bicaption}
\RequirePackage{subcaption}
%    \end{macrocode}
%
% 使用 \pkg{tocloft} 设置目录格式。
%    \begin{macrocode}
\RequirePackage[titles]{tocloft}
%    \end{macrocode}
%
% \pkg{enumitem} 更好的列表环境。
%    \begin{macrocode}
\RequirePackage[inline]{enumitem}
%    \end{macrocode}
%
% 脚注支持宏包。
%    \begin{macrocode}
\RequirePackage[perpage,bottom]{footmisc}
%    \end{macrocode}
%
% \pkg{pdfpages} 便于我们插入扫描版的原创性声明和授权声明 PDF 文档。
%    \begin{macrocode}
\RequirePackage{pdfpages}
\includepdfset{fitpaper=true}
%    \end{macrocode}
%
%    \begin{macrocode}
\RequirePackage{url}
%    \end{macrocode}
%
% 忽略不必要的警告。
%    \begin{macrocode}
\RequirePackage{silence}
\WarningFilter{pageslts}{Package pdfpages detected}
%    \end{macrocode}
%
% 对冲突的宏包报错。
%    \begin{macrocode}
\newcommand\sjtu@package@conflict[2]{
  \AtEndOfPackageFile*{#1}{%
    \AtBeginOfPackageFile*{#2}{%
      \sjtu@error{The "#2" package is incompatible with "#1"}%
    }
  }
}
\sjtu@package@conflict{unicode-math}{amscd}
\sjtu@package@conflict{unicode-math}{amsfonts}
\sjtu@package@conflict{unicode-math}{amssymb}
\sjtu@package@conflict{unicode-math}{bbm}
\sjtu@package@conflict{unicode-math}{bm}
\sjtu@package@conflict{unicode-math}{eucal}
\sjtu@package@conflict{unicode-math}{eufrak}
\sjtu@package@conflict{unicode-math}{mathrsfs}
\sjtu@package@conflict{unicode-math}{newtxmath}
\sjtu@package@conflict{unicode-math}{upgreek}
\sjtu@package@conflict{newtxmath}{amsfonts}
\sjtu@package@conflict{newtxmath}{amssymb}
\sjtu@package@conflict{newtxmath}{unicode-math}
\sjtu@package@conflict{newtxmath}{upgreek}
%    \end{macrocode}
%
% 定义一个补丁命令，失败时给出警告。
%    \begin{macrocode}
\newcommand\sjtu@patchcmd[3]{%
  \patchcmd{#1}{#2}{#3}{}%
    {\sjtu@warning{Oops! Command `\protect#1' is NOT patchable.}}
}
%    \end{macrocode}
%
% \subsection{定义格式选项}
%
%    \begin{macrocode}
\kv@define@key{sjtu}{style}{
  \kvsetkeys{sjtu@style}{#1}
}
\sjtu@set@family@handler{sjtu@style}
\sjtu@define@key{sjtu@style}{
  header = {
    choices = {
      single,
      double,
    },
  },
  frontmatter-numbering = {
    name = frontmatter@numbering,
    choices = {
      true,
      false,
    },
  },
  indent-headings = {
    name = indent@headings,
    choices = {
      fixed,
      auto,
      false,
    },
    initial = false,
    default = fixed,
  },
  footnote = {
    choices = {
      indent,
      hang,
    },
  },
  title-logo-color = {
    name = title@logo@color,
    choices = {
      red,
      blue,
      black,
    },
    initial = red,
  },
  header-logo-color = {
    name = header@logo@color,
    choices = {
      red,
      blue,
      black,
    },
    initial = red,
  },
  float-number-separator = {
    name = fl@num@sep,
    initial = {--},
  },
  equation-number-separator = {
    name = eq@num@sep,
    initial = {--},
  },
}
%    \end{macrocode}
%
% \subsection{信息录入}
%
%    \begin{macrocode}
\kv@define@key{sjtu}{info}{
  \kvsetkeys{sjtu@info}{#1}
}
\sjtu@set@family@handler{sjtu@info}
\sjtu@define@key{sjtu@info}{
%    \end{macrocode}
%
% 论文中英文题目。
%    \begin{macrocode}
  title           = { name = title@zh },
  title*          = { name = title@en },
%    \end{macrocode}
%
% 标题页论文中英文题目。
%    \begin{macrocode}
  display-title   = { name = display@title@zh },
  display-title*  = { name = display@title@en },
%    \end{macrocode}
%
% 论文页眉中英文题目。
%    \begin{macrocode}
  running-title   = { name = running@title@zh },
  running-title*  = { name = running@title@en },
%    \end{macrocode}
%
% 关键字。
%    \begin{macrocode}
  keywords        = { name = keywords@zh },
  keywords*       = { name = keywords@en },
%    \end{macrocode}
%
% 作者。
%    \begin{macrocode}
  author          = { name = author@zh },
  author*         = { name = author@en },
%    \end{macrocode}
%
% 学号。
%    \begin{macrocode}
  id,
%    \end{macrocode}
%
% 导师、副导师。
%    \begin{macrocode}
  supervisor      = { name = supervisor@zh },
  supervisor*     = { name = supervisor@en },
  assisupervisor  = { name = assisupervisor@zh },
  assisupervisor* = { name = assisupervisor@en },
%    \end{macrocode}
%
% 申请学位中英文名称。
%    \begin{macrocode}
  degree          = { name = degree@zh },
  degree*         = { name = degree@en },
%    \end{macrocode}
%
% 院系中英文名称。
%    \begin{macrocode}
  department      = { name = department@zh },
  department*     = { name = department@en },
%    \end{macrocode}
%
% 专业中英文名称。
%    \begin{macrocode}
  major           = { name = major@zh },
  major*          = { name = major@en },
%    \end{macrocode}
%
% 课程中英文名称。
%    \begin{macrocode}
  course          = { name = course@zh },
  course*         = { name = course@en },
%    \end{macrocode}
%
% 资助基金中英文名称。
%    \begin{macrocode}
  fund            = { name = fund@zh },
  fund*           = { name = fund@en },
%    \end{macrocode}
%
% 答辩日期。
%    \begin{macrocode}
  date            = {%
    initial = {\the\year-\two@digits{\month}-\two@digits{\day}},
  },
}
%    \end{macrocode}
%
%    \begin{macrocode}
\sjtu@option@hook{sjtu@info}{title}{%
  \ifx\sjtu@info@display@title@zh\@empty
    \global\let\sjtu@info@display@title@zh\sjtu@info@title@zh
  \fi
  \ifx\sjtu@info@running@title@zh\@empty
    \global\let\sjtu@info@running@title@zh\sjtu@info@title@zh
  \fi
}
\sjtu@option@hook{sjtu@info}{title*}{%
  \ifx\sjtu@info@display@title@en\@empty
    \global\let\sjtu@info@display@title@en\sjtu@info@title@en
  \fi
  \ifx\sjtu@info@running@title@en\@empty
    \global\let\sjtu@info@running@title@en\sjtu@info@title@en
  \fi
}
%    \end{macrocode}
%
%    \begin{macrocode}
\newcommand\sjtu@clist@use[2]{%
  \let\sjtu@@tmp\@empty%
  \def\sjtu@clist@processor##1{%
    \ifx\sjtu@@tmp\@empty
      \def\sjtu@@tmp{#2}%
    \else
      #2%
    \fi
    ##1%
  }%
  \expandafter\comma@parse\expandafter{#1}{\sjtu@clist@processor}%
}
%    \end{macrocode}
%
%    \begin{macrocode}
\ifsjtu@lang@zh
  \def\sjtu@info@title{\sjtu@info@title@zh}
  \def\sjtu@info@title@sec{\sjtu@info@title@en}
  \def\sjtu@info@display@title{\sjtu@info@display@title@zh}
  \def\sjtu@info@running@title{\sjtu@info@running@title@zh}
  \def\sjtu@info@keywords{\sjtu@info@keywords@zh}
  \def\sjtu@info@author{\sjtu@info@author@zh}
\else
  \def\sjtu@info@title{\sjtu@info@title@en}
  \def\sjtu@info@title@sec{\sjtu@info@title@zh}
  \def\sjtu@info@display@title{\sjtu@info@display@title@en}
  \def\sjtu@info@running@title{\sjtu@info@running@title@en}
  \def\sjtu@info@keywords{\sjtu@info@keywords@en}
  \def\sjtu@info@author{\sjtu@info@author@en}
\fi
%    \end{macrocode}
%
% 输出日期的给定格式：\cs{sjtu@date}\marg{format}\marg{date}，
% 其中格式 \meta{format} 接受三个参数分别对应年、月、日，
% \meta{date} 是 ISO 格式的日期（yyyy-mm-dd）。
% 盲审模式下隐去日期。
%    \begin{macrocode}
\newcommand\sjtu@date[2]{%
  \ifsjtu@review\relax\else
    \edef\sjtu@@date{#2}%
    \def\sjtu@@process@date##1-##2-##3\@nil{%
      #1{##1}{##2}{##3}%
    }%
    \expandafter\sjtu@@process@date\sjtu@@date\@nil
  \fi
}
\newcommand\sjtu@date@format@zh[3]{#1 年 \number#2 月 \number#3 日}
\newcommand\sjtu@date@month@en[1]{%
  \ifcase\number#1\or
    January\or February\or March\or April\or May\or June\or
    July\or August\or September\or October\or November\or December%
  \fi
}
\newcommand\sjtu@date@format@en[3]{\sjtu@date@month@en{#2} \number#3, #1}
%    \end{macrocode}
%
% 首先定义 |name| 接口，设置可供用户修改的各种名称。
%    \begin{macrocode}
\kv@define@key{sjtu}{name}{
  \kvsetkeys{sjtu@name}{#1}
}
\sjtu@set@family@handler{sjtu@name}
\sjtu@define@key{sjtu@name}{
  appendix          = { initial = Appendix },
  contents          = { initial = Contents },
  listfigure        = { initial = List of Figures },
  listtable         = { initial = List of Tables },
  listalgorithm     = { initial = List of Algorithms },
  figure            = { initial = Figure },
  figure*           = { name = figure@second, initial = 图 },
  table             = { initial = Table },
  table*            = { name = table@second, initial = 表 },
  algorithm         = { initial = Algorithm },
  abbr              = { initial = Abbreviation },
  nom               = { initial = Nomenclature },
  summary           = { initial = Summary },
  bib               = { initial = Bibliography },
  index             = { initial = Index },
  ack               = { initial = Acknowledgements },
  achv              = { initial = Research Achievements },
  resume            = { initial = Resume },
  digest            = { initial = Digest },
}
%    \end{macrocode}
%
% 定义各种不会变化的名称。
%    \begin{macrocode}
\newcommand\sjtu@name@def[2]{%
  \@namedef{sjtu@name@#1}{#2}
}
\sjtu@name@def{school@zh}{上海交通大学}
\sjtu@name@def{school@en}{Shanghai Jiao Tong University}
\ifsjtu@type@graduate
  \ifsjtu@type@doctor
    \sjtu@name@def{degree@type@zh}{博士}
    \sjtu@name@def{degree@type@en}{Doctor}
  \else
    \sjtu@name@def{degree@type@zh}{硕士}
    \sjtu@name@def{degree@type@en}{Master}
  \fi
  \sjtu@name@def{author@zh}{\sjtu@name@degree@type@zh 研究生}
  \sjtu@name@def{author@en}{Candidate}
  \sjtu@name@def{id@zh}{学号}
  \sjtu@name@def{id@en}{Student ID}
  \sjtu@name@def{supervisor@zh}{导师}
  \sjtu@name@def{supervisor@en}{Supervisor}
  \sjtu@name@def{assisupervisor@zh}{副导师}
  \sjtu@name@def{assisupervisor@en}{Assistant Supervisor}
  \sjtu@name@def{degree@zh}{申请学位}
  \sjtu@name@def{degree@en}{Academic Degree Applied for}
  \sjtu@name@def{major@zh}{学科}
  \sjtu@name@def{major@en}{Speciality}
  \sjtu@name@def{department@zh}{所在单位}
  \sjtu@name@def{department@en}{Affiliation}
  \sjtu@name@def{defenddate@zh}{答辩日期}
  \sjtu@name@def{defenddate@en}{Date of Defence}
  \sjtu@name@def{conferring@zh}{授予学位单位}
  \sjtu@name@def{conferring@en}{Degree-Conferring-Institution}
  \sjtu@name@def{thesis@type}{学位论文}
  \sjtu@name@def{subject@zh}{%
    \sjtu@name@school@zh\sjtu@name@degree@type@zh\sjtu@name@thesis@type
  }
  \sjtu@name@def{subject@en}{%
    Dissertation Submitted to \sjtu@name@school@en \\
    for the Degree of \sjtu@name@degree@type@en
  }
\else
  \ifsjtu@type@course
    \sjtu@name@def{degree@type@zh}{}
    \sjtu@name@def{degree@type@en}{}
    \sjtu@name@def{thesis@type}{课程论文}
    \sjtu@name@def{subject@zh}{\sjtu@name@thesis@type}
    \sjtu@name@def{subject@en}{Course Paper}
  \else
    \sjtu@name@def{degree@type@zh}{学士}
    \sjtu@name@def{degree@type@en}{Bachelor}
    \sjtu@name@def{thesis@type}{学位论文}
    \sjtu@name@def{subject@zh}{\sjtu@name@degree@type@zh\sjtu@name@thesis@type}
    \sjtu@name@def{subject@en}{\sjtu@name@degree@type@en's Thesis}
  \fi
  \sjtu@name@def{author@zh}{学生姓名}
  \sjtu@name@def{id@zh}{学生学号}
  \sjtu@name@def{supervisor@zh}{指导教师}
  \sjtu@name@def{course@zh}{课程名称}
  \sjtu@name@def{major@zh}{专业}
  \sjtu@name@def{department@zh}{学院(系)}
\fi
\sjtu@name@def{orig@title@zh}{原创性声明}
\sjtu@name@def{orig@title@en}{Statement of Originality}
\sjtu@name@def{copr@title@zh}{使用授权书}
\sjtu@name@def{copr@title@en}{Copyright Permission}
\sjtu@name@def{orig@body}{%
  本人郑重声明：所呈交的\sjtu@name@thesis@type ，是本人在导师的指导下，独立进行
  研究工作所取得的成果。除文中已经注明引用的内容外，本论文不包含任何其他个人或集
  体已经发表或撰写过的作品成果。对本文的研究做出重要贡献的个人和集体，均已在文中
  以明确方式标明。本人完全意识到本声明的法律结果由本人承担。}
\sjtu@name@def{copr@body}{%
  本\sjtu@name@thesis@type 作者完全了解学校有关保留、使用\sjtu@name@thesis@type
  的规定，同意学校保留并向国家有关部门或机构送交论文的复印件和电子版，允许论文被
  查阅和借阅。}
\sjtu@name@def{abstract@zh}{摘\hspace{\ccwd}要}
\sjtu@name@def{abstract@en}{Abstract}
\sjtu@name@def{keywords@zh}{关键词：}
\sjtu@name@def{keywords@en}{Key words:~}
%    \end{macrocode}
%
% 定义根据语言变化的名称。
%    \begin{macrocode}
\ifsjtu@lang@zh
  \sjtusetup{
    name = {
      appendix          = {附录},
      contents          = {目\hspace{\ccwd}录},
      listfigure        = {插图索引},
      listtable         = {表格索引},
      listalgorithm     = {算法索引},
      figure            = {图},
      figure*           = {Figure},
      table             = {表},
      table*            = {Table},
      algorithm         = {算法},
      abbr              = {缩略语对照表},
      nom               = {符号对照表},
      summary           = {全文总结},
      bib               = {参考文献},
      index             = {索\hspace{\ccwd}引},
      ack               = {致\hspace{\ccwd}谢},
      achv              = {学术论文和科研成果目录},
      resume            = {个人简历},
      digest            = {大摘要},
    }
  }
  \ctexset{
    chapter/name    = {第,章},
    chapter/number  = \chinese{chapter},
  }
  \sjtu@name@def{titlepage}{扉页}
  \sjtu@name@def{subject}{\sjtu@name@subject@zh}
  \sjtu@name@def{copr@mk}{\sjtu@name@orig@title@zh 及\sjtu@name@copr@title@zh}
  \sjtu@name@def{abstract}{\sjtu@name@abstract@zh}
  \sjtu@name@def{assumption}{假设}
  \sjtu@name@def{axiom}{公理}
  \sjtu@name@def{conjecture}{猜想}
  \sjtu@name@def{corollary}{推论}
  \sjtu@name@def{definition}{定义}
  \sjtu@name@def{example}{例}
  \sjtu@name@def{exercise}{练习}
  \sjtu@name@def{lemma}{引理}
  \sjtu@name@def{problem}{问题}
  \sjtu@name@def{proof}{证明}
  \sjtu@name@def{proposition}{命题}
  \sjtu@name@def{remark}{注}
  \sjtu@name@def{solution}{解}
  \sjtu@name@def{theorem}{定理}
\else
  \sjtu@name@def{titlepage}{Title Page}
  \sjtu@name@def{subject}{\sjtu@name@subject@en}
  \sjtu@name@def{copr@mk}{\sjtu@name@orig@title@en and \sjtu@name@copr@title@en}
  \sjtu@name@def{abstract}{\sjtu@name@abstract@en}
  \sjtu@name@def{assumption}{Assumption}
  \sjtu@name@def{axiom}{Axiom}
  \sjtu@name@def{conjecture}{Conjecture}
  \sjtu@name@def{corollary}{Corollary}
  \sjtu@name@def{definition}{Definition}
  \sjtu@name@def{example}{Example}
  \sjtu@name@def{exercise}{Exercise}
  \sjtu@name@def{lemma}{Lemma}
  \sjtu@name@def{problem}{Problem}
  \sjtu@name@def{proof}{Proof}
  \sjtu@name@def{proposition}{Proposition}
  \sjtu@name@def{remark}{Remark}
  \sjtu@name@def{solution}{Solution}
  \sjtu@name@def{theorem}{Theorem}
\fi
%    \end{macrocode}
%
% 应用名称设置。
%    \begin{macrocode}
\ctexset{%
  appendixname   = \sjtu@name@appendix,
  contentsname   = \sjtu@name@contents,
  listfigurename = \sjtu@name@listfigure,
  listtablename  = \sjtu@name@listtable,
  figurename     = \sjtu@name@figure,
  tablename      = \sjtu@name@table,
  bibname        = \sjtu@name@bib,
  indexname      = \sjtu@name@index,
}
%    \end{macrocode}
%
% \subsection{西文字体}
%
%    \begin{macrocode}
\ifsjtu@unimath
  \RequirePackage{unicode-math}
\fi
\ifthenelse{\equal{\sjtu@math@font}{auto}}{
  \let\sjtu@math@font\sjtu@text@font
}{}
\ifthenelse{\equal{\sjtu@math@font}{none}}{}{%
  \InputIfFileExists{sjtu-math-font-\sjtu@math@font.def}{}{%
    \sjtu@warning{%
      Invalid value `math-font = \sjtu@math@font'! \MessageBreak
      Using `termes' instead.
    }
    \def\sjtu@math@font{termes}
    \input{sjtu-math-font-\sjtu@math@font.def}
  }
}
\ifthenelse{\equal{\sjtu@text@font}{none}}{}{%
  \InputIfFileExists{sjtu-text-font-\sjtu@text@font.def}{}{%
    \sjtu@warning{%
      Invalid value `text-font = \sjtu@text@font'! \MessageBreak
      Using `termes' instead.
    }
    \def\sjtu@text@font{termes}
    \input{sjtu-text-font-\sjtu@text@font.def}
  }
}
%</class>
%<*mathfont>
%<termes|pagella|lm>\ifsjtu@unimath
%<stixtwo|xits|newcm|cambria>\sjtu@unimathtrue
%<stixtwo|xits|newcm|cambria>\RequirePackage{unicode-math}
%<termes>  \setmathfont{texgyretermes-math.otf}
%<pagella>  \setmathfont{texgyrepagella-math.otf}
%<*stixtwo>
\IfFontExistsTF{STIXTwoMath-Regular.otf}{
  \setmathfont[
    StylisticSet = 8
  ]{STIXTwoMath-Regular.otf}
  \setmathfont[
    range        = {scr, bfscr},
    StylisticSet = 1
  ]{STIXTwoMath-Regular.otf}
}{
  \setmathfont[
    StylisticSet = 8
  ]{STIX2Math.otf}
  \setmathfont[
    range        = {scr, bfscr},
    StylisticSet = 1
  ]{STIX2Math.otf}
}
%</stixtwo>
%<*xits>
\IfFontExistsTF{XITSMath-Regular.otf}{
  \setmathfont[
    Extension    = .otf,
    BoldFont     = XITSMath-Bold,
    StylisticSet = 8,
  ]{XITSMath-Regular}
  \setmathfont[
    range        = {cal, bfcal},
    StylisticSet = 1
  ]{XITSMath-Regular.otf}
}{
  \setmathfont[
    Extension    = .otf,
    BoldFont     = *bold,
    StylisticSet = 8,
  ]{xits-math}
  \setmathfont[
    range        = {cal, bfcal},
    StylisticSet = 1
  ]{xits-math.otf}
}
%</xits>
%<lm>  \setmathfont{latinmodern-math.otf}
%<*newcm>
\setmathfont[
  StylisticSet = 2
]{NewCMMath-Book.otf}
\setmathfont[
  range        = {scr, bfscr},
  StylisticSet = 1
]{NewCMMath-Book.otf}
%</newcm>
%<cambria>\setmathfont{Cambria Math}
%</mathfont>
%<*termes|pagella>
%<mathfont>  \setmathrm[
%<textfont>  \setmainfont[
    Extension      = .otf,
    UprightFont    = *-regular,
    BoldFont       = *-bold,
    ItalicFont     = *-italic,
    BoldItalicFont = *-bolditalic,
%<termes>  ]{texgyretermes}
%<pagella>  ]{texgyrepagella}
%</termes|pagella>
%<*stixtwo>
\IfFontExistsTF{STIXTwoText-Regular.otf}{
%<mathfont>  \setmathrm[
%<textfont>  \setmainfont[
    Extension      = .otf,
    UprightFont    = *-Regular,
    BoldFont       = *-Bold,
    ItalicFont     = *-Italic,
    BoldItalicFont = *-BoldItalic,
  ]{STIXTwoText}
}{
%<mathfont>  \setmathrm[
%<textfont>  \setmainfont[
    Extension      = .otf,
    UprightFont    = *-Regular,
    BoldFont       = *-Bold,
    ItalicFont     = *-Italic,
    BoldItalicFont = *-BoldItalic,
  ]{STIX2Text}
}
%</stixtwo>
%<*xits>
\IfFontExistsTF{XITS-Regular.otf}{
%<mathfont>  \setmathrm[
%<textfont>  \setmainfont[
    Extension      = .otf,
    UprightFont    = *-Regular,
    BoldFont       = *-Bold,
    ItalicFont     = *-Italic,
    BoldItalicFont = *-BoldItalic,
  ]{XITS}
}{
%<mathfont>  \setmathrm[
%<textfont>  \setmainfont[
    Extension      = .otf,
    UprightFont    = *-regular,
    BoldFont       = *-bold,
    ItalicFont     = *-italic,
    BoldItalicFont = *-bolditalic,
  ]{xits}
}
%</xits>
%<*termes|pagella|stixtwo|xits>
%<mathfont>  \setmathsf[
%<textfont>  \setsansfont[
    Extension      = .otf,
    UprightFont    = *-regular,
    BoldFont       = *-bold,
    ItalicFont     = *-italic,
    BoldItalicFont = *-bolditalic,
  ]{texgyreheros}
%<mathfont>  \setmathtt[
%<textfont>  \setmonofont[
    Extension      = .otf,
    UprightFont    = *-regular,
    BoldFont       = *-bold,
    ItalicFont     = *-italic,
    BoldItalicFont = *-bolditalic,
    Scale          = MatchLowercase,
    Ligatures      = CommonOff,
  ]{texgyrecursor}
%</termes|pagella|stixtwo|xits>
%<*lm>
%<mathfont>  \setmathrm[
%<textfont>  \setmainfont[
    Extension      = .otf,
    UprightFont    = *-regular,
    BoldFont       = *-bold,
    ItalicFont     = *-italic,
    BoldItalicFont = *-bolditalic,
  ]{lmroman10}
%<mathfont>  \setmathsf[
%<textfont>  \setsansfont[
    Extension      = .otf,
    UprightFont    = *-regular,
    BoldFont       = *-bold,
    ItalicFont     = *-oblique,
    BoldItalicFont = *-boldoblique,
  ]{lmsans10}
%<mathfont>  \setmathtt[
%<textfont>  \setmonofont[
    Extension      = .otf,
    UprightFont    = *-regular,
    BoldFont       = *-bold,
    ItalicFont     = *-oblique,
    BoldItalicFont = *-boldoblique,
  ]{lmmonolt10}
%</lm>
%<*newcm>
%<mathfont>\setmathrm[
%<textfont>\setmainfont[
  Extension      = .otf,
  UprightFont    = *-Book,
  BoldFont       = *-Bold,
  ItalicFont     = *-BookItalic,
  BoldItalicFont = *-BoldItalic,
]{NewCM10}
%<mathfont>\setmathsf[
%<textfont>\setsansfont[
  Extension      = .otf,
  UprightFont    = *-Book,
  BoldFont       = *-Bold,
  ItalicFont     = *-BookOblique,
  BoldItalicFont = *-BoldOblique,
]{NewCMSans10}
%<mathfont>\setmathtt[
%<textfont>\setmonofont[
  Extension      = .otf,
  UprightFont    = *-Book,
  BoldFont       = *-Bold,
  ItalicFont     = *-BookItalic,
  BoldItalicFont = *-BoldOblique,
]{NewCMMono10}
%</newcm>
%<*cambria>
%<*mathfont>
\setmathrm{Cambria}
\setmathsf{Calibri}
\setmathtt[Scale=MatchLowercase]{Consolas}
%</mathfont>
%<*textfont>
\setmainfont{Cambria}
\setsansfont{Calibri}
\setmonofont[Scale=MatchLowercase]{Consolas}
%</textfont>
%</cambria>
%<*times>
\setmainfont[Ligatures=Rare]{Times New Roman}
\setsansfont{Arial}
\setmonofont[Scale=MatchLowercase]{Courier New}
%</times>
%<*mathfont&(termes|pagella|lm)>
\else
%<lm>  \RequirePackage{amssymb}
%<lm>  \RequirePackage{upgreek}
  \let\oldencodingdefault\encodingdefault
  \let\oldrmdefault\rmdefault
  \let\oldsfdefault\sfdefault
  \let\oldttdefault\ttdefault
  \RequirePackage[T1]{fontenc}
%<termes>  \renewcommand{\rmdefault}{ntxtlf}
%<pagella>  \renewcommand{\rmdefault}{zpltlf}
%<termes|pagella>  \renewcommand{\sfdefault}{qhv}
%<termes|pagella>  \renewcommand{\ttdefault}{ntxtt}
%<termes>  \RequirePackage[upint]{newtxmath}
%<pagella>  \RequirePackage[upint]{newpxmath}
%<lm>  \RequirePackage{lmodern}
  \let\encodingdefault\oldencodingdefault
  \let\rmdefault\oldrmdefault
  \let\sfdefault\oldsfdefault
  \let\ttdefault\oldttdefault
  \RequirePackage{bm}
\fi
%</mathfont&(termes|pagella|lm)>
%    \end{macrocode}
%
% \subsection{中文字体}
%
% 根据操作系统自动选择中文字体。
%    \begin{macrocode}
%<*class>
\ifthenelse{\equal{\sjtu@cjk@font}{auto}}{
  \IfFontExistsTF{SimSun}{
    \def\sjtu@cjk@font{windows}
  }{
    \IfFileExists{/System/Library/Fonts/Menlo.ttc}{
      \def\sjtu@cjk@font{mac}
    }{
      \IfFontExistsTF{Noto Serif CJK SC}{
        \def\sjtu@cjk@font{ubuntu}
      }{
        \def\sjtu@cjk@font{fandol}
      }
    }
  }
}{}
\ifthenelse{\equal{\sjtu@cjk@font}{none}}{}{%
  \InputIfFileExists{sjtu-cjk-font-\sjtu@cjk@font.def}{}{%
    \sjtu@warning{%
      Invalid value `cjk-font = \sjtu@cjk@font'! \MessageBreak
      Using `fandol' instead.
    }
    \def\sjtu@cjk@font{fandol}
    \input{sjtu-cjk-font-\sjtu@cjk@font.def}
  }
}
%    \end{macrocode}
%
% 带圈数字和方框使用中文字体。
%    \begin{macrocode}
\ifXeTeX
  \xeCJKDeclareCharClass{CJK}{"24EA,"2460->"2473,"3251->"32BF,"25A1}
\fi
\ifLuaTeX
  \ltjdefcharrange{100}{"24EA,"2460-"2473,"3251-"32BF,"25A1}
  \ltjsetparameter{jacharrange={+100}}
\fi
\newcommand\sjtu@square{\symbol{"25A1}}
\newcommand\sjtu@colon{\makebox[1\ccwd]{\symbol{"FF1A}}}
%</class>
%    \end{macrocode}
%
%    \begin{macrocode}
%<*cjkfont>
%<*windows>
\setCJKmainfont{SimSun}[
  AutoFakeBold = 3,
  ItalicFont   = KaiTi,
]
\setCJKsansfont{SimHei}[BoldFont=*]
\setCJKmonofont{FangSong}
\setCJKfamilyfont{zhsong}{SimSun}[
  AutoFakeBold = 3,
  ItalicFont   = KaiTi,
]
\setCJKfamilyfont{zhhei}{SimHei}[BoldFont=*]
\setCJKfamilyfont{zhkai}{KaiTi}
\setCJKfamilyfont{zhfs}{FangSong}
%</windows>
%<*mac>
\setCJKmainfont{Songti SC}[
  UprightFont    = * Light,
  BoldFont       = * Bold,
  ItalicFont     = Kaiti SC Regular,
  BoldItalicFont = Kaiti SC Bold,
]
\setCJKsansfont{Heiti SC}[
  UprightFont    = * Medium,
  BoldFont       = * Medium,
]%
\setCJKmonofont{STFangsong}
\setCJKfamilyfont{zhsong}{Songti SC}[
  UprightFont    = * Light,
  BoldFont       = * Bold,
]
\setCJKfamilyfont{zhhei}{Heiti SC}[
  UprightFont    = * Medium,
  BoldFont       = * Medium,
]
\setCJKfamilyfont{zhfs}{STFangsong}
\setCJKfamilyfont{zhkai}{Kaiti SC}[
  UprightFont    = * Regular,
  BoldFont       = * Bold,
]
%</mac>
%<*ubuntu>
\setCJKmainfont{Noto Serif CJK SC}[
  UprightFont = * Light,
  BoldFont    = * Bold,
  ItalicFont  = AR PL UKai CN,
]
\setCJKsansfont{Noto Sans CJK SC}[
  UprightFont = * Medium,
  BoldFont    = * Medium,
]
\setCJKmonofont{Noto Sans Mono CJK SC}
\setCJKfamilyfont{zhsong}{Noto Serif CJK SC}[
  UprightFont = * Light,
  BoldFont    = * Bold,
  ItalicFont  = AR PL UKai CN,
]
\setCJKfamilyfont{zhhei}{Noto Sans CJK SC}[
  UprightFont = * Medium,
  BoldFont    = * Medium,
]
\setCJKfamilyfont{zhkai}{AR PL UKai CN}
%</ubuntu>
%<*adobe>
\setCJKmainfont{AdobeSongStd-Light}[
  AutoFakeBold = 3,
  ItalicFont   = AdobeKaitiStd-Regular,
]
\setCJKsansfont{AdobeHeitiStd-Regular}[BoldFont=*]
\setCJKmonofont{AdobeFangsongStd-Regular}
\setCJKfamilyfont{zhsong}{AdobeSongStd-Light}[
  AutoFakeBold = 3,
  ItalicFont = AdobeKaitiStd-Regular,
]
\setCJKfamilyfont{zhhei}{AdobeHeitiStd-Regular}[BoldFont=*]
\setCJKfamilyfont{zhfs}{AdobeFangsongStd-Regular}
\setCJKfamilyfont{zhkai}{AdobeKaitiStd-Regular}
%</adobe>
%<*fandol>
\setCJKmainfont{FandolSong}[
  Extension   = .otf,
  UprightFont = *-Regular,
  BoldFont    = *-Bold,
  ItalicFont  = FandolKai-Regular,
]
\setCJKsansfont{FandolHei}[
  Extension   = .otf,
  UprightFont = *-Regular,
  BoldFont    = *-Regular,
]
\setCJKmonofont{FandolFang}[
  Extension   = .otf,
  UprightFont = *-Regular,
]
\setCJKfamilyfont{zhsong}{FandolSong}[
  Extension   = .otf,
  UprightFont = *-Regular,
  BoldFont    = *-Bold,
]
\setCJKfamilyfont{zhhei}{FandolHei}[
  Extension   = .otf,
  UprightFont = *-Regular,
  BoldFont    = *-Regular,
]
\setCJKfamilyfont{zhfs}{FandolFang}[
  Extension   = .otf,
  UprightFont = *-Regular,
]
\setCJKfamilyfont{zhkai}{FandolKai}[
  Extension   = .otf,
  UprightFont = *-Regular,
]
%</fandol>
%<*founder>
\setCJKmainfont{FZShuSong-Z01}[
  AutoFakeBold = 3,
  ItalicFont   = FZKai-Z03,
]
\setCJKsansfont{FZHei-B01}[BoldFont=*]
\setCJKmonofont{FZFangSong-Z02}
\setCJKfamilyfont{zhsong}{FZShuSong-Z01}[
  AutoFakeBold = 3,
  ItalicFont   = FZKai-Z03,
]
\setCJKfamilyfont{zhhei}{FZHei-B01}[BoldFont=*]
\setCJKfamilyfont{zhkai}{FZKai-Z03}
\setCJKfamilyfont{zhfs}{FZFangSong-Z02}
%</founder>
\NewDocumentCommand\songti{}{\CJKfamily{zhsong}}
\NewDocumentCommand\heiti{}{\CJKfamily{zhhei}}
%<!ubuntu>\NewDocumentCommand\fangsong{}{\CJKfamily{zhfs}}
\NewDocumentCommand\kaishu{}{\CJKfamily{zhkai}}
%</cjkfont>
%    \end{macrocode}
%
% \subsection{页面设置}
%
% 设置纸张、页边距。
%    \begin{macrocode}
%<*(undergraduate|graduate)>
\geometry{%
  paper      = a4paper,
%<*undergraduate>
  top        = 84bp,
  bottom     = 72bp,
  left       = 90bp,
  right      = 90bp,
  headheight = 60bp,
  headsep    = 8bp,
%</undergraduate>
%<*graduate>
  top        = 3.5cm,
  bottom     = 4.0cm,
  left       = 3.3cm,
  right      = 2.8cm,
  headheight = 1.0cm,
  headsep    = 0.5cm,
%</graduate>
}
%    \end{macrocode}
%
% \pkg{fancyhdr} 定义页眉页脚很方便，但是有一个非常隐蔽的坑。
% 第一次调用 \pkg{fancyhdr} 定义的样式时会修改 \cs{chaptermark}，
% 这会导致页眉信息错误（多余章号并且英文大写）。
% 这是因为在 \cs{ps@fancy} 中对 \cs{chaptermark} 进行重定义，
% 所以我们先调用 \cs{ps@fancy}，再修改 \cs{chaptermark}。
%    \begin{macrocode}
\pagestyle{fancy}
%</(undergraduate|graduate)>
%    \end{macrocode}
%
% 设置页眉页脚。
%    \begin{macrocode}
%<*class>
\def\sjtu@thepage{}
\def\sjtu@lastpageref{}
\newif\ifsjtu@page@numbering \sjtu@page@numberingtrue
%</class>
%<*(undergraduate|graduate)>
%<*graduate>
\newcommand\sjtu@thepage@format[2]{---~{\bfseries{#1}}~---}
%</graduate>
%<*undergraduate>
\ifsjtu@lang@zh
  \newcommand\sjtu@thepage@format[2]{第~{#1}~页\,共~{#2}~页}
\else
  \newcommand\sjtu@thepage@format[2]{--~~Page~~{#1}~~of~~{#2}~~--}
\fi
%</undergraduate>
%<*graduate>
\def\sjtu@info@fund{}
\fancypagestyle{title}{%
  \fancyhf{}
  \fancyfoot[L]{\ifsjtu@review\relax\else\sjtu@info@fund\fi}
  \renewcommand\headrulewidth{0pt}
  \renewcommand\footrulewidth{0pt}
}
%</graduate>
\fancypagestyle{plain}{%
  \fancyhf{}
%<*graduate>
  \if@twoside
    \ifsjtu@style@header@single
      \fancyhead[CO]{\zihao{-5}\sjtu@name@subject@zh}
      \fancyhead[CE]{\zihao{-5}\leftmark}
    \else
      \fancyhead[RE,LO]{\zihao{-5}\sjtu@name@subject@zh}
      \fancyhead[RO,LE]{\zihao{-5}\leftmark}
    \fi
  \else
    \ifsjtu@style@header@single
      \fancyhead[C]{\zihao{-5}\sjtu@name@subject@zh}
    \else
      \fancyhead[L]{\zihao{-5}\sjtu@name@subject@zh}
      \fancyhead[R]{\zihao{-5}\leftmark}
    \fi
  \fi
%</graduate>
%<*undergraduate>
  \fancyhead[L]{%
    \includegraphics[height=32pt]%
      {sjtu-vi-logo-\sjtu@style@header@logo@color.pdf}
  }
  \fancyhead[R]{%
    \parbox[b]{0.7\textwidth}{%
      \raggedleft\zihao{-5}\heiti\MakeUppercase{\sjtu@info@running@title}
    }
  }
%</undergraduate>
  \fancyfoot[C]{%
    \ifsjtu@page@numbering
      \zihao{-5}\sjtu@thepage@format{\sjtu@thepage}{\sjtu@lastpageref}%
    \fi
  }
%<*graduate>
  \renewcommand\headrule{%
    \hrule\@height2.25pt\@width\headwidth
    \vskip 0.75pt
    \hrule\@height0.75pt\@width\headwidth
    \vskip-3.75pt
  }
%</graduate>
%<*undergraduate>
  \renewcommand\headrulewidth{0.75pt}
%</undergraduate>
}
%</(undergraduate|graduate)>
%    \end{macrocode}
%
% 使用松散的断行模式，并禁止 \LaTeX{} 自动调整多余的页面底部空白。
%    \begin{macrocode}
%<*class>
\AtEndOfClass{%
  \sloppy
  \raggedbottom
}
%    \end{macrocode}
%
% \subsection{主文档格式}
%
% \subsubsection{Three matters}
%
% \begin{macro}{\cleardoublepage}
% 空白页清空页眉页脚。
%    \begin{macrocode}
\sjtu@patchcmd\cleardoublepage%
  {\newpage}{\thispagestyle{empty}\newpage}
%    \end{macrocode}
% \end{macro}
%
% \begin{macro}{\chapter}
% 每章第一页默认会设置特殊的 pagestyle, 我们将其清除。
%    \begin{macrocode}
\sjtu@patchcmd\chapter%
  {\thispagestyle}{\@gobble}
%    \end{macrocode}
% \end{macro}
%
% 设置文档开始时初始的页码与页眉页脚风格。
%    \begin{macrocode}
\AtBeginDocument{%
  \pagenumbering{Alph}
  \pagestyle{empty}
}
%    \end{macrocode}
%
% \begin{macro}{\frontmatter}
% \begin{macro}{\mainmatter}
% \begin{macro}{\backmatter}
% 前言的页码设置为大写罗马数字，同时设置前言与正文的页眉页脚风格。
%    \begin{macrocode}
\renewcommand\frontmatter{%
  \cleardoublepage
  \@mainmatterfalse
  \ifsjtu@style@frontmatter@numbering@false
    \sjtu@page@numberingfalse
  \fi
  \pagenumbering{Roman}
  \def\sjtu@thepage{\thepage}
  \def\sjtu@lastpageref{\lastpageref{pagesLTS.Roman}}
  \pagestyle{plain}
}
\renewcommand\mainmatter{%
  \cleardoublepage
  \@mainmattertrue
  \sjtu@page@numberingtrue
  \sjtu@set@float@fontsizetrue
  \pagenumbering{arabic}
  \def\sjtu@lastpageref{\lastpageref{pagesLTS.arabic}}
}
\renewcommand\backmatter{%
  \if@openright\cleardoublepage\else\clearpage\fi%
  \@mainmatterfalse
}
%    \end{macrocode}
% \end{macro}
% \end{macro}
% \end{macro}
%
% \subsubsection{章节标题}
% 各级标题格式设置。
%    \begin{macrocode}
\ctexset{%
  chapter = {%
    format       = \zihao{3}\bfseries\heiti\centering,
    nameformat   = {},
    titleformat  = {},
    aftername    = \quad,
    afterindent  = true,
    fixskip      = true,
    beforeskip   = 24pt,
    afterskip    = 24pt,
    lofskip      = 0pt,
    lotskip      = 0pt,
  },
  section = {%
    format       = \zihao{4}\bfseries\heiti,
    afterindent  = true,
    afterskip    = {1ex \@plus .2ex},
  },
  subsection = {%
    format       = \zihao{-4}\bfseries\heiti,
    afterindent  = true,
    afterskip    = {1ex \@plus .2ex},
  },
  subsubsection = {%
    format       = \zihao{-4}\normalfont,
    afterindent  = true,
    afterskip    = {1ex \@plus .2ex},
  },
  paragraph/afterindent    = true,
  subparagraph/afterindent = true,
}
\newlength{\sjtu@headings@indent@fixed}
\setlength{\sjtu@headings@indent@fixed}{2\ccwd}
\newcommand\sjtu@style@set@indent@headings{%
  \ifsjtu@style@indent@headings@fixed
    \sjtu@style@indent@headings@autotrue
    \gdef\sjtu@headings@indent{\sjtu@headings@indent@fixed}
  \else
    \gdef\sjtu@headings@indent{2\ccwd}
  \fi
  \ifsjtu@style@indent@headings@auto
    \ifsjtu@type@graduate\relax\else
      \ctexset{%
        subsubsection/name   = {(,)},
        subsubsection/number = \arabic{subsubsection},
      }
    \fi
  \else
    \gdef\sjtu@headings@indent{\z@}
    \ctexset{%
      subsubsection/name   = {},
      subsubsection/number = \thesubsubsection,
    }
  \fi
  \ctexset{%
    section/indent       = \sjtu@headings@indent,
    subsection/indent    = \sjtu@headings@indent,
    subsubsection/indent = \sjtu@headings@indent,
  }
}
\sjtu@style@set@indent@headings
\sjtu@option@hook{sjtu@style}{indent-headings}{%
  \sjtu@style@set@indent@headings
}
\newcommand\sjtu@indent@box{%
  \hspace*{\ifsjtu@style@indent@headings@auto 2\ccwd\else\z@\fi}%
}
%</class>
%    \end{macrocode}
%
% 本科三级标题格式。
%    \begin{macrocode}
%<*undergraduate>
\ctexset{%
  subsection/format = \zihao{-4}\normalfont,
}
%</undergraduate>
%    \end{macrocode}
%
% \subsubsection{段落}
%
% 全文首行缩进 2 字符，标点符号用全角。
%    \begin{macrocode}
%<*class>
\ctexset{%
  punct          = quanjiao,
  space          = auto,
  autoindent     = true,
}
%    \end{macrocode}
%
% 利用 \pkg{enumitem} 命令调整默认列表环境间的距离，以符合中文习惯。
%    \begin{macrocode}
\setlist{nosep}
\setlist*{leftmargin=*}
\setlist[1]{labelindent=\parindent}
%    \end{macrocode}
%
% \subsubsection{脚注}
%
% 脚注符合中文习惯，数字带圈。
% \begin{macro}{\sjtu@textcircled}
% 生成带圈的脚注数字，最多处理到 50。
%    \begin{macrocode}
\let\footnotemarkfont\@empty
\def\sjtu@num@circled#1{%
  \ifnum#1 <21%
    {\footnotemarkfont\symbol{\the\numexpr#1+"245F\relax}}%
  \else\ifnum#1 <36%
    {\footnotemarkfont\symbol{\the\numexpr#1+"323C\relax}}%
  \else\ifnum#1 <51%
    {\footnotemarkfont\symbol{\the\numexpr#1+"328D\relax}}%
  \else
    \sjtu@warning{Too many footnotes in this page.}%
  \fi\fi\fi
}
\renewcommand{\thefootnote}{\sjtu@num@circled{\c@footnote}}
\renewcommand{\thempfootnote}{\sjtu@num@circled{\c@mpfootnote}}
%    \end{macrocode}
% \end{macro}
%
% 定义脚注悬挂缩进（1.5字符）。
%    \begin{macrocode}
\footnotemargin1.5em\relax
%    \end{macrocode}
%
% 修改 \pkg{footmisc} 定义的脚注格式。
%    \begin{macrocode}
\long\def\@makefntext#1{%
  \ifsjtu@style@footnote@hang
    \bgroup
    \def\@makefnmark{\hbox{\normalfont\@thefnmark}}%
    \setbox\@tempboxa\hbox{%
      \ifdim\footnotemargin>\z@
        \hb@xt@\footnotemargin{\@makefnmark\hss}%
      \else
        \@makefnmark
      \fi
    }%
    \leftmargin\wd\@tempboxa
    \rightmargin\z@
    \linewidth \columnwidth
    \advance \linewidth -\leftmargin
    \parshape \@ne \leftmargin \linewidth
    \footnotesize
    \@setpar{{\@@par}}%
    \leavevmode
    \llap{\box\@tempboxa}%
    \parskip\hangfootparskip\relax
    \parindent\hangfootparindent\relax
  \else
    \parindent 2\ccwd%
    {\normalfont\@thefnmark}
  \fi
  \footnotelayout#1%
  \ifsjtu@style@footnote@hang
    \par\egroup
  \fi
}
%    \end{macrocode}
%
% 设置 url 样式，与上下文一致
%    \begin{macrocode}
\urlstyle{same}
%    \end{macrocode}
%
% 使用 \pkg{xurl} 的方法，增加 URL 可断行的位置。
%    \begin{macrocode}
\g@addto@macro\UrlBreaks{%
  \do0\do1\do2\do3\do4\do5\do6\do7\do8\do9%
  \do\A\do\B\do\C\do\D\do\E\do\F\do\G\do\H\do\I\do\J\do\K\do\L\do\M
  \do\N\do\O\do\P\do\Q\do\R\do\S\do\T\do\U\do\V\do\W\do\X\do\Y\do\Z
  \do\a\do\b\do\c\do\d\do\e\do\f\do\g\do\h\do\i\do\j\do\k\do\l\do\m
  \do\n\do\o\do\p\do\q\do\r\do\s\do\t\do\u\do\v\do\w\do\x\do\y\do\z
}
\Urlmuskip=0mu plus 0.1mu
%    \end{macrocode}
%
% \begin{macro}{\sjtu@chapter}
% 定义一个灵活的 \cs{sjtu@chapter} 专门处理不同的需求。
%
% \cs{sjtu@chapter}\marg{title}\oarg{header}\oarg{pdfbookmark}: 不带星号是出现在目录中的条目；
% title 是章标题；header 是页眉出现的标题，如果忽略则取 title。
%    \begin{macrocode}
\newcommand\sjtu@pdfbookmark[2]{}
\newcommand\sjtu@phantomsection{}
\NewDocumentCommand{\sjtu@chapter}{s O{#3} m O{#2}}{
  \if@openright\cleardoublepage\else\clearpage\fi%
  \IfBooleanTF{#1}{%
    \ifthenelse{\equal{#4}{}}{}{%
      \sjtu@pdfbookmark{0}{#4}%
    }
  }{%
    \sjtu@phantomsection
    \addcontentsline{toc}{chapter}{#4}%
  }%%
  \chapter*{#3}%
  \@mkboth{\MakeUppercase{#2}}{\MakeUppercase{#2}}%
}
%    \end{macrocode}
% \end{macro}
%
% \subsubsection{目录}
%
% 章节编号深度最多 4 层，即: x.x.x.x，对应的命令和层序号分别是：
% \cs{chapter}(0), \cs{section}(1), \cs{subsection}(2), \cs{subsubsection}(3)。
%    \begin{macrocode}
\setcounter{secnumdepth}{3}
\setcounter{tocdepth}{2}
%    \end{macrocode}
%
% \begin{macro}{\tableofcontents}
% \begin{macro}{\listoffigures}
% \begin{macro}{\listoffigures*}
% \begin{macro}{\listoftables}
% \begin{macro}{\listoftables*}
% 目录以及图表索引。
%    \begin{macrocode}
\renewcommand\tableofcontents{%
  \sjtu@chapter*{\contentsname}%
  \@starttoc{toc}%
}
\def\sjtu@listof#1{% #1: float type
  \setcounter{tocdepth}{2} % restore tocdepth in case being modified
  \@ifstar
    {\sjtu@chapter*{\csname list#1name\endcsname}
     \@starttoc{\csname ext@#1\endcsname}}%
    {\sjtu@chapter{\csname list#1name\endcsname}
     \@starttoc{\csname ext@#1\endcsname}}%
}
\renewcommand\listoffigures{\sjtu@listof{figure}}
\renewcommand\listoftables{\sjtu@listof{table}}
%    \end{macrocode}
% \end{macro}
% \end{macro}
% \end{macro}
% \end{macro}
% \end{macro}
%
% 设置目录线样式。
%    \begin{macrocode}
\ifsjtu@lang@zh
  \renewcommand\cftdot{\textperiodcentered}
\fi
\renewcommand\cftdotsep{1}
\setlength{\cftbeforechapskip}{0pt}
\renewcommand\cftchappagefont{\normalfont}
\renewcommand\cftchapleader{\normalfont\cftdotfill{\cftdotsep}}
%</class>
%    \end{macrocode}
%
% 本科与研究生论文设置不同的目录格式。
%    \begin{macrocode}
%<*undergraduate>
\renewcommand\cftchapfont{\normalfont}
%</undergraduate>
%<*graduate>
\renewcommand\cftchapfont{\bfseries\heiti}
%</graduate>
%    \end{macrocode}
%
% 图表索引前加下“图”，“表”关键词。
%    \begin{macrocode}
%<*class>
\renewcommand\cftfigpresnum{\sjtu@name@figure~}
\renewcommand\cfttabpresnum{\sjtu@name@table~}
\AtEndPreamble{%
  \addtolength{\cftfignumwidth}{\widthof{\cftfigpresnum}}
  \addtolength{\cfttabnumwidth}{\widthof{\cfttabpresnum}}
}
%    \end{macrocode}
%
% \subsubsection{浮动对象以及表格}
%
% 下面这组命令使浮动对象的缺省值稍微宽松一点，从而防止幅度对象占据过多的文本页
% 面，也可以防止在很大空白的浮动页上放置很小的图形。
%    \begin{macrocode}
\renewcommand\textfraction{0.15}
\renewcommand\topfraction{0.85}
\renewcommand\bottomfraction{0.65}
\renewcommand\floatpagefraction{0.60}
%    \end{macrocode}
%
% 定义图、表、公式的编号格式。
%    \begin{macrocode}
\AtBeginDocument{%
  \def\thefigure{\thechapter\sjtu@style@fl@num@sep\arabic{figure}}
  \def\p@subfigure{\thefigure}
  \def\thetable{\thechapter\sjtu@style@fl@num@sep\arabic{table}}
  \def\theequation{\thechapter\sjtu@style@eq@num@sep\arabic{equation}}
}
\newcommand\sjtu@counter@without@chapter{
  \counterwithout{section}{chapter}
  \setcounter{section}{0}
  \counterwithout{figure}{chapter}
  \setcounter{figure}{0}
  \counterwithout{table}{chapter}
  \setcounter{table}{0}
}
%    \end{macrocode}
%
% 设置浮动体内的默认字号。
%    \begin{macrocode}
\newif\ifsjtu@set@float@fontsize \sjtu@set@float@fontsizefalse
\sjtu@patchcmd\@floatboxreset%
  {\normalsize}
  {\ifsjtu@set@float@fontsize\zihao{5}\else\normalsize\fi}
\NewDocumentCommand{\SJTUsetfloatfontsize}{}{\sjtu@set@float@fontsizetrue}
\NewDocumentCommand{\SJTUunsetfloatfontsize}{}{\sjtu@set@float@fontsizefalse}
%    \end{macrocode}
%
% 设置双语题注。
%    \begin{macrocode}
\ifsjtu@type@graduate
  \DeclareCaptionFont{sjtu@caption@font}{\zihao{5}\kaishu}
\else
  \DeclareCaptionFont{sjtu@caption@font}{\zihao{5}\bfseries}
\fi
\DeclareCaptionFont{sjtu@subcaption@font}{\zihao{5}\normalfont}
\DeclareCaptionLabelSeparator{enskip}{\enskip}
\captionsetup{%
  format        = plain,
  labelformat   = simple,
  labelsep      = enskip,
  justification = centering,
  font          = sjtu@caption@font
}
\captionsetup[sub]{%
  format        = hang,
  labelformat   = brace,
  justification = justified,
  font          = sjtu@subcaption@font
}
\DeclareCaptionOption{bi-second}[]{%
  \def\tablename{\sjtu@name@table@second}
  \def\figurename{\sjtu@name@figure@second}
}
\captionsetup[bi-second]{bi-second}
%</class>
%    \end{macrocode}
%
% 学士论文模版默认设置。
%    \begin{macrocode}
%<*undergraduate>
\ifsjtu@type@bachelor
  \sjtusetup{
    style = {
      frontmatter-numbering = false,
      indent-headings = fixed,
    },
  }
\fi
%</undergraduate>
%    \end{macrocode}
% \subsubsection{声明}
%
% 支持扫描文件替换。
%    \begin{macrocode}
%<*class>
\newcommand\sjtu@copr@addon{%
  \noindent
  本\sjtu@name@thesis@type 属于\enskip
  \begin{minipage}[t]{28\ccwd}
    \sjtu@square{\bfseries 公开论文} \par
    \sjtu@square{\bfseries 内部论文}，%
      \sjtu@square 1 年/\sjtu@square 2 年/\sjtu@square 3 年\quad%
      解密后适用本授权书。\par
    \sjtu@square{\bfseries 秘密论文}，\underline{\hspace{2\ccwd}}年%
      （不超过10年）解密后适用本授权书。\par
    \sjtu@square{\bfseries 机密论文}，\underline{\hspace{2\ccwd}}年%
      （不超过20年）解密后适用本授权书。\par
    （请在以上方框内打“$\checkmark$”）
  \end{minipage}
}
\newcommand\sjtu@signbox[1]{%
  \begingroup
  \zihao{4}
  \parbox[t]{64mm}{%
    {#1}签名：\\[6pt]
    日期：\hspace{\stretch{3}}年\hspace{\stretch{2}}月\hspace{\stretch{2}}日
  }
  \endgroup
}
\NewDocumentCommand{\copyrightpage}{O{}}{%
  \ifsjtu@review\relax\else
    \cleardoublepage
    \sjtu@pdfbookmark{0}{\sjtu@name@copr@mk}%
    \ifblank{#1}{%
      \newgeometry{
        vmargin = 3cm,
        left    = 3cm,
        right   = 2.5cm,
      }%
      \thispagestyle{empty}
      \begingroup
        \zihao{-4}\linespread{1.73}\selectfont
        \begin{center}
          \heiti\zihao{3}
          \sjtu@name@school@zh\par
          \sjtu@name@thesis@type\sjtu@name@orig@title@zh
        \end{center}\par
        \sjtu@name@orig@body\par
        \vskip \baselineskip \hfill
        \sjtu@signbox{\sjtu@name@thesis@type 作者}
        \hspace*{20mm}\par
        \vskip 2\baselineskip
        \begin{center}
          \heiti\zihao{3}
          \sjtu@name@school@zh\par
          \sjtu@name@thesis@type\sjtu@name@copr@title@zh
        \end{center}\par
        \sjtu@name@copr@body\par
        \vskip \baselineskip
        \sjtu@copr@addon\par
        \vskip 1.5\baselineskip
        \sjtu@signbox{\sjtu@name@thesis@type 作者}\hfill
        \sjtu@signbox{指导教师}\par
        \endgroup
      \restoregeometry
    }{\includepdf[pages=-]{#1}}
  \fi
}
%    \end{macrocode}
%
% \subsubsection{各种环境}
%
% 定义保存环境内容的命令。
%    \begin{macrocode}
\newcommand\sjtu@save@env@body[1]{\long\gdef\sjtu@saved@env@body{#1}}
%</class>
%    \end{macrocode}
%
% 定义摘要环境，本科与研究生论文的摘要样式要求略有不同。
%    \begin{macrocode}
%<*(undergraduate|graduate)>
\NewDocumentEnvironment{abstract}{}{%
  \sjtu@chapter*[\sjtu@name@abstract@zh]{%
    \sjtu@info@title@zh \vskip 2ex
    \begingroup
%<undergraduate>      \zihao{4}
      \sjtu@name@abstract@zh
    \endgroup
  }[\sjtu@name@abstract]%
}{%
  \vskip \baselineskip \noindent
  \begingroup
%<undergraduate>    \zihao{-4}
    \heiti\sjtu@name@keywords@zh
  \endgroup
  \begingroup
%<undergraduate>    \zihao{5}
    \sjtu@clist@use{\sjtu@info@keywords@zh}{，}
  \endgroup
}
%    \end{macrocode}
%
% 英文摘要。
%    \begin{macrocode}
\NewDocumentEnvironment{abstract*}{}{%
  \sjtu@chapter*[\sjtu@name@abstract@en]{%
    \MakeUppercase\sjtu@info@title@en \vskip 2ex
    \begingroup
%<undergraduate>      \zihao{4}
      \MakeUppercase\sjtu@name@abstract@en
    \endgroup
  }[]
%<graduate>  \zihao{4}
}{%
  \vskip 3ex \noindent
  \begingroup
%<undergraduate>    \zihao{-4}\bfseries
%<graduate>    \bfseries\MakeUppercase
    \sjtu@name@keywords@en
  \endgroup
  \begingroup
%<undergraduate>    \zihao{5}
    \sjtu@clist@use{\sjtu@info@keywords@en}{, }
  \endgroup
}
%</(undergraduate|graduate)>
%    \end{macrocode}
%
% \subsubsection{缩略语对照表}
%
%    \begin{macrocode}
%<*class>
\NewDocumentEnvironment{abbreviation}{}{%
  \sjtu@chapter{\sjtu@name@abbreviation}
}{}
\NewDocumentEnvironment{abbreviation*}{}{%
  \sjtu@chapter*{\sjtu@name@abbreviation}
}{}
%    \end{macrocode}
%
% \subsubsection{符号对照表}
%
%    \begin{macrocode}
\NewDocumentEnvironment{nomenclature}{}{%
  \sjtu@chapter{\sjtu@name@nom}
}{}
\NewDocumentEnvironment{nomenclature*}{}{%
  \sjtu@chapter*{\sjtu@name@nom}
}{}
%    \end{macrocode}
%
% \subsubsection{全文总结}
%
%    \begin{macrocode}
\NewDocumentEnvironment{summary}{}{%
  \sjtu@chapter{\sjtu@name@summary}
}{}
%    \end{macrocode}
%
% \subsubsection{致谢}
%
% 定义致谢环境，盲审模式下隐藏致谢。
%    \begin{macrocode}
\NewDocumentEnvironment{acknowledgements}{}{%
  \Collect@Body\sjtu@save@env@body
}{%
  \ifsjtu@review\relax\else
    \sjtu@chapter{\sjtu@name@ack}
    \sjtu@saved@env@body
  \fi
}
%    \end{macrocode}
%
% \subsubsection{附录}
%
% 定义附录使用的列表环境，使用和参考文献列表相同的样式。
%    \begin{macrocode}
\newcounter{sjtu@bib}
\NewDocumentEnvironment{@bibliolist}{m}{%
  \list{\@biblabel{\@arabic\c@sjtu@bib}}%
       {\settowidth\labelwidth{\@biblabel{#1}}%
        \leftmargin\labelwidth
        \advance\leftmargin\labelsep
        \@nmbrlisttrue
        \def\@listctr{sjtu@bib}
        \let\p@sjtu@bib\@empty
        \renewcommand\thesjtu@bib{\@arabic\c@sjtu@bib}}%
  \sloppy
  \clubpenalty4000
  \@clubpenalty \clubpenalty
  \widowpenalty4000%
  \sfcode`\.\@m
}{%
  \def\@noitemerr
    {\@latex@warning{Empty `bibliolist' environment}}%
  \endlist
}
\NewDocumentEnvironment{bibliolist}{m}{%
  \Collect@Body\sjtu@save@env@body
}{%
  \ifsjtu@review\relax\else
    \begin{@bibliolist}{#1}
      \sjtu@saved@env@body
    \end{@bibliolist}
  \fi
}
\NewDocumentEnvironment{bibliolist*}{m}{%
  \Collect@Body\sjtu@save@env@body
}{%
  \ifsjtu@review
    \begin{@bibliolist}{#1}
      \sjtu@saved@env@body
    \end{@bibliolist}
  \fi
}
%    \end{macrocode}
%
% 科研成果环境。
%    \begin{macrocode}
\NewDocumentEnvironment{achievements}{}{%
  \sjtu@chapter{\sjtu@name@achv}
}{}
%    \end{macrocode}
%
% 定义简历环境。
%    \begin{macrocode}
\NewDocumentEnvironment{resume}{}{%
  \Collect@Body\sjtu@save@env@body
}{%
  \ifsjtu@review\relax\else
    \sjtu@chapter{\sjtu@name@resume}
    \sjtu@saved@env@body
  \fi
}
%    \end{macrocode}
%
% 本科论文大摘要。
%    \begin{macrocode}
\NewDocumentEnvironment{digest}{}{%
  \Collect@Body\sjtu@save@env@body
}{%
  \ifsjtu@type@bachelor
    \AtEndDocument{%
      \cleardoublepage
      \pagenumbering{roman}
      \def\sjtu@thepage{\theCurrentPageLocal}
      \def\sjtu@lastpageref{\lastpageref{pagesLTS.roman.local}}
      \sjtu@chapter*[\sjtu@name@digest]{\MakeUppercase\sjtu@info@title@sec}
      \sjtu@counter@without@chapter
      \let\addcontentsline\@gobblethree
      \sjtu@saved@env@body
    }
  \fi
}
%    \end{macrocode}
%
% \subsubsection{盲审模式}
%
% 盲审模式下隐藏作者、导师姓名等信息。
%    \begin{macrocode}
\AtEndPreamble{
  \ifsjtu@review%
    \sjtusetup{%
      info = {
        author          = {},
        author*         = {},
        id              = {},
        supervisor      = {},
        supervisor*     = {},
        assisupervisor  = {},
        assisupervisor* = {},
      }
    }
  \fi
}
%    \end{macrocode}
%
% \begin{macro}{\encrypt}
% 定义盲审模式工具宏\cs{encrypt}：
%    \begin{macrocode}
\NewDocumentCommand{\encrypt}{m O{***}}{%
  \ifsjtu@review
    {#2}
  \else
    {#1}
  \fi
}
%    \end{macrocode}
% \end{macro}
%
% \subsubsection{封面}
%
% 定义一个特殊的下划线命令供绘制本科论文封面时使用。
%    \begin{macrocode}
\newcommand\sjtu@title@box[2][]{%
  \def\sjtu@@title@uline{\rule[-1ex]{#1}{.5pt}}%
  \def\sjtu@@title@box##1{\parbox[t]{#1}{##1}}%
  \newlength\sjtu@@title@temp@ht
  \settototalheight\sjtu@@title@temp@ht{\sjtu@@title@box{#2}}%
  \ifdim\sjtu@@title@temp@ht=0pt%
    \sjtu@@title@uline%
  \else
    \leavevmode%
    \ifdim\sjtu@@title@temp@ht>\normalbaselineskip
      \rlap{\smash{\sjtu@@title@box{%
        \@whiledim\sjtu@@title@temp@ht>0pt%
        \leavevmode%
        \do{%
          \rlap{\sjtu@@title@uline}\\%
          \addtolength\sjtu@@title@temp@ht{-\normalbaselineskip}%
        }%
      }}}%
      \sjtu@@title@box{\centering #2}%
    \else
      \rlap{\sjtu@@title@uline}%
      \sjtu@@title@box{\centering #2}%
    \fi
  \fi
}
%    \end{macrocode}
%
% 表格中汉字分散对齐。
%    \begin{macrocode}
\newcolumntype{F}[2]{%
  >{\minipage[#1]{#2}%
    \ifXeTeX\def\CJKglue{\hskip \z@ plus 1filll}\fi%
    \ifLuaTeX\ltjsetparameter{kanjiskip=\z@ plus 1filll}\fi%
    \begingroup}%
    c%
  <{\endgroup%
    \endminipage%
    \ignorespacesafterend}}
%</class>
%    \end{macrocode}
%
% 绘制封面
%    \begin{macrocode}
%<*(undergraduate|graduate)>
\RenewDocumentCommand{\maketitle}{}{%
  \sjtu@pdfbookmark{0}{\sjtu@name@titlepage}
  \sjtu@make@titlepage@zh%
%<graduate>  \sjtu@make@titlepage@en%
}
\newcommand\sjtu@make@titlepage@zh{%
  \cleardoublepage
%<*undergraduate>
  \thispagestyle{empty}
  \begin{center}
    \kaishu
    \vspace*{48pt}
    \begingroup
      \includegraphics[height=105pt]%
        {sjtu-vi-name-\sjtu@style@title@logo@color.pdf}
      \par
    \endgroup
    {\fontsize{32}{42}\selectfont\sjtu@name@subject@zh\par}
    \vskip 6pt
    {\zihao{-2}\MakeUppercase\sjtu@name@subject@en\par}
    \vskip 16pt
    \begingroup
      \includegraphics[height=75pt]%
        {sjtu-vi-badge-\sjtu@style@title@logo@color.pdf}
      \par
    \endgroup
    \vskip \stretch{2}
    \begingroup
      \zihao{-2}
      \begin{tabular}{@{}r@{\sjtu@colon}l@{}}
        论文题目 & \sjtu@title@box[300pt]{\sjtu@info@display@title@zh}
      \end{tabular}
      \par
    \endgroup
    \vskip \stretch{1}
    \begingroup
      \zihao{3}
      \begin{tabular}{@{}F{t}{4.2\ccwd}@{\sjtu@colon}c@{}}
        \sjtu@name@author@zh      & \sjtu@info@author@zh      \\\cline{2-2}
        \sjtu@name@id@zh          & \makebox[180pt]{\sjtu@info@id} \\\cline{2-2}
        \ifsjtu@type@course
          \sjtu@name@course@zh    & \sjtu@info@course@zh      \\\cline{2-2}
        \else
          \sjtu@name@major@zh     & \sjtu@info@major@zh       \\\cline{2-2}
        \fi
        \sjtu@name@supervisor@zh  & \sjtu@info@supervisor@zh  \\\cline{2-2}
        \sjtu@name@department@zh  & \sjtu@info@department@zh  \\\cline{2-2}
      \end{tabular}
      \par
    \endgroup
    \vskip 64pt
%</undergraduate>
%<*graduate>
  \def\sjtu@info@fund{\zihao{-5}\sjtu@clist@use{\sjtu@info@fund@zh}{\par}}
  \thispagestyle{title}
  \begin{center}
    \vspace*{28pt}
    {\zihao{-2}\sjtu@name@subject@zh\par}
    \vskip \stretch{4}
    {\zihao{2}\heiti\sjtu@info@display@title@zh\par}
    \vskip \stretch{5}
    \begingroup
      \zihao{4}
      \def\arraystretch{1.25}
      \begin{tabular}{@{}>{\heiti}F{t}{6.5\ccwd}@{\sjtu@colon}l@{}}
        \sjtu@name@author@zh           & \sjtu@info@author@zh         \\
        \sjtu@name@id@zh               & \sjtu@info@id                \\
        \sjtu@name@supervisor@zh       & \sjtu@info@supervisor@zh     \\
        \ifx\sjtu@info@assisupervisor@zh\@empty\else
          \sjtu@name@assisupervisor@zh & \sjtu@info@assisupervisor@zh \\
        \fi
        \sjtu@name@degree@zh           & \sjtu@info@degree@zh         \\
        \sjtu@name@major@zh            & \sjtu@info@major@zh          \\
        \sjtu@name@department@zh       & \sjtu@info@department@zh     \\
        \sjtu@name@defenddate@zh       &
          \sjtu@date{\sjtu@date@format@zh}{\sjtu@info@date}           \\
        \sjtu@name@conferring@zh       & \sjtu@name@school@zh         \\
      \end{tabular}
      \par
    \endgroup
    \vskip 26pt
%</graduate>
  \end{center}
}
%<*graduate>
\newcommand\sjtu@make@titlepage@en{%
  \cleardoublepage
  \def\sjtu@info@fund{\zihao{-5}\sjtu@clist@use{\sjtu@info@fund@en}{\par}}
  \thispagestyle{title}
  \begin{center}
    \vspace*{28pt}
    {\zihao{-2}\sjtu@name@subject@en\par}
    \vskip \stretch{4}
    {\zihao{2}\bfseries\MakeUppercase\sjtu@info@display@title@en\par}
    \vskip \stretch{5}
    \begingroup
      \zihao{4}
      \def\arraystretch{1.25}
      \begin{tabular}{@{}>{\bfseries}l<{:~}@{}p{.45\textwidth}@{}}
        \sjtu@name@author@en           & \sjtu@info@author@en         \\
        \sjtu@name@id@en               & \sjtu@info@id                \\
        \sjtu@name@supervisor@en       & \sjtu@info@supervisor@en     \\
        \ifx\sjtu@info@assisupervisor@en\@empty\else
          \sjtu@name@assisupervisor@en & \sjtu@info@assisupervisor@en \\
        \fi
        \sjtu@name@degree@en           & \sjtu@info@degree@en         \\
        \sjtu@name@major@en            & \sjtu@info@major@en          \\
        \sjtu@name@department@en       & \sjtu@info@department@en     \\
        \sjtu@name@defenddate@en       &
          \sjtu@date{\sjtu@date@format@en}{\sjtu@info@date}           \\
        \sjtu@name@conferring@en       & \sjtu@name@school@en         \\
      \end{tabular}
      \par
    \endgroup
    \vskip 26pt
  \end{center}
}
%</graduate>
%</(undergraduate|graduate)>
%    \end{macrocode}
%
% \subsection{其他宏包的设置}
%
% 这些宏包并非格式要求，但是为了方便同学们使用，在这里进行简单设置。
% \subsubsection{\pkg{hyperref} 宏包}
%
%    \begin{macrocode}
%<*class>
\AtEndOfPackageFile*{hyperref}{
  \hypersetup{
    linktoc            = all,
    bookmarksdepth     = 2,
    bookmarksnumbered  = true,
    bookmarksopen      = true,
    bookmarksopenlevel = 1,
    unicode            = true,
    psdextra           = true,
    breaklinks         = true,
    plainpages         = false,
    pdfdisplaydoctitle = true,
    hidelinks,
  }
  \newcounter{sjtu@bookmark}
  \renewcommand\sjtu@pdfbookmark[2]{%
    \phantomsection
    \stepcounter{sjtu@bookmark}%
    \pdfbookmark[#1]{#2}{sjtuchapter.\thesjtu@bookmark}%
  }
  \renewcommand\sjtu@phantomsection{%
    \phantomsection
  }
  \pdfstringdefDisableCommands{%
    \let\\\@empty
    \let\quad\@empty
    \let\hspace\@gobble
  }
%    \end{macrocode}
%
% \pkg{hyperref} 与 \pkg{unicode-math} 存在一些兼容性问题，见
% \href{https://github.com/ustctug/ustcthesis/issues/223}{%
%   ustctug/ustcthesis\#223}，
% \href{https://github.com/ho-tex/hyperref/pull/90}{ho-tex/hyperref\#90} 和
% \href{https://github.com/ustctug/ustcthesis/issues/235}{%
%   ustctug/ustcthesis/\#235}。
%    \begin{macrocode}
  \@ifpackagelater{hyperref}{2019/04/27}{}{%
    \g@addto@macro\psdmapshortnames{\let\mu\textmu}
  }%
  \AtBeginDocument{%
    \hypersetup{
      pdftitle    = \sjtu@info@title,
      pdfsubject  = \sjtu@name@subject,
      pdfkeywords = \sjtu@info@keywords,
      pdfauthor   = \sjtu@info@author,
      pdfcreator  = {LaTeX with SJTUThesis \version}
    }
  }%
}
%    \end{macrocode}
%
% \subsubsection{\pkg{threeparttable} 宏包}
%
%    \begin{macrocode}
\AtEndOfPackageFile*{threeparttable}{
  \appto\TPTnoteSettings{\footnotesize}
}
%    \end{macrocode}
%
% \subsubsection{\pkg{longtable} 宏包}
%
%    \begin{macrocode}
\AtEndOfPackageFile*{longtable}{
  \BeforeBeginEnvironment{longtable}
    {\begingroup\ifsjtu@set@float@fontsize\zihao{5}\fi}
  \AfterEndEnvironment{longtable}
    {\endgroup}
}
%    \end{macrocode}
%
% \subsubsection{\pkg{unicode-math} 宏包}
%
%    \begin{macrocode}
\AtEndOfPackageFile*{unicode-math}{
  \unimathsetup{
    math-style = ISO,
    bold-style = ISO,
    nabla      = upright,
  }
%    \end{macrocode}
%
% \begin{macro}{\bm}
% \begin{macro}{\boldsymbol}
% 兼容旧的粗体命令：\pkg{bm} 的 \cs{bm} 和 \pkg{amsmath} 的 \cs{boldsymbol}。
%    \begin{macrocode}
  \newcommand{\bm}{\symbf}
  \renewcommand{\boldsymbol}{\symbf}
%    \end{macrocode}
% \end{macro}
% \end{macro}
%
% \begin{macro}{\square}
% 兼容 \pkg{amssymb} 中的命令。
%    \begin{macrocode}
  \newcommand{\square}{\mdlgwhtsquare}
}
%    \end{macrocode}
% \end{macro}
%
% \subsubsection{\pkg{physics} 宏包}
%
%    \begin{macrocode}
\AtEndOfPackageFile*{physics}{
  \@ifundefined{updelta}{}{
    \DeclareDocumentCommand\variation{o g d()}{
      \IfNoValueTF{#2}{
        \IfNoValueTF{#3}
          {\updelta \IfNoValueTF{#1}{}{^{#1}}}
          {\mathinner{\updelta \IfNoValueTF{#1}{}{^{#1}}\argopen(#3\argclose)}}
        }
        {\mathinner{\updelta \IfNoValueTF{#1}{}{^{#1}}#2} \IfNoValueTF{#3}{}{(#3)}}
    }
  }
}
%    \end{macrocode}
%
% \subsubsection{\pkg{siunitx} 宏包}
%
%    \begin{macrocode}
\AtEndOfPackageFile*{siunitx}{
  \sisetup{
    group-minimum-digits = 4,
    separate-uncertainty = true,
    inter-unit-product   = \ensuremath{{}\cdot{}},
  }
  \ifsjtu@lang@zh
    \sisetup{
      list-final-separator = { 和 },
      list-pair-separator  = { 和 },
      range-phrase         = {～},
    }
  \fi
}
%    \end{macrocode}
%
% \subsubsection{\pkg{ntheorem} 宏包和 \pkg{amsthm} 宏包}
%
%    \begin{macrocode}
\newcommand\sjtu@def@theorem{%
  \newtheorem{assumption} {\sjtu@name@assumption} [chapter]
  \newtheorem{axiom}      {\sjtu@name@axiom}      [chapter]
  \newtheorem{conjecture} {\sjtu@name@conjecture} [chapter]
  \newtheorem{corollary}  {\sjtu@name@corollary}  [chapter]
  \newtheorem{definition} {\sjtu@name@definition} [chapter]
  \newtheorem{example}    {\sjtu@name@example}    [chapter]
  \newtheorem{exercise}   {\sjtu@name@exercise}   [chapter]
  \newtheorem{lemma}      {\sjtu@name@lemma}      [chapter]
  \newtheorem{problem}    {\sjtu@name@problem}    [chapter]
  \newtheorem{proposition}{\sjtu@name@proposition}[chapter]
  \newtheorem{theorem}    {\sjtu@name@theorem}    [chapter]
  \newtheorem*{remark}    {\sjtu@name@remark}
  \newtheorem*{solution}  {\sjtu@name@solution}
}
%    \end{macrocode}
%
% \pkg{ntheorem} 宏包
%    \begin{macrocode}
\PassOptionsToPackage{amsmath,thmmarks,hyperref}{ntheorem}
\AtEndOfPackageFile*{ntheorem}{
  \theoremheaderfont{\sjtu@indent@box\bfseries\heiti}
  \theorembodyfont{\normalfont}
  \theoremseparator{\enskip}
  \theoremsymbol{\ensuremath{\square}}
  \newtheorem*{proof}{\sjtu@name@proof}
  \theoremstyle{plain}
  \theoremsymbol{}
  \ifsjtu@nothm\else
    \sjtu@def@theorem
  \fi
}
%    \end{macrocode}
%
% \pkg{amsthm} 宏包
%    \begin{macrocode}
\AtBeginOfPackageFile*{amsthm}{
  \newif\ifsjtu@openbox@defined
  \@ifundefined{openbox}{
    \sjtu@openbox@definedfalse
  }{
    \sjtu@openbox@definedtrue
    \let\oldopenbox\openbox
    \let\openbox\@undefined
  }
}
\AtEndOfPackageFile*{amsthm}{
  \ifsjtu@openbox@defined
    \let\openbox\oldopenbox
  \fi
  \let\sjtu@thmhead\thmhead@plain
  \def\thmhead@plain{\sjtu@indent@box\sjtu@thmhead}
  \newtheoremstyle{sjtuplain}
    {}{}
    {\normalfont}{}
    {\bfseries\heiti}{}
    {\ccwd}{}
  \theoremstyle{sjtuplain}
  \ifsjtu@nothm\else
    \sjtu@def@theorem
  \fi
  \renewcommand\proofname\sjtu@name@proof
  \renewenvironment{proof}[1][\proofname]{\par
    \pushQED{\qed}%
    \normalfont \topsep6\p@\@plus6\p@\relax
    \trivlist
    \item\relax
      {\sjtu@indent@box\bfseries\heiti #1~}
      \hspace\labelsep\ignorespaces
  }{%
    \popQED\endtrivlist\@endpefalse
  }
}
%    \end{macrocode}
%
% \subsubsection{\pkg{algorithm2e} 宏包}
%
%    \begin{macrocode}
\PassOptionsToPackage{algochapter}{algorithm2e}
\AtBeginOfPackageFile*{algorithm2e}{
  \let\old@chapter\@chapter
}
\AtEndOfPackageFile*{algorithm2e}{
  \let\@chapter\old@chapter
  \SetAlgorithmName{\sjtu@name@algorithm}%
                   {\sjtu@name@algorithm}%
                   {\sjtu@name@listalgorithm}
  \SetAlgoCaptionSeparator{~}
  \def\listalgocfname{\listalgorithmcfname}
  \newlistof{alg}{loa}{\listalgocfname}
  \let\l@algocf\l@alg
  \setlength{\cftalgindent}{1.5em}
  \setlength{\cftalgnumwidth}{2.3em}
  \renewcommand\cftalgpresnum{\sjtu@name@algorithm~}
  \apptocmd{\sjtu@counter@without@chapter}{%
    \counterwithout{algocf}{chapter}
    \setcounter{algocf}{0}
  }{}{}
  \sjtu@patchcmd\algocf@latexcaption%
    {\addcontentsline}
    {\caption@iflist{\addcontentsline}{\@gobblethree}}
  \AtEndPreamble{%
    \addtolength{\cftalgnumwidth}{\widthof{\cftalgpresnum}}
  }
  \renewcommand\listofalgorithms{\sjtu@listof{algocf}}
  \AtBeginDocument{%
    \def\thealgocf{\thechapter\sjtu@style@fl@num@sep\arabic{algocf}}
  }
}
%    \end{macrocode}
%
% \subsubsection{\pkg{algorithm} 宏包}
%
%    \begin{macrocode}
\PassOptionsToPackage{chapter}{algorithm}
\AtEndOfPackageFile*{algorithm}{
  \floatname{algorithm}{\sjtu@name@algorithm}
  \def\listalgorithmname{\sjtu@name@listalgorithm}
  \newlistof{alg}{loa}{\listalgorithmname}
  \let\l@algorithm\l@alg
  \setlength{\cftalgindent}{1.5em}
  \setlength{\cftalgnumwidth}{2.3em}
  \renewcommand\cftalgpresnum{\sjtu@name@algorithm~}
  \apptocmd{\sjtu@counter@without@chapter}{%
    \counterwithout{algorithm}{chapter}
    \setcounter{algorithm}{0}
  }{}{}
  \AtEndPreamble{%
    \addtolength{\cftalgnumwidth}{\widthof{\cftalgpresnum}}
  }
  \renewcommand\listofalgorithms{\sjtu@listof{algorithm}}
  \AtBeginDocument{%
    \def\thealgorithm{\thechapter\sjtu@style@fl@num@sep\arabic{algorithm}}
  }
}
%    \end{macrocode}
%
% \subsubsection{\pkg{listings} 宏包}
%
%    \begin{macrocode}
\AtEndOfPackageFile*{listings}{
  \lstdefinestyle{lstStyleCode}{
    aboveskip=\medskipamount,
    belowskip=\medskipamount,
    basicstyle=\ttfamily\zihao{6},
    commentstyle=\slshape\color{black!60},
    stringstyle=\color{green!40!black!100},
    keywordstyle=\bfseries\color{blue!50!black},
    extendedchars=false,
    upquote=true,
    tabsize=2,
    showstringspaces=false,
    xleftmargin=1em,
    xrightmargin=1em,
    breaklines=false,
    framexleftmargin=1em,
    framexrightmargin=1em,
    backgroundcolor=\color{gray!10},
    columns=flexible,
    keepspaces=true,
    texcl=true,
    mathescape=true
  }
}
%</class>
%    \end{macrocode}
%
% \iffalse
%    \begin{macrocode}
%<*document>
\DeclareOption*{\PassOptionsToClass{\CurrentOption}{ltxdoc}}
\PassOptionsToClass{a4paper}{ltxdoc}
\ProcessOptions
\LoadClass{ltxdoc}
\RequirePackage{expl3}
\RequirePackage[UTF8, scheme=chinese]{ctex}
\RequirePackage{etoolbox}
\RequirePackage{booktabs}
\RequirePackage{caption}
\RequirePackage{geometry}
\RequirePackage{fontspec}
\RequirePackage{unicode-math}
\RequirePackage{array}
\RequirePackage{threeparttable}
\RequirePackage{graphicx}
\RequirePackage{hologo}
\RequirePackage{listings}
\RequirePackage{xcolor,xcolor-material}
\RequirePackage{hypdoc}
\geometry{
  vmargin = 30mm,
  hmargin = {40mm, 20mm},
  headsep = 3mm
}
\setmainfont{LibertinusSerif}[%
  Extension      = .otf,
  UprightFont    = *-Regular,
  BoldFont       = *-Bold,
  ItalicFont     = *-Italic,
  BoldItalicFont = *-BoldItalic,
  Scale          = 1.1]
\setsansfont{IBMPlexSansCondensed}[%
  Extension      = .otf,
  UprightFont    = *-Regular,
  BoldFont       = *-Bold,
  ItalicFont     = *-Italic,
  BoldItalicFont = *-BoldItalic]
\setmathfont{LibertinusMath-Regular.otf}
\ctexset{
  abstractname   = 简介,
}
\hypersetup{
  allcolors         = blue,
  bookmarksnumbered = true,
  bookmarksopen     = true,
}
\AtEndOfClass{\sloppy}
\definecolor{sjtublue}{cmyk}{1,0.8,0,0}
\definecolor{MaterialGrey}{HTML}{9E9E9E}
\lstdefinestyle{style@base}{
  basewidth       = 0.5 em,
  gobble          = 2,
  lineskip        = 2 pt,
  frame           = l,
  framerule       = 1 pt,
  framesep        = 0 pt,
  escapeinside    = {(*}{*)},
  basicstyle      = \ttfamily\color{MaterialGrey900},
  keywordstyle    = \bfseries\color{MaterialIndigo},
  commentstyle    = \itshape\color{MaterialGrey600},
  stringstyle     = \color{MaterialRed},
  backgroundcolor = \color{MaterialGrey50},
  xleftmargin       = 1em,
  xrightmargin      = 1em,
  framexleftmargin  = 1em,
  framexrightmargin = 1em
}
\lstdefinestyle{style@shell}{
  style      = style@base,
  rulecolor  = \color{MaterialPink},
  language   = bash,
  alsoletter = {-},
  emphstyle  = \color{MaterialGreen800}
}
\lstdefinestyle{style@latex}{
  style      = style@base,
  rulecolor  = \color{MaterialIndigo},
  language   = [LaTeX]TeX,
  alsoletter = {*, -},
  texcsstyle = *\color{MaterialDeepOrange},
  emphstyle  = [1]\color{MaterialGreen800},
  emphstyle  = [2]\color{MaterialTeal}
}
\lstdefinestyle{style@syntax}{
  basewidth     = 0.5 em,
  gobble        = 6,
  escapeinside  = {(*}{*)},
  language      = [LaTeX]TeX,
  alsoletter    = {*, -},
  belowskip     = 0pt,
  basicstyle    = \small\ttfamily\color{MaterialGrey900},
  keywordstyle  = \bfseries\color{MaterialIndigo},
  commentstyle  = \itshape\color{MaterialGrey600},
  texcsstyle    = *\color{MaterialDeepOrange},
  emphstyle     = [1]\color{MaterialGreen800},
  emphstyle     = [2]\color{MaterialTeal}
}
\newcommand\shellcmd[1]{\colorbox{\color{gray!10}}{\lstinline[style=lstStyleShell]|#1|}}
\lstnewenvironment{shell}[1][]{%
  \lstset{style=style@shell, #1}}{}
\lstnewenvironment{latex}[1][]{%
  \lstset{style=style@latex, #1}}{}
\lstnewenvironment{sjtusyntax}[1][]{%
  \lstset{style=style@syntax, #1}\vspace{-4ex}}{}
\newcommand\note[1]{{%
\color{magenta}{\noindent\bfseries 说明：}\emph{#1}}}
\def\TeX{\hologo{TeX}}
\def\TeXLive{\TeX{} Live}
\def\macTeX{Mac\TeX{}}
\def\LaTeX{\hologo{LaTeX}}
\def\BibLaTeX{\textsc{Bib}\LaTeX}
\def\CJKLaTeX{CJK--\LaTeX}
\def\XeTeX{\hologo{XeTeX}}
\def\XeLaTeX{\hologo{XeLaTeX}}
\def\LuaLaTeX{\hologo{LuaLaTeX}}
\DeclareRobustCommand\file{\nolinkurl}
\DeclareRobustCommand\env{\texttt}
\DeclareRobustCommand\pkg{\textsf}
\DeclareRobustCommand\cls{\textsf}
\DeclareRobustCommand\opt{\texttt}
\def\DescribeFunction{\vspace{1ex}\noindent\DescribeMacro}
\renewcommand\glossaryname{版本历史}
\GlossaryPrologue{\section*{\glossaryname}}
\let\old@meta\meta
\renewcommand*\meta[1]{\texttt{\old@meta{#1}}}
\renewcommand*\marg[1]{\{\meta{#1}\}}
\renewcommand*\oarg[1]{[\meta{#1}]}
\renewcommand*\parg[1]{(\meta{#1})}
\DeclareDocumentCommand\opt{m}{\texttt{#1}}
\DeclareDocumentCommand\kvopt{mm}
  {\texttt{#1\breakablethinspace=\breakablethinspace#2}}
\def\breakablethinspace{\hskip 0.16667em\relax}
\def\syntaxopt#1{\textit{#1}}
\def\defaultval#1{\textbf{\textup{#1}}}
\def\syntaxopt@aux#1>{\syntaxopt{#1}}
\def\defaultval@aux#1){\defaultval{#1}}
\def\orbar{\textup{\textbar}}
\appto\TPTnoteSettings{\footnotesize}
\ExplSyntaxOn
\AtBeginEnvironment { sjtusyntax }
  {
    \cs_set:Npn \lparen { \textup { ( } }
    \cs_set:Npn \rparen { \textup { ) } }
    \char_set_catcode_active:N |
    \char_set_catcode_active:N <
    \char_set_catcode_active:N (
    \char_set_active_eq:NN | \orbar
    \char_set_active_eq:NN < \syntaxopt@aux
    \char_set_active_eq:NN ( \defaultval@aux
  }
\DeclareDocumentCommand \StopSpecialIndexModule { }
  { \cs_set_eq:NN \__codedoc_special_index_module:nnnnN \use_none:nnnnn }
\cs_new_eq:NN \__sjtudoc_ltx_changes:nnn \changes@
\cs_set_protected:Npn \changes@ #1#2
  {
    \tl_if_empty:nTF {#1}
      { \__sjtudoc_ltx_changes:nnn }
      { \__sjtudoc_version_zfill:wnnn #1 \q_stop }
      {#1} {#2}
  }
\cs_new_protected:Npn \__sjtudoc_version_zfill:wnnn #1#2 \q_stop
  {
    \str_if_eq:nnTF {#1} { v }
      { \__sjtudoc_version_zfill:nnnn {#2} }
      { \__sjtudoc_ltx_changes:nnn }
  }
\cs_new_protected:Npn \__sjtudoc_version_zfill:nnnn #1#2
  {
    \tl_clear:N \l__sjtudoc_tmp_tl
    \int_zero:N \l_tmpa_int
    \seq_set_split:Nnn \l_tmpa_seq { . } {#1}
    \seq_map_function:NN \l_tmpa_seq \__sjtudoc_version_zfill:n
    \int_compare:nNnF \l_tmpa_int > 2
      {
        \tl_put_right:Nx \l__sjtudoc_tmp_tl
          { \prg_replicate:nn { 3 - \l_tmpa_int } { 00000 } }
      }
    \__sjtudoc_ltx_changes:nnn { \l__sjtudoc_tmp_tl \actualchar #2 }
  }
\tl_new:N \l__sjtudoc_tmp_tl
\cs_new_protected:Npn \__sjtudoc_version_zfill:n #1
  {
    \int_incr:N \l_tmpa_int
    \tl_put_right:Nx \l__sjtudoc_tmp_tl
      {
        \prg_replicate:nn
          { \int_max:nn { 0 } { 5 - \tl_count:n {#1} } } { 0 }
        \exp_not:n {#1}
      }
  }
\ExplSyntaxOff
\renewcommand\indexname{命令索引}
\IndexPrologue{%
  \section*{\indexname}
  \textit{意大利体的数字表示描述对应索引项的页码；%
    带下划线的数字表示定义对应索引项的代码行号；%
    罗马字体的数字表示使用对应索引项的代码行号。}%
}
%</document>
%    \end{macrocode}
% \fi
%
% \Finale
%
\endinput
