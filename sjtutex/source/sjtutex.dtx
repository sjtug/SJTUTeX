% \iffalse meta-comment
%
% Copyright (C) SJTUG
%   2018--2023 Alexara Wu   <alexarawu@outlook.com>
%   2022--2023 Log Creative <logcreative@outlook.com>
%
% This work may be distributed and/or modified under the
% conditions of the LaTeX Project Public License, either
% version 1.3c of this license or (at your option) any later
% version. The latest version of this license is in:
%
%   http://www.latex-project.org/lppl.txt
%
% and version 1.3 or later is part of all distributions of
% LaTeX version 2005/12/01 or later.
%
% This work has the LPPL maintenance status `maintained'.
%
% The Current Maintainers of this work are Alexara Wu and Log Creative.
%
%<*internal>
\iffalse
%</internal>
%
%<*internal>
\fi
\begingroup
  \def\NameOfLaTeXe{LaTeX2e}
\expandafter\endgroup\ifx\NameOfLaTeXe\fmtname\else
\csname fi\endcsname
%</internal>
%
%<*install>
\input l3docstrip.tex
\keepsilent
\askforoverwritefalse

\preamble

    Copyright (C) SJTUG
      2018--2023 Alexara Wu   <alexarawu@outlook.com>
      2022--2023 Log Creative <logcreative@outlook.com>

    This work may be distributed and/or modified under the
    conditions of the LaTeX Project Public License, either
    version 1.3c of this license or (at your option) any later
    version. The latest version of this license is in:

      http://www.latex-project.org/lppl.txt

    and version 1.3 or later is part of all distributions of
    LaTeX version 2005/12/01 or later.

    This work has the LPPL maintenance status `maintained'.

    The Current Maintainers of this work are Alexara Wu and Log Creative.

\endpreamble

\generate{
  \usedir{tex/latex/sjtutex}
    \file{sjtuthesis.cls}            {\from{\jobname.dtx}{class,thesis}}
    \file{sjtureport.cls}            {\from{\jobname.dtx}{class,report}}
    \file{sjtuarticle.cls}           {\from{\jobname.dtx}{class,article}}
    \file{sjtu-name-thesis.cfg}      {\from{\jobname.dtx}{name,thesis}}
    \file{sjtu-name-generic.cfg}     {\from{\jobname.dtx}{name,generic}}
    \file{sjtu-lang-thesis-zh.cfg}   {\from{\jobname.dtx}{lang,thesis,zh}}
    \file{sjtu-lang-thesis-en.cfg}   {\from{\jobname.dtx}{lang,thesis,en}}
    \file{sjtu-lang-report-zh.cfg}   {\from{\jobname.dtx}{lang,report,zh}}
    \file{sjtu-lang-report-en.cfg}   {\from{\jobname.dtx}{lang,report,en}}
    \file{sjtu-lang-article-zh.cfg}  {\from{\jobname.dtx}{lang,article,zh}}
    \file{sjtu-lang-article-en.cfg}  {\from{\jobname.dtx}{lang,article,en}}
    \file{sjtu-text-font-newtx.def}  {\from{\jobname.dtx}{font,text,newtx}}
    \file{sjtu-text-font-newpx.def}  {\from{\jobname.dtx}{font,text,newpx}}
    \file{sjtu-text-font-lm.def}     {\from{\jobname.dtx}{font,text,lm}}
    \file{sjtu-text-font-stixtwo.def}{\from{\jobname.dtx}{font,text,stixtwo}}
    \file{sjtu-text-font-xits.def}   {\from{\jobname.dtx}{font,text,xits}}
    \file{sjtu-text-font-newcm.def}  {\from{\jobname.dtx}{font,text,newcm}}
    \file{sjtu-text-font-cambria.def}{\from{\jobname.dtx}{font,text,cambria}}
    \file{sjtu-text-font-times.def}  {\from{\jobname.dtx}{font,text,times}}
    \file{sjtu-math-font-newtx.def}  {\from{\jobname.dtx}{font,math,newtx}}
    \file{sjtu-math-font-newpx.def}  {\from{\jobname.dtx}{font,math,newpx}}
    \file{sjtu-math-font-lm.def}     {\from{\jobname.dtx}{font,math,lm}}
    \file{sjtu-math-font-stixtwo.def}{\from{\jobname.dtx}{font,math,stixtwo}}
    \file{sjtu-math-font-xits.def}   {\from{\jobname.dtx}{font,math,xits}}
    \file{sjtu-math-font-newcm.def}  {\from{\jobname.dtx}{font,math,newcm}}
    \file{sjtu-math-font-cambria.def}{\from{\jobname.dtx}{font,math,cambria}}
    \file{sjtu-math-font-times.def}  {\from{\jobname.dtx}{font,math,times}}
    \file{sjtu-cjk-font-windows.def} {\from{\jobname.dtx}{font,cjk,windows}}
    \file{sjtu-cjk-font-mac.def}     {\from{\jobname.dtx}{font,cjk,mac}}
    \file{sjtu-cjk-font-ubuntu.def}  {\from{\jobname.dtx}{font,cjk,ubuntu}}
    \file{sjtu-cjk-font-adobe.def}   {\from{\jobname.dtx}{font,cjk,adobe}}
    \file{sjtu-cjk-font-fandol.def}  {\from{\jobname.dtx}{font,cjk,fandol}}
    \file{sjtu-cjk-font-founder.def} {\from{\jobname.dtx}{font,cjk,founder}}
%</install>
%<*internal>
  \usedir{source/latex/sjtutex}
    \file{\jobname.ins}              {\from{\jobname.dtx}{install}}
%</internal>
%<*install>
}

\obeyspaces
\Msg{*************************************************************}
\Msg{*                                                           *}
\Msg{* To finish the installation you have to move the following *}
\Msg{* files into a directory searched by TeX:                   *}
\Msg{*                                                           *}
\Msg{* The recommended directory is TDS:tex/latex/sjtutex        *}
\Msg{*                                                           *}
\Msg{*     sjtuthesis.cls                                        *}
\Msg{*     sjtureport.cls                                        *}
\Msg{*     sjtuarticle.cls                                       *}
\Msg{*     ...                                                   *}
\Msg{*                                                           *}
\Msg{* To produce the documentation, run the file sjtutex.dtx    *}
\Msg{* through XeLaTeX.                                          *}
\Msg{*                                                           *}
\Msg{* Happy TeXing!                                             *}
\Msg{*                                                           *}
\Msg{*************************************************************}

\endbatchfile
%</install>
%
%<*internal>
\fi
%</internal>
%
%<class>\NeedsTeXFormat{LaTeX2e}
%<class>\RequirePackage{expl3}
%<*!(driver|install)>
%<+!driver>\GetIdInfo $Id: sjtutex.dtx 2.0-beta 2023-01-06 17:30:00Z Alexara Wu <alexarawu@outlook.com> $
%<class&thesis>  {Thesis template for Shanghai Jiao Tong University}
%<class&thesis>\ProvidesExplClass{sjtuthesis}
%<class&report>  {Report template for Shanghai Jiao Tong University}
%<class&report>\ProvidesExplClass{sjtureport}
%<class&article>  {Article template for Shanghai Jiao Tong University}
%<class&article>\ProvidesExplClass{sjtuarticle}
%<name&thesis>  {Name config for thesis template (SJTUTeX)}
%<name&thesis>\ProvidesExplFile{sjtu-name-thesis.cfg}
%<name&generic>  {Generic name config (SJTUTeX)}
%<name&generic>\ProvidesExplFile{sjtu-name-generic.cfg}
%<lang&thesis&zh>  {SJTUThesis Chinese config (SJTUTeX)}
%<lang&thesis&zh>\ProvidesExplFile{sjtu-lang-thesis-zh.cfg}
%<lang&thesis&en>  {SJTUThesis English config (SJTUTeX)}
%<lang&thesis&en>\ProvidesExplFile{sjtu-lang-thesis-en.cfg}
%<lang&report&zh>  {SJTUReport Chinese config (SJTUTeX)}
%<lang&report&zh>\ProvidesExplFile{sjtu-lang-report-zh.cfg}
%<lang&report&en>  {SJTUReport English config (SJTUTeX)}
%<lang&report&en>\ProvidesExplFile{sjtu-lang-report-en.cfg}
%<lang&article&zh>  {SJTUArticle Chinese config (SJTUTeX)}
%<lang&article&zh>\ProvidesExplFile{sjtu-lang-article-zh.cfg}
%<lang&article&en>  {SJTUArticle English config (SJTUTeX)}
%<lang&article&en>\ProvidesExplFile{sjtu-lang-article-en.cfg}
%<font&text&newtx>  {New TX text fonts definition (SJTUTeX)}
%<font&text&newtx>\ProvidesExplFile{sjtu-text-font-newtx.def}
%<font&text&newpx>  {New PX text fonts definition (SJTUTeX)}
%<font&text&newpx>\ProvidesExplFile{sjtu-text-font-newpx.def}
%<font&text&stixtwo>  {STIX Two text fonts definition (SJTUTeX)}
%<font&text&stixtwo>\ProvidesExplFile{sjtu-text-font-stixtwo.def}
%<font&text&xits>  {XITS text fonts definition (SJTUTeX)}
%<font&text&xits>\ProvidesExplFile{sjtu-text-font-xits.def}
%<font&text&lm>  {Latin Modern text fonts definition (SJTUTeX)}
%<font&text&lm>\ProvidesExplFile{sjtu-text-font-lm.def}
%<font&text&newcm>  {New Computer Modern text fonts definition (SJTUTeX)}
%<font&text&newcm>\ProvidesExplFile{sjtu-text-font-newcm.def}
%<font&text&cambria>  {Cambria text fonts definition (SJTUTeX)}
%<font&text&cambria>\ProvidesExplFile{sjtu-text-font-cambria.def}
%<font&text&times>  {Times text fonts definition (SJTUTeX)}
%<font&text&times>\ProvidesExplFile{sjtu-text-font-times.def}
%<font&math&newtx>  {New TX math fonts definition (SJTUTeX)}
%<font&math&newtx>\ProvidesExplFile{sjtu-math-font-newtx.def}
%<font&math&newpx>  {New PX math fonts definition (SJTUTeX)}
%<font&math&newpx>\ProvidesExplFile{sjtu-math-font-newpx.def}
%<font&math&stixtwo>  {STIX Two math fonts definition (SJTUTeX)}
%<font&math&stixtwo>\ProvidesExplFile{sjtu-math-font-stixtwo.def}
%<font&math&xits>  {XITS math fonts definition (SJTUTeX)}
%<font&math&xits>\ProvidesExplFile{sjtu-math-font-xits.def}
%<font&math&lm>  {Latin Modern math fonts definition (SJTUTeX)}
%<font&math&lm>\ProvidesExplFile{sjtu-math-font-lm.def}
%<font&math&newcm>  {New Computer Modern math fonts definition (SJTUTeX)}
%<font&math&newcm>\ProvidesExplFile{sjtu-math-font-newcm.def}
%<font&math&cambria>  {Cambria math fonts definition (SJTUTeX)}
%<font&math&cambria>\ProvidesExplFile{sjtu-math-font-cambria.def}
%<font&math&times>  {Times math fonts definition (SJTUTeX)}
%<font&math&times>\ProvidesExplFile{sjtu-math-font-times.def}
%<font&cjk&windows>  {Windows CJK fonts definition (SJTUTeX)}
%<font&cjk&windows>\ProvidesExplFile{sjtu-cjk-font-windows.def}
%<font&cjk&mac>  {macOS CJK fonts definition (SJTUTeX)}
%<font&cjk&mac>\ProvidesExplFile{sjtu-cjk-font-mac.def}
%<font&cjk&ubuntu>  {Ubuntu CJK fonts definition (SJTUTeX)}
%<font&cjk&ubuntu>\ProvidesExplFile{sjtu-cjk-font-ubuntu.def}
%<font&cjk&adobe>  {Adobe CJK fonts definition (SJTUTeX)}
%<font&cjk&adobe>\ProvidesExplFile{sjtu-cjk-font-adobe.def}
%<font&cjk&fandol>  {Fandol CJK fonts definition (SJTUTeX)}
%<font&cjk&fandol>\ProvidesExplFile{sjtu-cjk-font-fandol.def}
%<font&cjk&founder>  {Founder CJK fonts definition (SJTUTeX)}
%<font&cjk&founder>\ProvidesExplFile{sjtu-cjk-font-founder.def}
%<!driver>  {\ExplFileDate}{\ExplFileVersion}{\ExplFileDescription}
%</!(driver|install)>
%
%<*driver>
\documentclass{ctxdoc}
\newcommand{\sjtutex}{SJTU\TeX}
\usepackage{graphicx}
\usepackage{multirow}
\usepackage{listings}
\hypersetup{
  allcolors         = blue,
  bookmarksnumbered = true,
  bookmarksopen     = true,
}
\AtEndOfClass{\sloppy}
\definecolor{sjtuRedPrimary}{RGB}{167,32,56}         % engred
\definecolor{sjtuRedSecondary}{RGB}{240,131,0}       % orange
\definecolor{sjtuRedTertiary}{RGB}{253,208,0}        % yellow
\definecolor{sjtuBluePrimary}{RGB}{0,64,152}         % problue
\definecolor{sjtuBlueSecondary}{RGB}{51,141,39}      % lightgreen
\definecolor{sjtuBlueTertiary}{RGB}{0,81,78}         % lightgray
\lstdefinestyle{style@base}{
  basewidth       = 0.5 em,
  gobble          = 2,
  lineskip        = 2 pt,
  frame           = l,
  framerule       = 1 pt,
  framesep        = 0 pt,
  escapeinside    = {(*}{*)},
  basicstyle      = \ttfamily,
  keywordstyle    = \bfseries\color{sjtuBluePrimary},
  commentstyle    = \itshape\color{sjtuBlueTertiary!60},
  stringstyle     = \color{sjtuRedPrimary},
  backgroundcolor = \color{sjtuBlueTertiary!2},
  xleftmargin       = 1em,
  xrightmargin      = 1em,
  framexleftmargin  = 1em,
  framexrightmargin = 1em
}
\lstdefinestyle{style@shell}{
  style      = style@base,
  rulecolor  = \color{sjtuBlueTertiary},
  language   = bash,
  alsoletter = {-},
  emphstyle  = \color{sjtuBlueSecondary}
}
\lstdefinestyle{style@latex}{
  style      = style@base,
  rulecolor  = \color{sjtuBluePrimary},
  language   = [LaTeX]TeX,
  alsoletter = {*, -},
  texcsstyle = *\color{sjtuBluePrimary},
  emphstyle  = [1]\color{sjtuBluePrimary!80},
  emphstyle  = [2]\color{sjtuBlueSecondary}
}
\lstdefinestyle{style@syntax}{
  basewidth     = 0.5 em,
  gobble        = 6,
  escapeinside  = {(*}{*)},
  language      = [LaTeX]TeX,
  alsoletter    = {*, -},
  belowskip     = 0pt,
  basicstyle    = \ttfamily,
  keywordstyle  = \bfseries\color{sjtuBluePrimary},
  commentstyle  = \itshape\color{sjtuBlueTertiary!60},
  texcsstyle    = *\color{sjtuBluePrimary},
  emphstyle     = [1]\color{sjtuBluePrimary!80},
  emphstyle     = [2]\color{sjtuBlueSecondary}
}
\newcommand\shellcmd[1]{%
  \colorbox{\color{gray!10}}{\lstinline[style=lstStyleShell]|#1|}}
\lstnewenvironment{shell}[1][]{%
  \lstset{style=style@shell, #1}}{}
\lstnewenvironment{latex}[1][]{%
  \lstset{style=style@latex, #1}}{}
\lstnewenvironment{sjtusyntax}[1][]{%
  \lstset{style=style@syntax, #1}\vspace{-1.8ex}}{}
\newcommand\note[1]{{%
  \color{sjtuBlueTertiary}{\noindent\bfseries 说明：}~\emph{#1}}}
\DeclareDocumentCommand\kvopt{mm}
  {\texttt{#1\breakablethinspace=\breakablethinspace#2}}
\def\breakablethinspace{\hskip 0.16667em\relax}
\makeatletter
\let\old@meta\meta
\renewcommand*\meta[1]{\texttt{\old@meta{#1}}}
\renewcommand*\marg[1]{\{\meta{#1}\}}
\renewcommand*\oarg[1]{[\meta{#1}]}
\renewcommand*\parg[1]{(\meta{#1})}
\def\syntaxopt#1{\textit{#1}}
\def\defaultval#1{\textbf{\textup{#1}}}
\def\syntaxopt@aux#1>{\syntaxopt{#1}}
\def\defaultval@aux#1){\defaultval{#1}}
\def\orbar{\textup{\textbar}}
\ExplSyntaxOn
\AtBeginEnvironment { sjtusyntax }
  {
    \cs_set:Npn \lparen { \textup { ( } }
    \cs_set:Npn \rparen { \textup { ) } }
    \char_set_catcode_active:N |
    \char_set_catcode_active:N <
    \char_set_catcode_active:N (
    \char_set_active_eq:NN | \orbar
    \char_set_active_eq:NN < \syntaxopt@aux
    \char_set_active_eq:NN ( \defaultval@aux
  }
\ExplSyntaxOff
\makeatother
\begin{document}
  \DocInput{\jobname.dtx}
  \IndexLayout
  \PrintChanges
  \PrintIndex
\end{document}
%</driver>
% \fi
%
% \GetFileInfo{\jobname.dtx}
%
% \title{\sjtutex{}: 上海交通大学文档类集}
% \author{SJTUG}
% \date{2023/1/6\quad v2.0-beta}
%
% \maketitle
%
% \begin{abstract}
% 此宏包旨在建立一个简单易用的上海交通大学文档类集，包括学位论文文档类
% \cls{sjtuthesis} 以及普通文档类 \cls{sjtuarticle} 和 \cls{sjtureport}。
% \end{abstract}
%
% \def\abstractname{免责声明}
% \begin{abstract}
% \noindent
% \begin{enumerate}
% \item 本模板的发布遵守 \LaTeX{} Project Public License，使用前请认真阅读
%   协议内容。
% \item 学位论文模板根据 \href{https://www.gs.sjtu.edu.cn/info/1143/5801.htm}
%   {《上海交通大学博士、硕士学位论文撰写指南》} ，并参考
%   \href{https://www.gs.sjtu.edu.cn/info/1136/8374.htm}
%   {《上海交通大学研究生学位论文写作模板》} 以及
%   \href{https://bysj.jwc.sjtu.edu.cn/MoreNews.aspx?NewsType=zUcuaM8R5+lJLruDxDS/Fw....&TypeName=I/SElbms0OT5ZkmE84uuGg....}
%   {《上海交通大学本科生毕业设计（论文）撰写规范》}
%   编写而成。旨在供上海交通大学准毕业生撰
%   写学位论文使用。
% \item 学位论文模板仅为撰写指南的参考实现，不保证审查老师不提意见。任何由于使用本模板
%   而引起的论文格式审查问题均与本模板作者无关。
% \item 任何个人或组织以本模板为基础进行修改、扩展而生成的新的专用模板，请严格遵
%   守  \LaTeX{} Project Public License 协议。由于违犯协议而引起的任何纠纷
%   争端均与本模板作者无关。
% \end{enumerate}
% \end{abstract}
%
% \tableofcontents
%
% \begin{documentation}
%
% \section{介绍}
%
% 最早的一版 \LaTeX{} 学位论文模板由一位热心的物理系同学制作，中文字符处理采用了当时最为流行的
% CJK--\LaTeX{} 方案。在此基础上，weijianwen 根据交大研究生院对学位论文的要求，完成
% 了一份基本可用的交大 \LaTeX{} 学位论文模板。由于 CJK--\LaTeX{} 方案不易使用，
% weijianwen 与 William Wang 开始着手把模板向 \XeTeX{} 引擎移植。之后 weijianwen
% 又断断续续做了一些完善模板的工作，在原有硕士学位论文模板的基础上完成了交大学士
% 和博士学位论文模板。
%
% 2012 年 5 月模板开始在 GitHub%
% \footnote{\url{https://github.com/weijianwen/SJTUThesis}，项目转移后该链接已重定向。}%
% 上管理和更新，2018 年 1 月项目转移至 SJTUG 名
% 下。2019 年 6 月 Alexara Wu 重构了整个宏包的代码，并使用 Doc\TeX{} 文档和
% \textsc{DocStrip} 工具进行代码的管理，升级版本号为 1.0。2022 年 11 月，论文模板
% 改版后，使用 \LaTeXiii{} 重构了代码，添加 \cls{sjtureport} 和 \cls{sjtuarticle}
% 文档类，升级版本号为 2.0。
%
% 现在，\sjtutex{} 代码在 GitHub%
% \footnote{\url{https://github.com/sjtug/SJTUTeX}}%
% 上维护。
% 原 \href{https://github.com/sjtug/SJTUThesis}{SJTUThesis} 仓库则作为学位论文示例文档，提供开箱即用的模板。
% 学位论文模板用户可以在 \href{https://github.com/sjtug/SJTUThesis/discussions}{Discussions}
% 上提问使用问题，也可以在 \href{https://github.com/sjtug/SJTUThesis/issues}{Issues}
% 中进行 Bug 反馈与新功能提案。如果需要对文档类代码进行修改，欢迎前往
% \href{https://github.com/sjtug/SJTUTeX}{\sjtutex} 仓库进行 Pull Request。
% \sjtutex{} 模板的许多实现细节离不开
% \href{https://github.com/sjtug/SJTUThesis/graphs/contributors}
% {热心同学们} 的贡献，在此感谢所有为模板贡献过代码的同学们，以及所有测试和使用
% 模板的各位同学！
%
% \note{模板的作用在于减少论文写作过程中格式调整的时间，前提是遵守模板的用法，否
%   则即便用了\sjtutex{} 也难以保证输出的论文符合学校规范。}
%
% \section{简明教程}
%
% \subsection{安装 \TeX{} 发行版}
%
% 因为 \LaTeXiii{} 和相关宏包在不断更新，所以推荐使用最新的 \TeX{} 发行版。
% \sjtutex{} 支持主流的 \TeX{} 发行版，包括 \TeX{} Live、\hologo{MiKTeX}、
% Mac\TeX{}，但不支持 \CTeX{} 套装。安装方法具体可以参考
% \href{https://github.com/sjtug/SJTUThesis/wiki/TeX-发行版及其安装}
% {Wiki 页面《\TeX{} 发行版及其安装》}。
%
% \sjtutex{} 最低支持至 2020 年发行的 \TeX{} 发行版，\pkg{ctex} 宏包版本应当在
% v2.5 及以上。版本过低将无法正常编译。
%
% \subsection{文件组成}
%
% 表~\ref{tab:files} 列出了 \sjtutex{} 的主要文件及其功能介绍。
%
% \begin{table}[!hbt]
%   \centering
%   \caption{模板的文件组成}
%   \label{tab:files}
%   \begin{tabular}{l|l|p{4cm}}
%     \toprule
%     \strong{类别} & \strong{文件}               & \strong{说明}  \\
%     \midrule
%     文档类        & \file{sjtuthesis.cls}       & 学位论文文档类 \\
%                   & \file{sjtureport.cls}       & 报告文档类     \\
%                   & \file{sjtuarticle.cls}      & 文稿文档类     \\
%                   & \file{sjtu-*.cfg}           & 文档类配置     \\
%     \midrule
%     视觉形象系统  & \file{sjtu-vi-logo-*.pdf}   & 校标图片       \\
%                   & \file{sjtu-vi-badge-*.pdf}  & 校徽图片       \\
%                   & \file{sjtu-vi-name-*.pdf}   & 校名图片       \\
%     \midrule
%     字体配置文件  & \file{sjtu-cjk-font-*.def}  & 中文字体配置   \\
%                   & \file{sjtu-math-font-*.def} &  数学字体配置  \\
%                   & \file{sjtu-text-font-*.def} &  正文字体配置  \\
%
%     \bottomrule
%   \end{tabular}
% \end{table}
%
% \note{\href{https://vi.sjtu.edu.cn}{交大视觉形象系统}
%   的相关图像资源版权归上海交通大学所有。}
%
% \subsection{使用文档类}
%
% 共有 3 种文档类，\cls{sjtuthesis} 用于学位论文的排版，\cls{sjtureport} 用于课程大报告的排版，
% \cls{sjtuarticle} 用于课程小论文的排版。
%
% 将文档保存在下载好的 \sjtutex{} 模板根目录下，文件以 \texttt{.tex} 后缀结尾。
% 注意在使用文档类时，需要将涉及到的所有源文件使用 UTF-8 编码保存。对于不同的文档类，使用方法
% 略有不同，这里给出这三种文档类的最小使用示例。
%
% 下面这份 \TeX{} 文档展示了 \cls{sjtuthesis} 文档类的基本用法，一般需要指定中英文名称。
% 该文档将包含中英文封面，页眉左上角显示“上海交通大学硕士学位论文”，右上角显示章节名称。
% \begin{latex}
% \documentclass[type=master]{sjtuthesis}
% \sjtusetup{
%   info = {
%     title   = {上海交通大学学位论文 \LaTeX{} 模板示例文档},
%     title*  = {A Sample Document for \LaTeX-based SJTU Thesis Template},
%     author  = {某\quad{}某},
%     author* = {Mo Mo},
%   }
% }
% \begin{document}
%   \maketitle
%   \frontmatter
%   \mainmatter
%   \chapter{欢迎}
%   \section{欢迎使用 SJTUThesis}
%   你好，\LaTeX{}!
% \end{document}
% \end{latex}
%
% 下面这份 \TeX{} 文档展示了 \cls{sjtureport} 文档类的基本用法，只需要指定中文名称。
% 该文档将包含中文封面，页眉左上角为校徽校名，右上角为章节名称。
% \begin{latex}
% \documentclass{sjtureport}
% \sjtusetup{
%   info = {
%     title   = {上海交通大学 \LaTeX{} 报告模板示例文档},
%     author  = {某\quad{}某},
%     subject = {XX课程期末论文}
%   }
% }
% \begin{document}
%   \maketitle
%   \chapter{欢迎}
%   \section{欢迎使用 SJTUReport}
%   你好，\LaTeX{}!
% \end{document}
% \end{latex}
%
% 下面这份 \TeX{} 文档展示了 \cls{sjtuarticle} 文档类的基本用法，建议使用标准命令定义中文名称，
% 不能够使用 \cs{chapter} 这一级。该文档包含标题栏，页眉左上角为校徽校名，右上角为文档标题。
% \begin{latex}
% \documentclass{sjtuarticle}
% \title{示例文档}
% \author{某某}
% \begin{document}
%   \maketitle
%   \section{欢迎使用 SJTUArticle}
%   你好，\LaTeX{}!
% \end{document}
% \end{latex}
%
% \section{文档配置}
%
% 本模板中的选项、命令或环境可以分为以下三类：
% \begin{itemize}
%   \item 名字后面带有 \rexptarget\rexpstar{} 的，表示只能在 \cls{sjtuthesis} 文档类中使用；
%   \item 名字后面带有 \exptarget\expstar{} 的，表示使用范围区别于 \cls{sjtuarticle}；
%   \item 名字后面不带有特殊符号的，一般表示在 \cls{sjtuthesis}、\cls{sjtureport} 和 \cls{sjtuarticle} 文档类中都可以使用，特殊情况另作说明。
% \end{itemize}
%
% \subsection{文档类选项}
%
% 本节所指“文档类选项”是指需要在引入文档类的时候指定的选项:
%
% \begin{latex}
% \documentclass(*\oarg{文档类选项}*){sjtuthesis}
% \end{latex}
%
% 部分选项采用 \kvopt{\meta{key}}{\meta{value}} 的形式。当 \meta{value} 省略时，
% 将采用默认值。在下文的说明中，将用\textbf{粗体}表示默认值。
%
% \subsubsection{通用选项}
%
% \begin{function}[rEXP,updated=2022-12-03]{type}
%   \begin{sjtusyntax}[emph={[1]type}]
%     type = (*<bachelor|(master)|doctor>*)
%   \end{sjtusyntax}
%   论文类型。三种选项分别代表学士学位论文、硕士学位论文、博士学位论文。
% \end{function}
%
% \begin{function}{lang}
%   \begin{sjtusyntax}[emph={[1]lang}]
%     lang = (*<(zh)|en>*)
%   \end{sjtusyntax}
%   论文主要语言。可选中文或英文，该选项会改变文档中的一些标题的名字。
% \end{function}
%
% \begin{function}{draft, final}
%   是否开启草稿模式。
%   \opt{draft} 开启草稿模式，所有的图片将不会被加载，超过边界的区域将会被涂上黑色色块。
%   \opt{final} 关闭草稿模式。
%   默认为 \opt{final}。
% \end{function}
%
% \begin{function}[rEXP]{review}
%   盲审模式。开启盲审模式将隐去作者姓名、导师姓名、班级、学号等个人信息，
%   删去版权使用授权书、原创性声明和致谢页。默认关闭。
% \end{function}
%
% \subsubsection{页面设置}
%
% \begin{function}[updated=2022-12-18]{zihao}
%   \begin{sjtusyntax}[emph={[1]zihao}]
%     zihao = (*<(-4)|5>*)
%   \end{sjtusyntax}
%   论文默认字号，可以设定为小四号或五号。
%   \begin{itemize}
%     \item 在 \cls{sjtuthesis} 和 \cls{sjtureport} 文档类中默认为小四号;
%     \item 在 \cls{sjtuarticle} 文档类中默认为五号。
%   \end{itemize}
% \end{function}
%
% \begin{function}[added=2022-12-03]{lineskip}
%   \begin{sjtusyntax}[emph={[1]lineskip}]
%     lineskip = (*\marg{长度}*)
%   \end{sjtusyntax}
%   行间距。默认跟随字号设置。
% \end{function}
%
% \begin{function}{oneside, twoside}
%   指明论文的单双面模式。
%   \opt{oneside} 为单面模式，
%   \opt{twoside} 为双面模式。
%   \begin{itemize}
%     \item 在 \cls{sjtuthesis} 文档类中，默认为 \opt{twoside}。
%     \item 在 \cls{sjtureport} 和 \cls{sjtuarticle} 文档类中，默认为 \opt{oneside}。
%   \end{itemize}
% \end{function}
%
% \begin{function}[EXP]{openright, openany}
%   指明论文是否奇数页开章。
%   \opt{openright} 为从奇数页开始新章，
%   \opt{openany} 为从任意页开始新章。
%   \begin{itemize}
%     \item 在 \cls{sjtuthesis} 文档类中，默认为 \opt{openright}。
%     \item 在 \cls{sjtureport} 文档类中，默认为 \opt{openany}。
%     \item 在 \cls{sjtuarticle} 文档类中，该选项不可用。
%   \end{itemize}
% \end{function}
%
% \begin{function}[added=2022-12-23]{titlepage, notitlepage}
%   指明论文的标题形式。
%   \opt{titlepage} 为使用标题页。
%   \opt{notitlepage} 为使用标题块。
%   \begin{itemize}
%     \item 在 \cls{sjtuthesis} 文档类中，该选项不可用，只能使用标题页。
%     \item 在 \cls{sjtureport} 文档类中，默认为 \opt{titlepage}。
%     \item 在 \cls{sjtuarticle} 文档类中，默认为 \opt{notitlepage}。
%   \end{itemize}
% \end{function}
%
% \subsubsection{字体选项}
% \label{sec:fontsetup}
%
% \begin{function}{cjk-font}
%   \begin{sjtusyntax}[emph={[1]cjk-font}]
%     cjk-font = (*<(auto)|(fandol)|windows|mac|ubuntu|adobe|founder|none>*)
%   \end{sjtusyntax}
%   指定中文字体集。\sjtutex{} 预定义了一些中文字体组合，
%   默认跟随操作系统设定：
%   Windows 系统默认使用 \opt{windows}，
%   macOS 系统默认使用 \opt{mac}，
%   Linux 系统默认使用 \opt{fandol}。
%   找不到对应定义的中文字体集时的回退选项为 \opt{fandol}。
%
%   \textbf{仅} |windows| 和 |founder| 字体集支持 \pdfLaTeX{} 直接生成 PDF。
%   其他中文字体集使用 \pdfTeX{} 引擎需要先通过 \LaTeX{} 生成 DVI，
%   然后再使用 DVIPDFM\textit{x} 转换为 PDF。
%
%   \note{发行版中自带的 \opt{fandol} 中文字库容易出现缺字的情况。
%     我们建议 Linux 用户自行配置合适的字体。参见
%     \href{https://github.com/sjtug/SJTUThesis/wiki/在线使用说明}
%     {Wiki 页面《在线使用说明》}。}
% \end{function}
%
% \begin{function}{text-font}
%   \begin{sjtusyntax}[emph={[1]text-font}]
%     text-font = (*<(newtx)|times|stixtwo|xits|newpx|cambria|newcm|lm|none>*)
%   \end{sjtusyntax}
%   指定西文字体集。\sjtutex{} 预定义了一些西文字体组合，
%   具体配置见表 \ref{tab:latinfonts}。
%   找不到定义的西文字体集时的回退选项为 \opt{newtx}。
% \end{function}
%
% \begin{function}{math-font}
%   \begin{sjtusyntax}[emph={[1]math-font}]
%     math-font = (*<(auto)|(newtx)|stixtwo|xits|newpx|cambria|newcm|lm|none>*)
%   \end{sjtusyntax}
%   指定数学字体集。\sjtutex{} 预定义了一些数学字体组合，
%   具体配置见表 \ref{tab:latinfonts} 数学字体列。
%   默认跟随西文字体 \opt{text-font} 的设置。
%   找不到定义的数学字体集时的回退选项为 \opt{newtx}。
%
%   \opt{xits}，\opt{newcm}，\opt{cambria} 选项仅支持 \XeLaTeX/\LuaLaTeX{} 编译。
% \end{function}
%
% \begin{table}[ht]
% \centering\small
% \begin{threeparttable}
%   \caption{西文字体与数学字体配置}
%   \label{tab:latinfonts}
%   \begin{tabular}{ccccc}
%     \toprule
%       & \strong{正文字体} & \strong{无衬线字体} & \strong{等宽字体} & \strong{数学字体} \\
%     \midrule
%       |newtx|                  & TG Termes X\tnote{a}     & TG Heros    & TG Cursor   & newtx         \\
%       \multirow{2}{*}{|times|} & Times New Roman\tnote{b} & Arial       & Courier New & \multirow{2}{*}{mathptmx} \\
%                                & Times\tnote{c}           & Helvetica   & Courier     &               \\
%       |stixtwo|                & STIX Two Text            & TG Heros    & TG Cursor   & STIX Two Math \\
%       |xits|                   & XITS                     & TG Heros    & TG Cursor   & XITS Math     \\
%       |newpx|                  & TG Pagella X             & TG Heros    & TG Cursor   & newpx         \\
%       |cambria|                & Cambria                  & Calibri     & Consolas    & Cambria Math  \\
%       |newcm|                  & New CM\tnote{d}          & New CM Sans & New CM Mono & New CM        \\
%       |lm|                     & LM Roman\tnote{e}        & LM Sans     & LM Mono     & LM Math       \\
%     \bottomrule
%   \end{tabular}
%   \begin{tablenotes}
%     \item[a] “TG”是 TeX Gyre 的缩写。
%     \item[b] 本行中，Times New Roman、Arial 和 Courier New 是商业字体，
%       在 Windows 和 macOS 系统上均默认安装。
%     \item[c] 使用 \pdfTeX{} 引擎时，实际使用对应字体的 Type 1 开源版本。
%     \item[d] “CM”是 Computer Modern 的缩写。
%     \item[e] “LM”是 Latin Modern 的缩写。
%   \end{tablenotes}
% \end{threeparttable}
% \end{table}
%
% \begin{function}[added=2022-12-03,updated=2023-01-05]{math-style}
%   \begin{sjtusyntax}[emph={[1]math-style}]
%     math-style = (*<(ISO)|TeX>*)
%   \end{sjtusyntax}
%   数学符号样式。该选项将影响 \opt{uppercase-greek}、\opt{integral}、
%   \opt{integral-limits} 选项。
%   默认遵循 ISO 80000-2 标准设置，即斜体的大写希腊字母、直立的积分号
%   以及积分号上下限置于上下方。
%   用户也可以逐项修改数学样式。
% \end{function}
%
% \begin{function}[added=2023-01-05]{uppercase-greek}
%   \begin{sjtusyntax}[emph={[1]uppercase-greek}]
%     uppercase-greek = (*<slanted|upright>*)
%   \end{sjtusyntax}
%   大写希腊字母的正/斜体。
% \end{function}
%
% \begin{function}[added=2023-01-05]{integral}
%   \begin{sjtusyntax}[emph={[1]integral}]
%     integral = (*<slanted|upright>*)
%   \end{sjtusyntax}
%   积分号的正/斜体。
% \end{function}
%
% \begin{function}[added=2023-01-05]{integral-limits}
%   \begin{sjtusyntax}[emph={[1]integral-limits}]
%     integral-limits = (*<true|false>*)
%   \end{sjtusyntax}
%   行间公式中积分号上下限的位置，
%   \opt{true} 使得上下限在积分号上下方，
%   \opt{false} 使得上下限在积分号右侧。
%   该选项只影响行间公式，行内公式统一居右侧，不受影响。
% \end{function}
%
% \subsection{论文信息设置}
%
% \begin{function}{\sjtusetup}
%   \begin{sjtusyntax}[morekeywords={\sjtusetup}]
%     \sjtusetup(*\marg{键值列表}*)
%   \end{sjtusyntax}
%   本模板提供了一系列选项，可由您自行配置。载入文档类之后，以下
%   所有选项均可通过统一的命令 \cs{sjtusetup} 来设置。
% \end{function}
%
% \cs{sjtusetup} 的参数是一组由（英文）逗号隔开的选项列表，列表中的选项通常是
% \kvopt{\meta{key}}{\meta{value}} 的形式。对于同一项，后面的设置将会覆盖前面的
% 设置。在下文的说明中，将用\textbf{粗体}表示默认值。\cs{sjtusetup} 支持不同类型
% 以及多种层次的选项设定。键值列表中，“|=|”左右的空格不影响设置；但需注意，参数
% 列表中不可以出现空行。
%
% \begin{latex}[morekeywords={\sjtusetup}]
% \sjtusetup{
%   info = {
%     title        = {上海交通大学学位论文 \LaTeX{} 模板示例文档},
%     title*       = {A Sample Document for \LaTeX-based SJTU Thesis Template},
%     author       = {某\quad{}某},
%     author*      = {Mo Mo},
%   },
%   style = {
%     float-numsep = {--},
%   },
%   name = {
%     achv         = {攻读学位期间完成的论文},
%   },
% }
% \end{latex}
%
% \subsubsection{信息域}
%
% \begin{function}{info}
%   \begin{sjtusyntax}[emph={[1]info}]
%     info = (*\marg{键值列表}*)
%   \end{sjtusyntax}
%   该选项包含许多子项目，用于录入论文信息。
%   具体内容见下。以下带“*”的项目表示对应的英文字段。
% \end{function}
%
% \begin{function}{info/title}
%   \begin{sjtusyntax}[emph={[2]title}]
%     title = (*\marg{标题}*)
%   \end{sjtusyntax}
%   标题。
% \end{function}
%
% \begin{function}[rEXP]{info/title*}
%   \begin{sjtusyntax}[emph={[2]title*}]
%     title* = (*\marg{英文标题}*)
%   \end{sjtusyntax}
%   英文标题。
% \end{function}
%
% \begin{function}{info/display-title}
%   \begin{sjtusyntax}[emph={[2]display-title}]
%     display-title  = (*\marg{中文标题页标题}*)
%   \end{sjtusyntax}
%   中文标题页中的题目。默认为跟随中文标题。
%   如果标题过长，可以尝试使用“|\\|”手动断行。
% \end{function}
%
% \begin{function}[rEXP]{info/display-title*}
%   \begin{sjtusyntax}[emph={[2]display-title*}]
%     display-title* = (*\marg{英文标题页标题}*)
%   \end{sjtusyntax}
%   英文标题页中的题目。默认为跟随英文标题。
%   如果标题过长，可以尝试使用“|\\|”手动断行。
% \end{function}
%
% \begin{function}[EXP,updated=2022-12-20]{info/running-title}
%   \begin{sjtusyntax}[emph={[2]running-title}]
%     running-title  = (*\marg{页眉标题}*)
%   \end{sjtusyntax}
%   \cls{sjtuarticle} 中显示在右上角的页眉题目。默认为跟随中文标题。
% \end{function}
%
%^^A \begin{function}[rEXP]{info/running-title*}
%^^A   \begin{sjtusyntax}[emph={[2]running-title*}]
%^^A     running-title* = (*\marg{英文页眉标题}*)
%^^A   \end{sjtusyntax}
%^^A   论文页眉题目（英文）。
%^^A   该选项暂时无效。
%^^A \end{function}
%
% \begin{function}[added=2022-12-17,updated=2022-12-23]{info/subject}
%   \begin{sjtusyntax}[emph={[2]subject}]
%     subject  = (*\marg{中文主题}*)
%   \end{sjtusyntax}
%   文档中文主题。一般显示在中文标题页校徽下方。
%   \begin{itemize}
%     \item 在 \cls{sjtuthesis} 文档类中，默认值类似于“上海交通大学学士学位论文”。
%     \item 在 \cls{sjtureport} 文档类中，默认为空。
%   \end{itemize}
% \end{function}
%
% \begin{function}[rEXP,added=2022-12-17,updated=2022-12-23]{info/subject*}
%   \begin{sjtusyntax}[emph={[2]subject*}]
%     subject* = (*\marg{英文主题}*)
%   \end{sjtusyntax}
%   文档英文主题。一般显示在英文标题页顶部。
%   \begin{itemize}
%     \item 在 \cls{sjtuthesis} 文档类中，默认值类似于“A Dissertation Submitted to
%           Shanghai Jiao Tong University for Bachelor Degree”。
%   \end{itemize}
% \end{function}
%
% \begin{function}{info/keywords}
%   \begin{sjtusyntax}[emph={[2]keywords}]
%     keywords  = (*\marg{中文关键字}*)
%   \end{sjtusyntax}
%   关键字列表。各关键字之间需使用英文逗号隔开。
%   为防止歧义，可以用分组括号“|{...}|”把各字段括起来。
% \end{function}
%
% \begin{function}[rEXP]{info/keywords*}
%   \begin{sjtusyntax}[emph={[2]keywords*}]
%     keywords* = (*\marg{英文关键字}*)
%   \end{sjtusyntax}
%   英文关键字列表。各关键字之间需使用英文逗号隔开。
%   为防止歧义，可以用分组括号“|{...}|”把各字段括起来。
% \end{function}
%
% \begin{function}{info/author}
%   \begin{sjtusyntax}[emph={[2]author}]
%     author  = (*\marg{姓名}*)
%   \end{sjtusyntax}
%   作者姓名。
% \end{function}
%
% \begin{function}{info/author*}
%   \begin{sjtusyntax}[emph={[2]author*}]
%     author* = (*\marg{英文姓名或拼音}*)
%   \end{sjtusyntax}
%   作者英文姓名。
% \end{function}
%
% \begin{function}{info/id}
%   \begin{sjtusyntax}[emph={[2]id}]
%     id  = (*\marg{学号}*)
%   \end{sjtusyntax}
%   学号。
% \end{function}
%
% \begin{function}[updated=2022-12-23]{info/supervisor,info/assoc-supervisor}
%   \vspace{-1ex}
%   \begin{sjtusyntax}[emph={[2]supervisor,assoc-supervisor}]
%     supervisor        = (*\marg{姓名}*)
%     assoc-supervisor  = (*\marg{姓名}*)
%   \end{sjtusyntax}
%   导师、副导师中文姓名。
% \end{function}
%
% \begin{function}[rEXP,updated=2022-12-23]{info/co-supervisor}
%   \begin{sjtusyntax}[emph={[2]co-supervisor}]
%     co-supervisor = (*\marg{姓名}*)
%   \end{sjtusyntax}
%   联合导师中文姓名。
% \end{function}
%
% \begin{function}[rEXP,updated=2022-12-23]{info/supervisor*,info/assoc-supervisor*,
%   info/co-supervisor*}
%   \vspace{-1ex}
%   \begin{sjtusyntax}[emph={[2]supervisor*,assoc-supervisor*,co-supervisor*}]
%     supervisor*       = (*\marg{英文姓名或拼音}*)
%     assoc-supervisor* = (*\marg{英文姓名或拼音}*)
%     co-supervisor*    = (*\marg{英文姓名或拼音}*)
%   \end{sjtusyntax}
%   导师、副导师、联合导师英文姓名。
% \end{function}
%
% \begin{function}[rEXP]{info/degree,info/degree*}
%   \vspace{-1ex}
%   \begin{sjtusyntax}[emph={[2]degree,degree*}]
%     degree  = (*\marg{学位中文名称}*)
%     degree* = (*\marg{学位英文名称}*)
%   \end{sjtusyntax}
%   申请学位中英文名称。
%   包括申请的学位类别和级别，如“工学硕士”、“理学博士”等。
%   学士论文无需标注。
% \end{function}
%
% \begin{function}{info/department}
%   \begin{sjtusyntax}[emph={[2]department}]
%     department  = (*\marg{院系中文名称}*)
%   \end{sjtusyntax}
%   院系中文名称。
% \end{function}
%
% \begin{function}[rEXP]{info/department*}
%   \begin{sjtusyntax}[emph={[2]department*}]
%     department* = (*\marg{院系英文名称}*)
%   \end{sjtusyntax}
%   院系英文名称。
% \end{function}
%
% \begin{function}[rEXP]{info/major,info/major*}
%   \vspace{-1ex}
%   \begin{sjtusyntax}[emph={[2]major,major*}]
%     major  = (*\marg{专业中文名称}*)
%     major* = (*\marg{专业英文名称}*)
%   \end{sjtusyntax}
%   专业中英文名称。
% \end{function}
%
% \begin{function}[rEXP]{info/fund,info/fund*}
%   \vspace{-1ex}
%   \begin{sjtusyntax}[emph={[2]fund,fund*}]
%     fund  = (*\marg{资助基金中文名称}*)
%     fund* = (*\marg{资助基金英文名称}*)
%   \end{sjtusyntax}
%   资助基金列表。各资助基金名称之间需使用英文逗号隔开。
%   为防止歧义，可以用分组括号“|{...}|”把各字段括起来。
% \end{function}
%
% \begin{function}[updated=2022-12-17]{info/date}
%   \vspace{-1ex}
%   \begin{sjtusyntax}[emph={[2]date}]
%     date = (*\marg{ISO 日期}*)
%   \end{sjtusyntax}
%   日期。默认值为文档编译日期。也可以自己指定，要求使用 ISO 格式，
%   即 |yyyy-mm-dd|，否则设定无效。
% \end{function}
%
% \begin{function}[added=2022-12-17]{info/display-date}
%   \begin{sjtusyntax}[emph={[2]display-date}]
%     display-date  = (*\marg{日期文字}*)
%   \end{sjtusyntax}
%   显示日期，可以显示不同于标准日期格式的日期，日期文字将会被原样输出。
%   设定该键时，将会覆盖 \opt{info/date} 键在中文语境下的设定。
% \end{function}
%
% \begin{function}[rEXP,added=2022-12-17,updated=2022-12-18]{info/display-date*}
%   \begin{sjtusyntax}[emph={[2]display-date*}]
%     display-date* = (*\marg{英文日期文字}*)
%   \end{sjtusyntax}
%   英文显示日期，可以显示不同于标准日期格式的日期，日期文字将会被原样输出。
%   设定该键时，将会覆盖 \opt{info/date} 键在英文语境下的设定。
% \end{function}
%
% \subsubsection{样式域}
%
% \begin{function}{style}
%   \begin{sjtusyntax}[emph={[1]style}]
%     style = (*\marg{键值列表}*)
%   \end{sjtusyntax}
%   该选项包含许多子项目，用于设置论文样式。具体内容见下。
% \end{function}
%
% \begin{function}[added=2022-12-03,updated=2022-12-27]{style/float-font}
%   \begin{sjtusyntax}[emph={[2]float-font}]
%     float-font = (*\marg{字体设置}*)
%   \end{sjtusyntax}
%   图、表等浮动体的额外字体设置。
%   默认为 |\zihao{5}\fixedlineskip{15.6bp}|，五号字、固定行距 15.6 磅。
%   若英文学位模板使用者希望符合 Word 英文模板规则，可以将该项改为
%   |\normalsize\fixedlineskip{15.6bp}| 正常字号、固定行距 15.6 磅。
%   其中 15.6 磅的固定行距为 Microsoft Word 文档网格的默认固定行间距。
% \end{function}
%
% \begin{function}[added=2022-12-20]{style/caption-font}
%   \begin{sjtusyntax}[emph={[2]caption-font}]
%     caption-font = (*\marg{字体设置}*)
%   \end{sjtusyntax}
%   题注字体。
%   默认为 |\zihao{5}\bfseries|，粗体五号字。
% \end{function}
%
% \begin{function}[added=2022-12-20]{style/subcaption-font}
%   \begin{sjtusyntax}[emph={[2]subcaption-font}]
%     subcaption-font = (*\marg{字体设置}*)
%   \end{sjtusyntax}
%   子图题注字体。
%   默认为 |\zihao{5}\normalfont|，正常字重五号字。
% \end{function}
%
% \begin{function}[added=2022-12-03]{style/fnmark-font}
%   \begin{sjtusyntax}[emph={[2]fnmark-font}]
%     fnmark-font = (*\marg{字体设置}*)
%   \end{sjtusyntax}
%   脚注编号的额外字体设置。
%   默认为空。
% \end{function}
%
% \begin{function}[updated=2022-12-23]{style/float-num-sep}
%   \begin{sjtusyntax}[emph={[2]float-num-sep}]
%     float-num-sep = (*\marg{分隔符}*)
%   \end{sjtusyntax}
%   图、表等浮动体编号中的分隔符。
%   默认为 \opt{--}。
% \end{function}
%
% \begin{function}[updated=2022-12-23]{style/equation-num-sep}
%   \begin{sjtusyntax}[emph={[2]equation-num-sep}]
%     equation-num-sep = (*\marg{分隔符}*)
%   \end{sjtusyntax}
%   公式编号中的分隔符。
%   默认为 \opt{--}。
% \end{function}
%
% \begin{function}{style/title-logo-color}
%   \begin{sjtusyntax}[emph={[2]title-logo-color}]
%     title-logo-color = (*<(red)|blue|black>*)
%   \end{sjtusyntax}
%   选择论文标题页中校徽的颜色。
% \end{function}
%
% \begin{function}[updated=2022-12-20]{style/header-logo-color}
%   \begin{sjtusyntax}[emph={[2]header-logo-color}]
%     header-logo-color = (*<(red)|blue|black>*)
%   \end{sjtusyntax}
%   选择 \cls{sjtureport} 和 \cls{sjtuarticle} 中页眉的校标颜色。
% \end{function}
%
% \begin{function}[added=2022-12-20]{style/header-uppercase}
%   \begin{sjtusyntax}[emph={[2]header-uppercase}]
%     header-uppercase = (*<true|(false)>*)
%   \end{sjtusyntax}
%   页眉英文字母是否大写。
%   \begin{itemize}
%     \item 在 \cls{sjtuthesis} 和 \cls{sjtureport} 文档类中，默认为 \opt{false}。
%     \item 在 \cls{sjtuarticle} 文档类中，默认为 \opt{true}。
%   \end{itemize}
% \end{function}
%
% \begin{function}[added=2022-12-20]{style/header-font}
%   \begin{sjtusyntax}[emph={[2]header-font}]
%     header-font = (*\marg{页眉字体}*)
%   \end{sjtusyntax}
%   页眉字体。
%   \begin{itemize}
%     \item 在 \cls{sjtuthesis} 文档类中，默认为 |\zihao{-5}|，小五号字。
%     \item 在 \cls{sjtureport} 和 \cls{sjtuarticle} 文档类中，默认为 |\zihao{-5}\sffamily|，小五号字黑体。
%   \end{itemize}
% \end{function}
%
% \begin{function}[added=2022-12-20]{style/footer-font}
%   \begin{sjtusyntax}[emph={[2]footer-font}]
%     footer-font = (*\marg{页脚字体}*)
%   \end{sjtusyntax}
%   页脚字体。
%   \begin{itemize}
%     \item 在 \cls{sjtuthesis} 和 \cls{sjtureport} 文档类中，默认为 |\zihao{-5}|，小五号字。
%     \item 在 \cls{sjtuarticle} 文档类中，默认为 |\zihao{5}|，五号字。
%   \end{itemize}
% \end{function}
%
% \begin{function}[added=2022-12-03]{style/page-number}
%   \begin{sjtusyntax}[emph={[2]page-number}]
%     page-number = (*\marg{页码设置}*)
%   \end{sjtusyntax}
%   设置页码的显示样式，其中 |#1| 代表当前页码。
%   默认为 |{#1}|，即仅显示页码本身。
% \end{function}
%
% \subsubsection{名称域}
%
% \begin{function}{name}
%   \begin{sjtusyntax}[emph={[1]name}]
%     name = (*\marg{键值列表}*)
%   \end{sjtusyntax}
%   选项包含许多子项目，用于设置论文中一些标题的名称。部分选项只能在 \cls{sjtuthesis} 中使用。
%   具体内容见表 \ref{tab:names}。
% \end{function}
%
% \begin{function}[updated=2022-12-18]{name/contents,name/listfigure,name/listtable,
%   name/figure,name/table,name/abstract,name/index,name/appendix,name/proof,name/bib,
%   name/figure*,name/table*,name/algorithm,name/listalgorithm,
%   name/abbr,name/nom,name/summary,name/ack,name/resume,name/digset,name/achv}
% \end{function}
%
% \begin{table}[hbt]
%   \vspace{-47ex}
%   \centering\small
%   \caption{\opt{name} 选项的默认设置}
%   \label{tab:names}
%   \begin{tabular}{l|l|l}
%     \toprule
%     \strong{选项}          & \strong{|lang = zh|} & \strong{|lang = en|}          \\
%     \midrule
%      |contents|           & 目录                  & Contents                      \\
%      |listfigure|         & 插图                  & List of Figures               \\
%      |listtable|          & 表格                  & List of Tables                \\
%      |figure|             & 图                    & Figure                        \\
%      |table|              & 表                    & Table                         \\
%      |abstract| \rexpstar & 摘要                  & Abstract                      \\
%      |appendix|           & 附录                  & Appendix                      \\
%      |index|              & 索引                  & Index                         \\
%      |proof|              & 证明                  & Proof                         \\
%      |bib|                & 参考文献               & Bibliography                  \\
%    \midrule
%      |figure*|            & Figure               & 图                             \\
%      |table*|             & Table                & 表                             \\
%      |algorithm|          & 算法                  & Algorithm                     \\
%      |listalgorithm|      & 算法                  & List of Algorithms            \\
%      |abbr| \rexpstar     & 缩略语对照表           & Abbreviation                  \\
%      |nom| \rexpstar      & 主要符号对照表         & Nomenclature                  \\
%      |summary| \rexpstar  & 全文总结              & Summary                       \\
%      |ack| \rexpstar      & 致谢                  & Acknowledgements              \\
%      |resume| \rexpstar   & 个人简历              & Resume                        \\
%      |digest| \rexpstar   & 大摘要                & Digest                        \\
%      |achv| \rexpstar     & 学术论文和科研成果目录   & List of Research Achievements \\
%     \bottomrule
%   \end{tabular}
% \end{table}
%
% \section{内容编写}
%
% 在文档开始后进行内容编写，文档内容由 |document| 环境包裹。
%
% \begin{function}{document}
%   \begin{sjtusyntax}[emph={[2]document}]
%     \begin{document}
%       (*\meta{文档内容}*)
%     \end{document}
%   \end{sjtusyntax}
% \end{function}
%
% \subsection{标题页和声明页}
%
% \begin{function}[added=2022-12-17]{\title}
%   \begin{sjtusyntax}[morekeywords={\title}]
%     \title(*\marg{标题}*)
%   \end{sjtusyntax}
%   设置标题，覆盖 \opt{info/title} 键的值。
% \end{function}
%
% \begin{function}[rEXP,added=2022-12-17]{\title*}
%   \begin{sjtusyntax}[morekeywords={\title*}]
%     \title*(*\marg{英文标题}*)
%   \end{sjtusyntax}
%   设置英文标题，覆盖 \opt{info/title*} 键的值。
% \end{function}
%
% \begin{function}[added=2022-12-17]{\author}
%   \begin{sjtusyntax}[morekeywords={\author}]
%     \author(*\marg{姓名}*)
%   \end{sjtusyntax}
%   设置作者姓名，覆盖 \opt{info/author} 键的值。
% \end{function}
%
% \begin{function}[rEXP,added=2022-12-17]{\author*}
%   \begin{sjtusyntax}[morekeywords={\author*}]
%     \author*(*\marg{英文姓名或拼音}*)
%   \end{sjtusyntax}
%   设置作者英文姓名，覆盖 \opt{info/author*} 键的值。
% \end{function}
%
% \begin{function}[added=2022-12-17]{\date}
%   \begin{sjtusyntax}[morekeywords={\date}]
%     \date(*\marg{日期}*)
%   \end{sjtusyntax}
%   设置日期，覆盖 \opt{info/display-date} 键的值。
%   日期会被原样显示。
% \end{function}
%
% \begin{function}[rEXP,added=2022-12-17]{\date*}
%   \begin{sjtusyntax}[morekeywords={\date*}]
%     \date*(*\marg{英文日期}*)
%   \end{sjtusyntax}
%   设置英文日期，覆盖 \opt{info/display-date*} 键的值。
%   日期会被原样显示。
% \end{function}
%
% \begin{function}[added=2022-12-17]{\today}
%   \begin{sjtusyntax}[morekeywords={\today}]
%     \today
%   \end{sjtusyntax}
%   文档编译日期，以对应语言的格式显示。
% \end{function}
%
% \begin{function}[updated=2022-12-03]{\maketitle}
%   \begin{sjtusyntax}[morekeywords={\maketitle}]
%     \maketitle
%   \end{sjtusyntax}
%   生成标题。
%   \begin{itemize}
%     \item 在 \cls{sjtuthesis} 文档类中，生成标题页。
%     \item 在 \cls{sjtureport} 和 \cls{sjtuarticle} 文档类中，
%           \begin{itemize}
%             \item 若处于 \opt{titlepage} 文档类选项中，生成标题页。\cls{sjtureport} 文档类默认。
%             \item 若处于 \opt{notitlepage} 文档类选项中，生成标题块。\cls{sjtuarticle} 文档类默认。
%           \end{itemize}
%   \end{itemize}
% \end{function}
%
% \begin{function}[rEXP,updated=2022-12-20]{\copyrightpage}
%   \begin{sjtusyntax}[morekeywords={\copyrightpage}]
%     \copyrightpage
%     \copyrightpage(*\oarg{授权书扫描件}*)
%   \end{sjtusyntax}
%   生成空白版权使用授权书。
%   接受一个可选参数用于插入版权使用授权书扫描件，使用可选参数时需要手动加载 \pkg{pdfpages} 宏包。
% \end{function}
%
% \subsection{前文部分}
%
% \begin{function}[rEXP]{\frontmatter}
%   \begin{sjtusyntax}[morekeywords={\frontmatter}]
%     \frontmatter
%   \end{sjtusyntax}
%   声明前文部分开始。
% \end{function}
%
% \begin{function}{abstract}
%   \begin{sjtusyntax}[emph={[2]abstract,abstract*}]
%     \begin{abstract}
%       (*\meta{摘要}*)
%     \end{abstract}
%   \end{sjtusyntax}
%   摘要环境。
% \end{function}
%
% \begin{function}[rEXP]{abstract*}
%   \begin{sjtusyntax}[emph={[2]abstract*}]
%     \begin{abstract*}
%       (*\meta{英文摘要}*)
%     \end{abstract*}
%   \end{sjtusyntax}
%   英文摘要环境。
% \end{function}
%
% \begin{function}{\tableofcontents}
%   \begin{sjtusyntax}[morekeywords={\tableofcontents}]
%     \tableofcontents
%   \end{sjtusyntax}
%   目录。
% \end{function}
%
% \begin{function}[rEXP]{\listoffigures,\listoffigures*,
%   \listoftables,\listoftables*,\listofalgorithms,\listofalgorithms*}
%   插图、表格和算法等索引命令如表 \ref{tab:list} 所示，将其插入到期望的
%   位置即可。带*的命令表示对应的索引表不会出现在目录中。
%^^A 似乎不再使用插图、表格和算法索引。
% \end{function}
%
% \begin{table}[ht]
% \vspace{-10ex}
% \centering\small
% \begin{threeparttable}
%   \caption{目录和索引表}
%   \label{tab:list}
%   \begin{tabular}{lp{4cm}}
%     \toprule
%     \strong{用途}     & \strong{命令}          \\\midrule
%     插图索引          & \cs{listoffigures}     \\
%                       & \cs{listoffigures*}    \\\midrule
%     表格索引          & \cs{listoftables}      \\
%                       & \cs{listoftables*}     \\\midrule
%     算法索引\tnote{a} & \cs{listofalgorithms}  \\
%                       & \cs{listofalgorithms*} \\
%     \bottomrule
%   \end{tabular}
%   \begin{tablenotes}
%     \item[a] 启用 \pkg{algorithm2e} 或 \pkg{algorithm} 后有效。
%   \end{tablenotes}
% \end{threeparttable}
% \end{table}
%
% \subsection{正文部分}
%
% \begin{function}[rEXP]{\mainmatter}
%   \begin{sjtusyntax}[morekeywords={\mainmatter}]
%     \mainmatter
%   \end{sjtusyntax}
%   声明正文部分开始。正文部分是论文的核心，您可以分章节撰写。
%   如有需求，也可以采用多文件编译的方式。
% \end{function}
%
% \begin{function}[updated=2022-12-03]{\footnote}
%   \begin{sjtusyntax}[morekeywords={\footnote}]
%     \footnote(*\oarg{脚注编号}*)(*\marg{脚注文字}*)
%   \end{sjtusyntax}
%   插入脚注。其中脚注编号参数是可选的，一般不需要输入。
%   编号采用中文字体的带圈数字，只支持 1 到 50 号，请保证每页脚注不超过 50 个，超过 50 号
%   脚注会给出脚注过多的警告。
%   在一些字体配置下，脚注编号不能超过 10 号或 20 号，否则字体集可能不包含该字符，而无法正
%   常显示。
% \end{function}
%
% \begin{function}{assumption,axiom,conjecture,corollary,definition,example,
%   exercise,lemma,problem,proposition,theorem}
%   \sjtutex{} 预定义了一系列数学环境。在启用 \pkg{ntheorem} 或 \pkg{amsthm}
%   宏包后有效，环境如表 \ref{tab:theorems} 所示。
% \end{function}
%
% \begin{table}[ht]
% \vspace*{-20ex}
% \centering\small
% \caption{预定义的数学环境}
% \label{tab:theorems}
% \begin{tabular}{*{7}{l}}\toprule
%   assumption  & axiom   & conjecture & corollary    & definition  & example   & exercise  \\
%   假设        & 公理    & 猜想       & 推论         & 定义        & 例        & 练习      \\\midrule
%   lemma       & problem & proof      & proposition  & remark      & solution  & theorem   \\
%   引理        & 问题    & 证明       & 命题         & 注          & 解        & 定理      \\\bottomrule
% \end{tabular}
% \end{table}
%
% \begin{function}[added=2022-12-27]{\fixedlineskip}
%   \begin{sjtusyntax}[morekeywords={\fixedlineskip}]
%     \fixedlineskip(*\marg{长度}*)
%   \end{sjtusyntax}
%   设置固定值行距。通过当前字体大小计算行距倍数，在字号命令之后使用。
% \end{function}
%
% \begin{function}{\appendix}
%   \begin{sjtusyntax}[morekeywords={\appendix}]
%     \appendix
%     \chapter{...}
%   \end{sjtusyntax}
%   附录由 \cs{appendix} 命令开启，然后像正文一样书写。
%^^A 标准新模板将附录编号置于章节标题之后。
% \end{function}
%
% \begin{function}[rEXP]{nomenclature,nomenclature*}
%   \begin{sjtusyntax}[emph={[2]nomenclature,nomenclature*}]
%     \begin{nomenclature}
%       (*\meta{符号对照表}*)
%     \end{nomenclature}
%   \end{sjtusyntax}
%   符号对照表环境。带星号的版本不会出现在目录中。
%   符号对照表环境仅设置标题，内部实现可由用户自行决定。
%   可以使用 \pkg{longtable}，也可以使用 \pkg{nomencl} 宏包。
% \end{function}
%
% \subsection{后文部分}
%
% \begin{function}[rEXP]{\backmatter}
%   \begin{sjtusyntax}[morekeywords={\backmatter}]
%     \backmatter
%   \end{sjtusyntax}
%   声明后文部分开始。 后文部分包含致谢等。
% \end{function}
%
% \begin{function}[rEXP]{acknowledgements}
%   \begin{sjtusyntax}[emph={[2]acknowledgements}]
%     \begin{acknowledgements}
%       (*\meta{致谢内容}*)
%     \end{acknowledgements}
%   \end{sjtusyntax}
%   致谢环境。盲审模式下致谢将被隐去。
% \end{function}
%
% \begin{function}[rEXP]{achievements}
%   \begin{sjtusyntax}[emph={[2]achievements}]
%     \begin{achievements}
%       (*\meta{获得的科研成果}*)
%     \end{achievements}
%   \end{sjtusyntax}
%   科研成果环境，内部请采用下面的附录用文献列表环境。
%   你可以在该环境中使用带星号的节次命令以分隔不同的类型的内容
%  （比如学术论文、专利等）。
% \end{function}
%
% \begin{function}{bibliolist}
%   \begin{sjtusyntax}[emph={[2]bibliolist}]
%     \begin{bibliolist}(*\marg{最长条目编号}*)
%        \item (*\meta{文献条目}*)
%     \end{bibliolist}
%   \end{sjtusyntax}
%   附录用文献环境，普通模式下显示。
%   在 \cls{sjtuthesis} 中，盲审模式下不显示。
% \end{function}
%
% \begin{function}[rEXP]{bibliolist*}
%   \begin{sjtusyntax}[emph={[2]bibliolist,bibliolist*}]
%     \begin{bibliolist*}(*\marg{最长条目编号}*)
%        \item (*\meta{文献条目（隐去姓名）}*)
%     \end{bibliolist*}
%   \end{sjtusyntax}
%   附录用文献环境，盲审模式下显示。
% \end{function}
%
% \begin{function}[rEXP]{resume}
%   \begin{sjtusyntax}[emph={[2]resume}]
%     \begin{resume}
%       (*\meta{简历内容}*)
%     \end{resume}
%   \end{sjtusyntax}
%   简历环境。盲审模式下简历将被隐去。
% \end{function}
%
% \begin{function}[rEXP]{digest}
%   \begin{sjtusyntax}[emph={[2]digest}]
%     \begin{digest}
%       (*\meta{大摘要}*)
%     \end{digest}
%   \end{sjtusyntax}
%   学士论文大摘要。
%^^A 论文类型为学士论文的条件下有效。
%^^A 尚无条件限制。
% \end{function}
%
% \end{documentation}
%
% \begin{implementation}
%
% \clearpage
% \section{代码实现}
%
% 本模板使用 \LaTeXiii{} 语法编写，依赖 \pkg{expl3} 环境，
% 并需调用 \pkg{l3packages} 中的相关宏包。
%
% \subsection{准备}
%
% 检查 \LaTeXiii{} 编程环境。
%    \begin{macrocode}
%<@@=sjtu>
%<*class>
\RequirePackage { xparse, xtemplate }
\msg_new:nnn { sjtutex } { l3-too-old }
  {
    Package~ "#1"~ is~ too~ old. \\\\
    Please~ update~ an~ up-to-date~ version~ of~ the~ bundles \\
    "l3kernel"~ and~ "l3packages"~ using~ your~ TeX~ package \\
    manager~ or~ from~ CTAN.
  }
\@ifpackagelater { expl3 } { 2020/04/06 } { }
  { \msg_error:nnn { sjtutex } { l3-too-old } { expl3 } }
%    \end{macrocode}
%
% \subsection{内部变量}
%
% \begin{variable}{\l_@@_tmpa_bool,\l_@@_tmpa_int,
% \l_@@_tmpa_tl,\l_@@_tmpb_tl,
% \l_@@_tmpa_clist,\l_@@_tmpb_clist,
% \l_@@_tmpa_dim,\l_@@_tmpb_dim,
% \l_@@_tmpa_skip,\l_@@_tmpa_box}
% 临时变量。
%    \begin{macrocode}
\bool_new:N \l_@@_tmpa_bool
\int_new:N \l_@@_tmpa_int
\tl_new:N \l_@@_tmpa_tl
\tl_new:N \l_@@_tmpb_tl
\clist_new:N \l_@@_tmpa_clist
\clist_new:N \l_@@_tmpb_clist
\dim_new:N \l_@@_tmpa_dim
\dim_new:N \l_@@_tmpb_dim
\skip_new:N \l_@@_tmpa_skip
\box_new:N \l_@@_tmpa_box
%    \end{macrocode}
% \end{variable}
%
% \begin{variable}{\g_@@_thesis_type_int}
% 论文类型。
%    \begin{macrocode}
%<thesis>\int_new:N \g_@@_thesis_type_int
%    \end{macrocode}
% \end{variable}
%
% \begin{variable}{\g_@@_lang_tl}
% 论文语言。
%    \begin{macrocode}
\tl_new:N \g_@@_lang_tl
\tl_new:N \g_@@_lang_aux_tl
\tl_set:Nn \g_@@_lang_aux_tl { zh }
%    \end{macrocode}
% \end{variable}
%
% \begin{variable}
%   {\g_@@_zihao_tl,\g_@@_font_size_dim,\g_@@_line_skip_dim,
%    \g_@@_default_line_skip_dim,\g_@@_line_spread_fp}
% 字号大小与行距。
%    \begin{macrocode}
\tl_new:N \g_@@_zihao_tl
\dim_new:N \g_@@_font_size_dim
\dim_new:N \g_@@_line_skip_dim
\dim_new:N \g_@@_default_line_skip_dim
\fp_new:N \g_@@_line_spread_fp
%    \end{macrocode}
% \end{variable}
%
% \begin{variable}
%   {\g_@@_text_font_tl,\g_@@_math_font_tl,\g_@@_cjk_font_tl}
% 字体配置。
%    \begin{macrocode}
\tl_new:N \g_@@_text_font_tl
\tl_new:N \g_@@_math_font_tl
\tl_new:N \g_@@_cjk_font_tl
\tl_new:N \g_@@_save_encodingdefault_tl
\tl_new:N \g_@@_save_rmdefault_tl
\tl_new:N \g_@@_save_sfdefault_tl
\tl_new:N \g_@@_save_ttdefault_tl
%    \end{macrocode}
% \end{variable}
%
% \begin{variable}{\g_@@_slanted_uppercase_greek_bool}
% 大写希腊字母的正/斜体。
%    \begin{macrocode}
\bool_new:N \g_@@_slanted_uppercase_greek_bool
%    \end{macrocode}
% \end{variable}
%
% \begin{variable}{\g_@@_upright_integral_bool}
% 积分号的正/斜体。
%    \begin{macrocode}
\bool_new:N \g_@@_upright_integral_bool
%    \end{macrocode}
% \end{variable}
%
% \begin{variable}{\g_@@_integral_limits_bool}
% 积分号上下限的位置。
%    \begin{macrocode}
\bool_new:N \g_@@_integral_limits_bool
%    \end{macrocode}
% \end{variable}
%
% \begin{variable}{\g_@@_review_bool}
% 盲审模式。
%    \begin{macrocode}
%<thesis>\bool_new:N \g_@@_review_bool
%    \end{macrocode}
% \end{variable}
%
% \begin{variable}{\g_@@_options_to_ctex_class_clist}
% 保存由 \pkg{sjtutex} 传入 \pkg{ctex} 文档类的选项列表。
%    \begin{macrocode}
\clist_new:N \g_@@_options_to_ctex_class_clist
%    \end{macrocode}
%
% 默认 \pkg{ctex} 文档类的选项：
% 使用 UTF8 编码，不调整基础类的版式以及不载入 \pkg{ctex} 字体预设配置。
%    \begin{macrocode}
\clist_set:Nn \g_@@_options_to_ctex_class_clist
  { a4paper, UTF8, scheme = plain, fontset = none }
%    \end{macrocode}
% \end{variable}
%
% \begin{variable}{\g_@@_options_to_packages_clist}
% 保存由传入其他宏包的选项列表。
%    \begin{macrocode}
\clist_new:N \g_@@_options_to_packages_clist
%    \end{macrocode}
% \end{variable}
%
% \begin{variable}{\g_@@_twoside_bool}
% 是否开启双页模式。
%    \begin{macrocode}
\bool_new:N \g_@@_twoside_bool
%<thesis>\bool_set_true:N \g_@@_twoside_bool
%<!thesis>\bool_set_false:N \g_@@_twoside_bool
%    \end{macrocode}
% \end{variable}
%
% \begin{variable}{\g_@@_openright_bool}
% 是否在奇数页开始新章。
%    \begin{macrocode}
%<!article>\bool_new:N \g_@@_openright_bool
%<thesis>\bool_set_true:N \g_@@_openright_bool
%<report>\bool_set_false:N \g_@@_openright_bool
%    \end{macrocode}
% \end{variable}
%
% \begin{variable}{\g_@@_titlepage_bool}
% 是否生成标题页。
%    \begin{macrocode}
%<!thesis>\bool_new:N \g_@@_titlepage_bool
%<report>\bool_set_true:N \g_@@_titlepage_bool
%<article>\bool_set_false:N \g_@@_titlepage_bool
%    \end{macrocode}
% \end{variable}
%
% \begin{variable}{\g_@@_draft_bool}
% 是否开启草稿模式。
%    \begin{macrocode}
\bool_new:N \g_@@_draft_bool
%    \end{macrocode}
% \end{variable}
%
% \begin{macro}[int]{\@@_deprecated_option:n,\@@_set_deprecated_option:n}
% 对过时选项给出警告。
%    \begin{macrocode}
\cs_new_protected:Npn \@@_deprecated_option:n
  { \msg_warning:nnn { sjtutex } { deprecated-option } }
\cs_new_protected:Npn \@@_set_deprecated_option:n #1
  {
    \@@_deprecated_option:n { Option~ `#1'~ is~ set. }
    \keys_set:nn { sjtu / option } {#1}
  }
\msg_new:nnn { sjtutex } { deprecated-option }
  { Option~ `\l_keys_key_tl'~ is~ deprecated. \\ #1 }
%    \end{macrocode}
% \end{macro}
%
% \subsection{选项处理}
%
% 定义 |sjtu/option| 键值类。
%    \begin{macrocode}
\keys_define:nn { sjtu / option }
  {
%    \end{macrocode}
%
%    \begin{macrocode}
%<*thesis>
    type .choice: ,
    type .value_required:n = true ,
    type .choices:nn =
      { bachelor, master, doctor }
      { \int_gset_eq:NN \g_@@_thesis_type_int \l_keys_choice_int } ,
    type .initial:n = { master } ,
%</thesis>
%    \end{macrocode}
%
%
%    \begin{macrocode}
    lang .choice: ,
    lang .value_required:n = true ,
    lang .choices:nn =
      { zh, en }
      {
        \tl_gset_eq:NN \g_@@_lang_tl \l_keys_choice_tl
        \int_compare:nNnT { \l_keys_choice_int } = { 1 }
          { \tl_gset:Nn \g_@@_lang_aux_tl { en } }
      } ,
    lang .initial:n = { zh } ,
%    \end{macrocode}
%
% 字号大小。
%    \begin{macrocode}
    zihao .choice: ,
    zihao .value_required:n = true ,
    zihao / -4 .code:n =
      {
        \tl_gset:Nn  \g_@@_zihao_tl { -4 }
        \dim_gset:Nn \g_@@_font_size_dim         { 12   bp }
        \dim_gset:Nn \g_@@_default_line_skip_dim { 20   bp }
      } ,
    zihao /  5 .code:n =
      {
        \tl_gset:Nn  \g_@@_zihao_tl {  5 }
        \dim_gset:Nn \g_@@_font_size_dim         { 10.5 bp }
        \dim_gset:Nn \g_@@_default_line_skip_dim { 15.6 bp }
      } ,
%<!article>    zihao .initial:n = { -4 } ,
%<article>    zihao .initial:n = {  5 } ,
%    \end{macrocode}
%
% 行间距。
%    \begin{macrocode}
    lineskip .dim_gset:N = \g_@@_line_skip_dim ,
%    \end{macrocode}
%
% 字体配置。
%    \begin{macrocode}
    text-font .tl_gset:N = \g_@@_text_font_tl ,
    text-font .initial:n = { newtx } ,
    math-font .tl_gset:N = \g_@@_math_font_tl ,
    cjk-font  .tl_gset:N = \g_@@_cjk_font_tl ,
%    \end{macrocode}
%
% \opt{fontset} 是过时选项。
%    \begin{macrocode}
    fontset .code:n = { \@@_set_deprecated_option:n { cjk-font = #1 } } ,
%    \end{macrocode}
%
% 数学符号样式。
%    \begin{macrocode}
    math-style .choice: ,
    math-style .value_required:n = true,
    math-style / TeX .code:n =
      {
        \bool_gset_false:N \g_@@_slanted_uppercase_greek_bool
        \bool_gset_false:N \g_@@_upright_integral_bool
        \bool_gset_false:N \g_@@_integral_limits_bool
      } ,
    math-style / ISO .code:n =
      {
        \bool_gset_true:N \g_@@_slanted_uppercase_greek_bool
        \bool_gset_true:N \g_@@_upright_integral_bool
        \bool_gset_true:N \g_@@_integral_limits_bool
      } ,
    math-style .initial:n = { ISO } ,
%    \end{macrocode}
%
% 大写希腊字母的正/斜体。
%    \begin{macrocode}
    uppercase-greek .choice: ,
    uppercase-greek .value_required:n = true ,
    uppercase-greek / slanted .code:n =
      { \bool_gset_true:N  \g_@@_slanted_uppercase_greek_bool } ,
    uppercase-greek / upright .code:n =
      { \bool_gset_false:N \g_@@_slanted_uppercase_greek_bool } ,
%    \end{macrocode}
%
% 积分号的正/斜体。
%    \begin{macrocode}
    integral .choice: ,
    integral .value_required:n = true ,
    integral / slanted .code:n =
      { \bool_gset_false:N \g_@@_upright_integral_bool } ,
    integral / upright .code:n =
      { \bool_gset_true:N  \g_@@_upright_integral_bool } ,
%    \end{macrocode}
%
% 积分号上下限的位置。
%    \begin{macrocode}
    integral-limits .choice: ,
    integral-limits .value_required:n = true ,
    integral-limits / false .code:n =
      { \bool_gset_false:N \g_@@_integral_limits_bool } ,
    integral-limits / true  .code:n =
      { \bool_gset_true:N  \g_@@_integral_limits_bool } ,
%    \end{macrocode}
%
% 单面或双面模式。
%    \begin{macrocode}
    oneside .value_forbidden:n = true,
    twoside .value_forbidden:n = true,
    oneside .code:n =
      { \bool_gset_false:N \g_@@_twoside_bool } ,
    twoside .code:n =
      { \bool_gset_true:N  \g_@@_twoside_bool } ,
%    \end{macrocode}
%
% 是否奇数页开章。
%    \begin{macrocode}
%<*!article>
    openany   .value_forbidden:n = true,
    openright .value_forbidden:n = true,
    openany   .code:n =
      { \bool_gset_false:N \g_@@_openright_bool } ,
    openright .code:n =
      { \bool_gset_true:N  \g_@@_openright_bool } ,
%</!article>
%    \end{macrocode}
%
% 是否生成标题页。
%    \begin{macrocode}
%<*!thesis>
    titlepage   .value_forbidden:n = true,
    notitlepage .value_forbidden:n = true,
    titlepage   .code:n =
      { \bool_gset_true:N  \g_@@_titlepage_bool } ,
    notitlepage .code:n =
      { \bool_gset_false:N \g_@@_titlepage_bool } ,
%</!thesis>
%    \end{macrocode}
%
% 是否开启草稿模式。
%    \begin{macrocode}
    draft .value_forbidden:n = true,
    final .value_forbidden:n = true,
    draft .code:n =
      { \bool_gset_true:N  \g_@@_draft_bool } ,
    final .code:n =
      { \bool_gset_false:N \g_@@_draft_bool } ,
%    \end{macrocode}
%
% 盲审模式。
%    \begin{macrocode}
%<thesis>    review .bool_gset:N = \g_@@_review_bool ,
%<thesis>    review .initial:n = false ,
%    \end{macrocode}
%
% 处理未知选项。
%    \begin{macrocode}
    unknown .code:n = { \msg_error:nn { sjtutex } { unknown-option } }
  }
\msg_new:nnn { sjtutex } { unknown-option }
  { Class~ option~ "\l_keys_key_tl"~ is~ unknown. }
%    \end{macrocode}
%
% 将文档类选项传给 |sjtu/option|。
%    \begin{macrocode}
\cs_if_exist:NTF \ProcessKeyOptions
  { \ProcessKeyOptions [ sjtu / option ] }
  {
    \RequirePackage { l3keys2e }
    \ProcessKeysOptions { sjtu / option }
  }
%    \end{macrocode}
%
% 计算行距倍数。
%    \begin{macrocode}
\dim_compare:nNnT \g_@@_line_skip_dim < \g_@@_font_size_dim
  { \dim_set_eq:NN \g_@@_line_skip_dim \g_@@_default_line_skip_dim }
\fp_set:Nn \g_@@_line_spread_fp
  { \dim_ratio:nn { \g_@@_line_skip_dim } { \g_@@_font_size_dim } / 1.2 }
%    \end{macrocode}
%
% 追加全局选项。
%    \begin{macrocode}
\clist_put_right:Nx \@classoptionslist
  {
    a4paper ,
    \bool_if:NT \g_@@_slanted_uppercase_greek_bool
      { slantedGreek } ,
    \bool_if:NT \g_@@_upright_integral_bool
      { upint } ,
    \bool_if:NT \g_@@_integral_limits_bool
      { intlimits }
  }
%    \end{macrocode}
%
% 设置传入 \pkg{ctex} 文档类的选项。
%    \begin{macrocode}
\clist_put_right:Nx \g_@@_options_to_ctex_class_clist
  {
    zihao      = \g_@@_zihao_tl ,
    linespread = \fp_use:N \g_@@_line_spread_fp ,
    \bool_if:NTF \g_@@_twoside_bool
      { twoside   } { oneside     } ,
%<!article>    \bool_if:NTF \g_@@_openright_bool
%<!article>      { openright } { openany     } ,
%<!thesis>    \bool_if:NTF \g_@@_titlepage_bool
%<!thesis>      { titlepage } { notitlepage } ,
    \bool_if:NTF \g_@@_draft_bool
      { draft     } { final       }
  }
%    \end{macrocode}
%
% \subsection{载入宏包、文档类}
%
% 将选项传入 \pkg{ctex} 文档类。
%    \begin{macrocode}
\exp_args:No \PassOptionsToClass
  { \g_@@_options_to_ctex_class_clist }
%<thesis>  { ctexbook }
%<report>  { ctexrep }
%<article>  { ctexart }
%    \end{macrocode}
%
% 传入各宏包选项。
%    \begin{macrocode}
\clist_set:Nx \g_@@_options_to_packages_clist
  {
    { no-math           } { fontspec     } ,
    { titles            } { tocloft      } ,
    { perpage, bottom   } { footmisc     } ,
    { list = off        } { bicaption    } ,
    { warnings-off =
      {
        mathtools-overbracket,
        mathtools-colon
      }
    }                     { unicode-math } ,
    { amsmath, thmmarks } { ntheorem     } ,
%<!article>    { chapter           } { algorithm    } ,
%<!article>    { algochapter       } { algorithm2e  } ,
    {
      \bool_if:NTF \g_@@_integral_limits_bool
        { displaylimits } { nolimits }
    }                     { cmupint      }
  }
\clist_map_inline:Nn \g_@@_options_to_packages_clist
  { \PassOptionsToPackage #1 }
%    \end{macrocode}
%
% 载入 \pkg{ctex} 文档类。
% 在使用 \XeLaTeX{} 编译时，\pkg{ctex} 的底层将调用 \pkg{xeCJK}
% 宏包；而在使用 \LuaLaTeX{} 编译时，则将调用 \pkg{LuaTeX-ja} 宏包。
% 两种情况下 \pkg{ctex} 均会调用 \pkg{fontspec} 宏包。
%    \begin{macrocode}
%<thesis>\LoadClass { ctexbook }
%<report>\LoadClass { ctexrep }
%<article>\LoadClass { ctexart }
%    \end{macrocode}
%
% 载入各宏包。
%    \begin{macrocode}
\RequirePackage
  {
    mathtools,
    geometry,
    fancyhdr,
    tocloft,
    caption,
    bicaption,
    subcaption,
    xcolor,
    graphicx,
    enumitem
  }
%    \end{macrocode}
%
% \subsection{内部函数}
%
% \begin{macro}{\tl_const:co,\tl_const:Nv,\clist_map_inline:xn,
% \exp_args:NNnv,\regex_match:neTF}
% \LaTeX3{} 函数变体。
%    \begin{macrocode}
\cs_generate_variant:Nn \tl_const:Nn { co, Nv }
\cs_generate_variant:Nn \cs_gset:Npn { cpo }
\prg_generate_conditional_variant:Nnn \regex_match:nn { ne } { T }
\exp_args_generate:n { Nnv }
%    \end{macrocode}
% \end{macro}
%
% \begin{macro}[int]{\@@_engine_case:nn}
% 2 个参数依次为 \pdfTeX 和 \XeTeX/\LuaTeX。
%    \begin{macrocode}
\cs_new:Npx \@@_engine_case:nn #1#2
  {
    \bool_lazy_or:nnTF
      { \sys_if_engine_xetex_p:  }
      { \sys_if_engine_luatex_p: }
      {#2}
      { \sys_if_engine_pdftex:T {#1} }
  }
%    \end{macrocode}
% \end{macro}
%
% \begin{macro}[int]{\@@_engine_case:nnn}
% 3 个参数依次为 \pdfTeX、 \XeTeX 和 \LuaTeX。
%    \begin{macrocode}
\cs_new:Npx \@@_engine_case:nnn #1#2#3
  {
    \sys_if_engine_xetex:TF
      {#2}
      {
        \sys_if_engine_luatex:TF
          {#3}
          { \sys_if_engine_pdftex:T {#1} }
      }
  }
%    \end{macrocode}
% \end{macro}
%
% \begin{macro}[int]{\@@_unicode_engine_case:nn}
% 2 个参数依次为 \XeTeX 和 \LuaTeX。
%    \begin{macrocode}
\cs_new:Npx \@@_unicode_engine_case:nn #1#2
  {
    \sys_if_engine_xetex:TF
      {#1}
      { \sys_if_engine_luatex:T {#2} }
  }
%    \end{macrocode}
% \end{macro}
%
% \begin{macro}{\@@_unicode_char:n}
%    \begin{macrocode}
\@@_engine_case:nn
  {
    \cs_new:Npn \@@_unicode_char:n #1
      {
        \Unicode
          { \int_div_truncate:nn {#1} { 256 } }
          { \int_mod:nn          {#1} { 256 } }
      }
  }
  { \cs_new:Npn \@@_unicode_char:n #1 { \tex_Uchar:D #1 \scan_stop: } }
%    \end{macrocode}
% \end{macro}
%
% \begin{macro}{\@@_preto_cmd:Nn,\@@_appto_cmd:Nn}
% 补丁工具，来自 \pkg{ctexpatch} 宏包，在宏的原本定义前后增加钩子。
%    \begin{macrocode}
\cs_new_protected:Npn \@@_preto_cmd:Nn #1#2
  {
    \ctex_preto_cmd:NnnTF #1 { } {#2}
      { } { \ctex_patch_failure:N #1 }
  }
\cs_new_protected:Npn \@@_appto_cmd:Nn #1#2
  {
    \ctex_appto_cmd:NnnTF #1 { } {#2}
      { } { \ctex_patch_failure:N #1 }
  }
%    \end{macrocode}
% \end{macro}
%
% \begin{macro}{\fixedlineskip}
% 设置固定值行距。通过当前字体大小计算行距倍数，在字号命令之后使用。
%    \begin{macrocode}
\cs_new:Npn \@@_fixed_line_skip:n #1
  {
    \exp_args:Nx \linespread
      { \fp_to_decimal:n { \dim_ratio:nn { #1 } { \f@size pt } / 1.2 } }
    \selectfont
  }
\NewDocumentCommand \fixedlineskip { m }
  { \exp_args:Nx \@@_fixed_line_skip:n {#1} \tex_ignorespaces:D }
%    \end{macrocode}
% \end{macro}
%
% \begin{macro}[int]{\@@_dim_set_to_wd:Nn,\@@_dim_add_to_wd:Nn}
%    \begin{macrocode}
\cs_new:Npn \@@_dim_set_to_wd:Nn #1#2
  {
    \hbox_set:Nn \l_@@_tmpa_box {#2}
    \dim_set:Nn #1 { \box_wd:N \l_@@_tmpa_box }
  }
\cs_new:Npn \@@_dim_add_to_wd:Nn #1#2
  {
    \hbox_set:Nn \l_@@_tmpa_box {#2}
    \dim_add:Nn #1 { \box_wd:N \l_@@_tmpa_box }
  }
\cs_generate_variant:Nn \@@_dim_set_to_wd:Nn { Nv }
\cs_generate_variant:Nn \@@_dim_add_to_wd:Nn { cv }
%    \end{macrocode}
% \end{macro}
%
% \begin{macro}{\@@_vspace:N,\@@_vspace:n,\@@_vspace_r:N,\@@_vspace_r:n}
% 类似 \LaTeXe{} 中的 \tn{vspace} 和 \tn{vspace*}。
%    \begin{macrocode}
\cs_new_protected:Npn \@@_vspace:N #1
  {
    \skip_vertical:N #1
    \skip_vertical:N \c_zero_skip
  }
\cs_new_protected:Npn \@@_vspace:n #1
  {
    \skip_set:Nn \l_@@_tmpa_skip {#1}
    \@@_vspace:N \l_@@_tmpa_skip
  }
\cs_new_protected:Npn \@@_vspace_r:N #1
  {
    \dim_set_eq:NN \l_@@_tmpa_dim \prevdepth
    \hrule height \c_zero_dim
    \nobreak
    \skip_vertical:N #1
    \skip_vertical:N \c_zero_skip
    \dim_set_eq:NN \prevdepth \l_@@_tmpa_dim
  }
\cs_new_protected:Npn \@@_vspace_r:n #1
  {
    \skip_set:Nn   \l_@@_tmpa_skip {#1}
    \@@_vspace_r:N \l_@@_tmpa_skip
  }
%    \end{macrocode}
% \end{macro}
%
% \begin{macro}{\@@_cjk_spread_box:nn}
% 汉字分散对齐的水平盒子。
%    \begin{macrocode}
\@@_engine_case:nnn
  {
    \cs_new_protected:Npn \@@_cjk_spread_box:nn #1#2
      {
        \mode_leave_vertical:
        \group_begin:
          \bool_set_false:N \l_@@_tmpa_bool
          \cs_set_eq:NN \SJTU@CJK@filltwosidesSymbol \CJKsymbol
          \cs_set:Npn \CJKsymbol ##1
            {
              \bool_if:NTF \l_@@_tmpa_bool
                { \hfil \SJTU@CJK@filltwosidesSymbol { ##1 } }
                {
                  \SJTU@CJK@filltwosidesSymbol { ##1 }
                  \bool_set_true:N \l_@@_tmpa_bool
                }
            }
          \hbox_to_wd:nn {#1} {#2}
        \group_end:
      }
  }
  {
    \cs_new_protected:Npn \@@_cjk_spread_box:nn #1#2
      {
        \mode_leave_vertical:
        \group_begin:
          \cs_set:Npn \CJKglue
            { \skip_horizontal:n { \c_zero_dim plus 1 filll } }
          \hbox_to_wd:nn {#1} {#2}
        \group_end:
      }
  }
  {
    \cs_new_protected:Npn \@@_cjk_spread_box:nn #1#2
      {
        \mode_leave_vertical:
        \group_begin:
          \ltjsetparameter { kanjiskip = { \c_zero_dim plus 1 filll } }
          \hbox_to_wd:nn {#1} {#2}
        \group_end:
      }
  }
%    \end{macrocode}
% \end{macro}
%
% \begin{macro}{\@@_left_aligned_box:nn}
% 左对齐的水平盒子。
%    \begin{macrocode}
\cs_new_protected:Npn \@@_left_aligned_box:nn #1#2
  {
    \mode_leave_vertical:
    \hbox_to_wd:nn {#1} { #2 \hfil }
  }
%    \end{macrocode}
% \end{macro}
%
% \begin{macro}{\@@_define_name_g:nn,\@@_define_name_g:nnn}
% 用来定义默认名称的辅助函数。
%    \begin{macrocode}
\cs_new_protected:Npn \@@_define_name:nn #1#2
  { \tl_const:cn { c_@@_name_ #1 _zh_tl } {#2} }
\cs_new_protected:Npn \@@_define_name:nnn #1#2#3
  {
    \tl_const:cn { c_@@_name_ #1 _zh_tl } {#2}
    \tl_const:cn { c_@@_name_ #1 _en_tl } {#3}
  }
\cs_new_protected:Npn \@@_define_name_g:nn #1#2
  { \tl_const:cn { c_@@_name_ #1 _tl } {#2} }
\cs_new_protected:Npn \@@_define_name_g:nnn #1#2#3
  {
    \tl_const:cn { c_@@_name_ #1 _zh_tl } {#2}
    \tl_const:cn { c_@@_name_ #1 _en_tl } {#3}
    \tl_gset_eq:cc
      { c_@@_name_ #1 _tl }
      { c_@@_name_ #1 _ \g_@@_lang_tl _tl }
  }
\cs_new_protected:Npn \@@_define_name_from_clist:nNnn #1#2#3#4
  {
    \tl_const:cx { c_@@_name_ #1 _zh_tl }
      { \clist_item:nn {#3} {#2} }
    \tl_const:cx { c_@@_name_ #1 _en_tl }
      { \clist_item:nn {#4} {#2} }
  }
\cs_new_protected:Npn \@@_define_symbol:nn #1#2
  { \tl_const:co { c_@@_symbol_ #1 _tl } { \@@_unicode_char:n {#2} } }
%    \end{macrocode}
% \end{macro}
%
% \begin{macro}{\@@_date_aux_zh:nnn,\@@_date_aux_zh:w,
% \@@_date_aux_en:nnn,\@@_date_aux_en:w}
% 将形如 |yyyy-mm-dd| 的 ISO 日期格式字符串转化为日期表示。
%    \begin{macrocode}
\cs_new:Npn \@@_date_aux_zh:nnn #1#2#3
  { \__zhnum_date_aux:Nnnnn \int_to_arabic:n { ~ } {#1} {#2} {#3} }
\cs_new:Npn \@@_date_aux_zh:w #1-#2-#3 \q_stop
  { \@@_date_aux_zh:nnn {#1} {#2} {#3} }
\clist_const:Nn \c_@@_name_month_en_clist
  {
    January, February, March, April, May, June,
    July, August, September, October, November, December
  }
\cs_new:Npn \@@_ordinal_en:n #1
  {
    \int_to_arabic:n {#1}
    \exp_not:N \textsuperscript
      {
        \int_case:nnF { \int_mod:nn {#1} { 100 } }
          {
            { 11 } { th }
            { 12 } { th }
            { 13 } { th }
          }
          {
            \int_case:nnF { \int_mod:nn {#1} { 10 } }
              {
                { 1 } { st }
                { 2 } { nd }
                { 3 } { rd }
              }
              { th }
          }
      }
  }
\cs_new:Npn \@@_date_aux_en:nnn #1#2#3
  { \clist_item:Nn \c_@@_name_month_en_clist {#2}~ \@@_ordinal_en:n {#3},~ #1 }
\cs_new:Npn \@@_date_aux_en:w #1-#2-#3 \q_stop
  { \@@_date_aux_en:nnn {#1} {#2} {#3} }
\clist_map_inline:nn
  { zh, en }
  {
    \tl_const:cx { c_@@_today_ #1 _tl }
      {
        \use:c { @@_date_aux_ #1 :nnn }
          { \int_value:w \tex_year:D }
          { \tex_month:D }
          { \tex_day:D }
      }
  }
\tl_const:Nv \c_@@_today_tl { c_@@_today_ \g_@@_lang_tl _tl }
%    \end{macrocode}
% \end{macro}
%
% 载入名称配置。
%    \begin{macrocode}
%<thesis>\file_input:n { sjtu-name-thesis.cfg }
%<!thesis>\file_input:n { sjtu-name-generic.cfg }
%    \end{macrocode}
%
% \subsection{用户接口}
%
% \begin{macro}{\sjtusetup}
% 用户设置接口。
%    \begin{macrocode}
\NewDocumentCommand \sjtusetup { } { \keys_set:nn { sjtu } }
%    \end{macrocode}
% \end{macro}
%
% 定义元（meta）键值对。
%    \begin{macrocode}
\keys_define:nn { sjtu }
  {
    info  .meta:nn = { sjtu / info  } {#1} ,
    style .meta:nn = { sjtu / style } {#1} ,
    name  .meta:nn = { sjtu / name  } {#1}
  }
%    \end{macrocode}
%
% \subsubsection{信息录入}
%
% 定义字段。
%    \begin{macrocode}
\clist_map_inline:nn
  {
    title, display_title, running_title, subject, author, date,
    supervisor, assoc_supervisor, department,
%<thesis>    co_supervisor, major, degree
  }
  {
    \tl_new:c { l_@@_info_ #1 _zh_tl }
%<thesis>    \tl_new:c { l_@@_info_ #1 _en_tl }
  }
%<thesis>\tl_set:co { l_@@_info_title_aux_tl }
%<thesis>  { \cs:w l_@@_info_title_ \g_@@_lang_aux_tl _tl \cs_end: }
\tl_new:N \l_@@_info_id_zh_tl
\clist_map_inline:nn
%<!thesis>  { keywords }
%<thesis>  { keywords, fund }
  {
    \clist_new:c { l_@@_info_ #1 _zh_clist }
%<thesis>    \clist_new:c { l_@@_info_ #1 _en_clist }
  }
%    \end{macrocode}
%
% 定义 |sjtu/info| 键值类。
%    \begin{macrocode}
\keys_define:nn { sjtu / info }
  {
    title               .code:n =
      {
        \tl_set:Nn \l_@@_info_title_zh_tl {#1}
        \clist_map_inline:nn
          {
            \l_@@_info_display_title_zh_tl ,
            \l_@@_info_running_title_zh_tl
          }
          { \tl_if_empty:NT ##1 { \tl_set:Nn ##1 {#1} } }
      } ,
%<*thesis>
    title*              .code:n =
      {
        \tl_set:Nn \l_@@_info_title_en_tl {#1}
        \clist_map_inline:nn
          {
            \l_@@_info_display_title_en_tl ,
            \l_@@_info_running_title_en_tl
          }
          { \tl_if_empty:NT ##1 { \tl_set:Nn ##1 {#1} } }
      } ,
%</thesis>
    display-title     .tl_set:N = \l_@@_info_display_title_zh_tl ,
%<thesis>    display-title*    .tl_set:N = \l_@@_info_display_title_en_tl ,
    running-title     .tl_set:N = \l_@@_info_running_title_zh_tl ,
%<thesis>    running-title*    .tl_set:N = \l_@@_info_running_title_en_tl ,
    subject           .tl_set:N = \l_@@_info_subject_zh_tl ,
%<*thesis>
    subject          .initial:n =
      {
        \c_@@_name_univ_zh_tl
        \c_@@_name_degree_level_zh_tl
        \c_@@_name_thesis_zh_tl
      } ,
    subject*          .tl_set:N = \l_@@_info_subject_en_tl ,
    subject*         .initial:n =
      {
        A~ Dissertation~ Submitted~ to \\
        { \c_@@_name_univ_en_tl }~ for~
        { \c_@@_name_degree_level_en_tl }~ Degree
      } ,
%</thesis>
    keywords       .clist_set:N = \l_@@_info_keywords_zh_clist ,
%<thesis>    keywords*      .clist_set:N = \l_@@_info_keywords_en_clist ,
    author            .tl_set:N = \l_@@_info_author_zh_tl ,
%<thesis>    author*           .tl_set:N = \l_@@_info_author_en_tl ,
    id                .tl_set:N = \l_@@_info_id_zh_tl ,
    supervisor        .tl_set:N = \l_@@_info_supervisor_zh_tl ,
%<thesis>    supervisor*       .tl_set:N = \l_@@_info_supervisor_en_tl ,
    assoc-supervisor  .tl_set:N = \l_@@_info_assoc_supervisor_zh_tl ,
%<thesis>    assoc-supervisor* .tl_set:N = \l_@@_info_assoc_supervisor_en_tl ,
%<thesis>    co-supervisor     .tl_set:N = \l_@@_info_co_supervisor_zh_tl ,
%<thesis>    co-supervisor*    .tl_set:N = \l_@@_info_co_supervisor_en_tl ,
%<thesis>    degree            .tl_set:N = \l_@@_info_degree_zh_tl ,
%<thesis>    degree*           .tl_set:N = \l_@@_info_degree_en_tl ,
    department        .tl_set:N = \l_@@_info_department_zh_tl ,
%<thesis>    department*       .tl_set:N = \l_@@_info_department_en_tl ,
%<thesis>    major             .tl_set:N = \l_@@_info_major_zh_tl ,
%<thesis>    major*            .tl_set:N = \l_@@_info_major_en_tl ,
%<thesis>    fund           .clist_set:N = \l_@@_info_fund_zh_clist ,
%<thesis>    fund*          .clist_set:N = \l_@@_info_fund_en_clist ,
    date                .code:n =
      {
        \regex_match:neT { \d{4}-\d{2}-\d{2} } {#1}
          {
            \tl_set:Nx \l_@@_info_date_zh_tl
              { \exp_last_unbraced:Ne \@@_date_aux_zh:w #1 \q_stop }
            \tl_set:Nx \l_@@_info_date_en_tl
              { \exp_last_unbraced:Ne \@@_date_aux_en:w #1 \q_stop }
          }
      } ,
    display-date      .tl_set:N = \l_@@_info_date_zh_tl ,
%<thesis>    display-date     .initial:V = \c_@@_today_zh_tl ,
%<!thesis>    display-date     .initial:V = \c_@@_today_tl ,
%<thesis>    display-date*     .tl_set:N = \l_@@_info_date_en_tl ,
%<thesis>    display-date*    .initial:V = \c_@@_today_en_tl
  }
%    \end{macrocode}
%
% 兼容标准接口。
%    \begin{macrocode}
\RenewDocumentCommand \title { s +m }
  {
    \IfBooleanTF {#1}
      { \keys_set_known:nn { sjtu / info } { title* = {#2} } }
      { \keys_set_known:nn { sjtu / info } { title  = {#2} } }
  }
\tl_set:Nn \@title { \l_@@_info_title_zh_tl }
\RenewDocumentCommand \author { s m }
  {
    \IfBooleanTF {#1}
      { \keys_set_known:nn { sjtu / info } { author* = {#2} } }
      { \keys_set_known:nn { sjtu / info } { author  = {#2} } }
  }
\tl_set:Nn \@author { \l_@@_info_author_zh_tl }
\RenewDocumentCommand \date { s m }
  {
    \IfBooleanTF {#1}
      { \keys_set_known:nn { sjtu / info } { display-date* = {#2} } }
      { \keys_set_known:nn { sjtu / info } { display-date  = {#2} } }
  }
\tl_set:Nn \@date { \l_@@_info_date_zh_tl }
\tl_set:Nv \today { c_@@_today_ \g_@@_lang_tl _tl }
%    \end{macrocode}
%
% 盲审模式下隐藏作者、导师姓名等信息。
%    \begin{macrocode}
%<*thesis>
\ctex_at_end_preamble:n
  {
    \bool_if:NT \g_@@_review_bool
      {
        \clist_map_inline:nn
          { author, supervisor, assoc_supervisor, co_supervisor }
          {
            \tl_clear:c { l_@@_info_ #1 _zh_tl }
            \tl_clear:c { l_@@_info_ #1 _en_tl }
          }
        \tl_clear:N \l_@@_info_id_zh_tl
        \clist_clear:N \l_@@_info_fund_zh_clist
        \clist_clear:N \l_@@_info_fund_en_clist
      }
  }
%</thesis>
%    \end{macrocode}
%
% \subsubsection{格式选项}
%
% 定义 |sjtu/style| 键值类。
%
% 浮动体与公式编号中的分隔符。
%    \begin{macrocode}
\keys_define:nn { sjtu / style }
  {
    float-font              .tl_set:N = \SJTU@style@float@font ,
    float-font             .initial:n = \zihao { 5 } \fixedlineskip { 15.6 bp } ,
    caption-font              .code:n =
      { \DeclareCaptionFont { SJTU@font     } {#1} } ,
    caption-font           .initial:n = \zihao { 5 } \bfseries ,
    subcaption-font           .code:n =
      { \DeclareCaptionFont { SJTU@sub@font } {#1} } ,
    subcaption-font        .initial:n = \zihao { 5 } \normalfont ,
    fnmark-font             .tl_set:N = \l_@@_style_fnmark_font_tl ,
    fnmark-font            .initial:n = ,
    float-num-sep           .tl_set:N = \l_@@_style_fl_num_sep_tl ,
    float-num-sep          .initial:n = { -- } ,
    equation-num-sep        .tl_set:N = \l_@@_style_eq_num_sep_tl ,
    equation-num-sep       .initial:n = { -- } ,
    title-logo-color       .choice: ,
    title-logo-color      .choices:nn =
      { red, blue, black }
      { \tl_set_eq:NN \l_@@_style_title_logo_color_tl \l_keys_choice_tl } ,
    title-logo-color       .initial:n = { red } ,
    header-logo-color       .choice: ,
    header-logo-color     .choices:nn =
      { red, blue, black }
      { \tl_set_eq:NN \l_@@_style_header_logo_color_tl \l_keys_choice_tl } ,
    header-logo-color      .initial:n = { red } ,
    header-uppercase       .choice: ,
    header-uppercase / true   .code:n =
      { \cs_gset_eq:NN \@@_nouppercase:n \use:n } ,
    header-uppercase / false  .code:n =
      { \cs_gset:Nn \@@_nouppercase:n { \nouppercase {##1} } } ,
    header-uppercase       .default:n = { true } ,
%<!article>    header-uppercase       .initial:n = { false } ,
%<article>    header-uppercase       .initial:n = { true } ,
    header-font             .tl_set:N = \l_@@_style_header_font_tl ,
%<thesis>    header-font            .initial:n = \zihao { -5 } ,
%<!thesis>    header-font            .initial:n = \zihao { -5 } \sffamily ,
    footer-font             .tl_set:N = \l_@@_style_footer_font_tl ,
    footer-font            .initial:n = \zihao { -5 } ,
    page-number            .cs_set:Np = \@@_page:n #1 ,
    page-number            .initial:n = { {#1} }
  }
%</class>
%    \end{macrocode}
%
% \subsubsection{名称设置}
%
% 定义 |sjtu/name| 键值类。
%
% 设置标准文档类中已定义的名称。
%    \begin{macrocode}
%<*class>
\keys_define:nn { sjtu / name }
  {
    contents       .tl_set:N = \contentsname ,
    listfigure     .tl_set:N = \listfigurename ,
    listtable      .tl_set:N = \listtablename ,
    figure         .tl_set:N = \figurename ,
    table          .tl_set:N = \tablename ,
%<!thesis>    abstract       .tl_set:N = \abstractname ,
    index          .tl_set:N = \indexname ,
    appendix       .tl_set:N = \appendixname ,
    proof          .tl_set:N = \proofname ,
%<!article>    bib            .tl_set:N = \bibname ,
%<article>    bib            .tl_set:N = \refname ,
%    \end{macrocode}
%
% 标准文档类中未定义的名称。
%    \begin{macrocode}
    figure*        .tl_set:N = \SJTU@figurename@aux ,
    figure*       .initial:n = { 图 } ,
    table*         .tl_set:N = \SJTU@tablename@aux ,
    table*        .initial:n = { 表 } ,
    algorithm      .tl_set:N = \SJTU@algorithmname ,
    algorithm     .initial:n = { Algorithm } ,
    listalgorithm  .tl_set:N = \SJTU@listalgorithmname ,
    listalgorithm .initial:n = { List~of~Algorithms } ,
%<*thesis>
    abbr           .tl_set:N = \SJTU@abbrname ,
    abbr          .initial:n = { Abbreviations } ,
    nom            .tl_set:N = \SJTU@nomname ,
    nom           .initial:n = { Nomenclature } ,
    summary        .tl_set:N = \SJTU@summaryname ,
    summary       .initial:n = { Summary } ,
    ack            .tl_set:N = \SJTU@ackname ,
    ack           .initial:n = { Acknowledgements } ,
    resume         .tl_set:N = \SJTU@resumename ,
    resume        .initial:n = { Resume } ,
    digest         .tl_set:N = \SJTU@digestname ,
    digest        .initial:n = { Digest } ,
    achv           .tl_set:N = \SJTU@achvname ,
    achv          .initial:n = { List~of~Research~Achievements },
%</thesis>
  }
%</class>
%    \end{macrocode}
%
%    \begin{macrocode}
%<*lang&zh>
\keys_set_known:nn { sjtu / name }
  {
    contents      = 目 \quad 录 ,
    listfigure    = 插 \quad 图 ,
    listtable     = 表 \quad 格 ,
    figure        = 图 ,
    table         = 表 ,
%<!thesis>    abstract      = 摘 \quad 要 ,
    index         = 索 \quad 引 ,
    appendix      = 附录 ,
    proof         = 证明 ,
    bib           = 参考文献 ,
    figure*       = Figure ,
    table*        = Table ,
    algorithm     = 算法 ,
    listalgorithm = 算 \quad 法 ,
%<*thesis>
    abbr          = 缩略语对照表 ,
    nom           = 符号对照表 ,
    summary       = 全文总结 ,
    ack           = 致 \quad 谢 ,
    resume        = 个人简历 ,
    digest        = 大摘要 ,
    achv          = 学术论文和科研成果目录
%</thesis>
  }
%</lang&zh>
%    \end{macrocode}
%
% 载入语言配置。
%    \begin{macrocode}
%<*class>
%<thesis>\file_input:n { sjtu-lang-thesis- \g_@@_lang_tl .cfg }
%<report>\file_input:n { sjtu-lang-report- \g_@@_lang_tl .cfg }
%<article>\file_input:n { sjtu-lang-article- \g_@@_lang_tl .cfg }
%    \end{macrocode}
%
% \subsection{字体配置}
%
% \begin{macro}[int]{\@@_fontset_error:nn}
% 字库不可用时给出紧急错误信息，停止读取定义文件。
%    \begin{macrocode}
\cs_new_protected:Npn \@@_fontset_error:nn #1#2
  { \msg_error:nnnn { sjtutex } { font-unavailable } {#1} {#2} }
\msg_new:nnn { sjtutex } { font-unavailable }
  { `#1-font~ =~ #2'~ is~ unavailable~ in~ current~ mode. }
%    \end{macrocode}
% \end{macro}
%
% \begin{macro}[int]{\@@_fontset_case:nn}
% 2 个参数依次为 \pdfTeX 和 \XeTeX/\LuaTeX。
%    \begin{macrocode}
\cs_new_eq:NN \@@_fontset_case:nn \@@_engine_case:nn
%    \end{macrocode}
% \end{macro}
%
% \begin{macro}[int]{\@@_fontset_case:nnn}
% 3 个参数依次为 \pdfTeX（生成 PDF）、\pdfTeX（生成 DVI） 和
% \XeTeX/\LuaTeX。
%    \begin{macrocode}
\cs_new:Npx \@@_fontset_case:nnn #1#2#3
  {
    \@@_engine_case:nn
      { \sys_if_output_pdf:TF {#1} {#2} }
      {#3}
  }
%    \end{macrocode}
% \end{macro}
%
% \begin{macro}[int]{\@@_set_slanted_greek:}
%    \begin{macrocode}
\cs_new_protected:Nn \@@_set_slanted_greek:
  {
    \clist_const:Nn \c_@@_uppercase_greek_clist
      { Gamma, Delta, Theta, Lambda, Xi, Pi, Sigma, Upsilon, Phi, Psi, Omega }
    \clist_map_inline:Nn \c_@@_uppercase_greek_clist
      {
        \cs_set_eq:cc { up ##1 } {     ##1 }
        \cs_set_eq:cc { it ##1 } { var ##1 }
      }
    \bool_if:NT \g_@@_slanted_uppercase_greek_bool
      {
        \clist_map_inline:Nn \c_@@_uppercase_greek_clist
          { \cs_set_eq:cc { ##1 } { it ##1 } }
      }
  }
%    \end{macrocode}
% \end{macro}
%
% \begin{macro}[int]{\@@_set_unimath_symbol:}
%    \begin{macrocode}
\cs_new_protected:Nn \@@_set_unimath_symbol:
  {
    \cs_set_eq:NN \increment \upDelta
    \cs_set_eq:NN \QED \blacksquare
  }
%    \end{macrocode}
% \end{macro}
%
% 如果没有指定数学字体，则根据西文字体设置匹配的数字字体。
%    \begin{macrocode}
\tl_if_empty:NT \g_@@_math_font_tl
  { \tl_gset_eq:NN \g_@@_math_font_tl \g_@@_text_font_tl }
%    \end{macrocode}
%
% 根据操作系统判断默认中文字体配置。
%    \begin{macrocode}
\tl_if_empty:NT \g_@@_cjk_font_tl
  {
    \sys_if_platform_windows:TF
      { \tl_gset:Nn \g_@@_cjk_font_tl { windows } }
      {
        \ctex_if_platform_macos:TF
          { \tl_gset:Nn \g_@@_cjk_font_tl { mac    } }
          { \tl_gset:Nn \g_@@_cjk_font_tl { fandol } }
      }
  }
%    \end{macrocode}
%
% \begin{macro}[int]{\@@_load_font:nn,\@@_load_fontset:}
% 载入字体配置。如果字体配置文件不存在，则载入默认值，并给出警告。
%    \begin{macrocode}
\cs_new_protected:Npn \@@_load_font:nn #1#2
  {
    \str_if_eq:eeF { \tl_use:c { g_@@_ #1 _font_tl } } { none }
      {
        \file_if_exist:nF
          { sjtu- #1 -font- \tl_use:c { g_@@_ #1 _font_tl } .def }
          {
            \msg_warning:nnnn { sjtutex } { invalid-font } {#1} {#2}
            \tl_gset:cn { g_@@_ #1 _font_tl } {#2}
          }
        \ctex_file_input:n
          { sjtu- #1 -font- \tl_use:c { g_@@_ #1 _font_tl } .def }
      }
  }
\msg_new:nnn { sjtutex } { invalid-font }
  {
    Invalid~ value~ `#1-font~ =~ \tl_use:c { g_@@_ #1 _font_tl }~ '! \\\\
    Using~ `#2'~ instead.
  }
\cs_new_protected:Nn \@@_load_fontset:
  {
    \clist_map_inline:nn
      {
        { math } { newtx  },
        { text } { newtx  },
        { cjk  } { fandol }
      }
      { \@@_load_font:nn ##1 }
  }
\@onlypreamble \@@_load_font:nn
\@onlypreamble \@@_load_fontset:
\@@_load_fontset:
%</class>
%    \end{macrocode}
% \end{macro}
%
% \subsubsection{西文与数学字体}
%
%    \begin{macrocode}
%<*font&(math|text)>
%<*stixtwo>
\@@_fontset_case:nn
  {
%<*math>
    \PassOptionsToPackage { notext } { stix2 }
    \RequirePackage { upgreek, stix2, bm }
    \@@_set_slanted_greek:
%</math>
%<*text>
    \tl_set:Nn \rmdefault { stix2 }
    \tl_set:Nn \qhv@scale { 0.94 }
    \tl_set:Nn \sfdefault { qhv }
    \tl_set:Nn \ttdefault { qcr }
%</text>
  }
  {
%<*math>
    \RequirePackage { unicode-math }
    \bool_if:NTF \g_@@_upright_integral_bool
      {
        \setmathfont { STIXTwoMath-Regular.otf }
          [ StylisticSet = 8 ]
      }
      { \setmathfont { STIXTwoMath-Regular.otf } }
    \setmathfont { STIXTwoMath-Regular.otf }
      [
        range        = { scr, bfscr },
        StylisticSet = 1
      ]
%</math>
%<math>    \setmathrm
%<text>    \setmainfont
      { STIXTwoText }
      [
        Extension      = .otf,
        UprightFont    = *-Regular,
        BoldFont       = *-Bold,
        ItalicFont     = *-Italic,
        BoldItalicFont = *-BoldItalic
      ]
%</stixtwo>
%<*xits>
\@@_fontset_case:nn
%<math>  { \@@_fontset_error:nn { math } { xits } }
%<text>  { \@@_fontset_error:nn { text } { xits } }
  {
%<*math>
    \RequirePackage { unicode-math }
    \bool_if:NTF \g_@@_upright_integral_bool
      {
        \setmathfont { XITSMath-Regular }
          [
            Extension    = .otf,
            BoldFont     = XITSMath-Bold,
            StylisticSet = 8
          ]
      }
      {
        \setmathfont { XITSMath-Regular }
          [
            Extension    = .otf,
            BoldFont     = XITSMath-Bold,
          ]
      }
    \setmathfont { XITSMath-Regular.otf }
      [
        range        = { cal, bfcal },
        StylisticSet = 1
      ]
%</math>
%<math>    \setmathrm
%<text>    \setmainfont
      { XITS }
      [
        Extension      = .otf,
        UprightFont    = *-Regular,
        BoldFont       = *-Bold,
        ItalicFont     = *-Italic,
        BoldItalicFont = *-BoldItalic
      ]
%</xits>
%<*newtx|newpx>
%<*math>
\tl_set_eq:NN \g_@@_save_encodingdefault_tl \encodingdefault
\tl_set_eq:NN \g_@@_save_rmdefault_tl \rmdefault
\tl_set_eq:NN \g_@@_save_sfdefault_tl \sfdefault
\tl_set_eq:NN \g_@@_save_ttdefault_tl \ttdefault
\tl_set:Nn \encodingdefault { OT1 }
%<newtx>\tl_set:Nn \rmdefault { ntxtlf }
%<newpx>\tl_set:Nn \rmdefault { zplTLF }
\tl_set:Nn \qhv@scale { 0.94 }
\tl_set:Nn \sfdefault { qhv }
\tl_set:Nn \ttdefault { qcr }
%<newtx>\RequirePackage { newtxmath }
%<newpx>\RequirePackage { newpxmath }
\RequirePackage { bm }
\tl_set_eq:NN \encodingdefault \g_@@_save_encodingdefault_tl
\tl_set_eq:NN \rmdefault \g_@@_save_rmdefault_tl
\tl_set_eq:NN \sfdefault \g_@@_save_sfdefault_tl
\tl_set_eq:NN \ttdefault \g_@@_save_ttdefault_tl
\@@_set_unimath_symbol:
%</math>
%<*text>
\@@_fontset_case:nn
  {
%<newtx>    \RequirePackage { newtxtext }
%<newpx>    \RequirePackage { newpxtext }
    \tl_set:Nn \ttdefault { qcr }
  }
  {
    \setmainfont
%<newtx>      { TeXGyreTermesX }
%<newpx>      { TeXGyrePagellaX }
      [
        Extension       = .otf,
        UprightFont     = *-Regular,
        BoldFont        = *-Bold,
        ItalicFont      = *-Italic,
        BoldItalicFont  = *-BoldItalic
      ]
%</text>
%</newtx|newpx>
%<*text&(newtx|newpx)|stixtwo|xits>
%<math>    \setmathsf
%<text>    \setsansfont
      { texgyreheros }
      [
        Extension      = .otf,
        UprightFont    = *-regular,
        BoldFont       = *-bold,
        ItalicFont     = *-italic,
        BoldItalicFont = *-bolditalic,
        Scale          = 0.94,
      ]
%<math>    \setmathtt
%<text>    \setmonofont
      { texgyrecursor }
      [
        Extension      = .otf,
        UprightFont    = *-regular,
        BoldFont       = *-bold,
        ItalicFont     = *-italic,
        BoldItalicFont = *-bolditalic,
        Ligatures      = CommonOff
      ]
  }
%</text&(newtx|newpx)|stixtwo|xits>
%<*lm>
%<*text>
\tl_set:Nn \rmdefault { lmr  }
\tl_set:Nn \sfdefault { lmss }
\tl_set:Nn \ttdefault { lmtt }
%</text>
%<*math>
\RequirePackage { amssymb, upgreek }
\SetSymbolFont { operators    } { normal } { OT1 } { lmr  } { m  } { n  }
\SetSymbolFont { letters      } { normal } { OML } { lmm  } { m  } { it }
\SetSymbolFont { symbols      } { normal } { OMS } { lmsy } { m  } { n  }
\SetSymbolFont { largesymbols } { normal } { OMX } { lmex } { m  } { n  }
\SetSymbolFont { operators    } { bold   } { OT1 } { lmr  } { bx } { n  }
\SetSymbolFont { letters      } { bold   } { OML } { lmm  } { b  } { it }
\SetSymbolFont { symbols      } { bold   } { OMS } { lmsy } { b  } { n  }
\SetSymbolFont { largesymbols } { bold   } { OMX } { lmex } { m  } { n  }
\SetMathAlphabet { \mathbf } { normal } { OT1 } { lmr  } { bx } { n  }
\SetMathAlphabet { \mathsf } { normal } { OT1 } { lmss } { m  } { n  }
\SetMathAlphabet { \mathit } { normal } { OT1 } { lmr  } { m  } { it }
\SetMathAlphabet { \mathtt } { normal } { OT1 } { lmtt } { m  } { n  }
\SetMathAlphabet { \mathbf } { bold   } { OT1 } { lmr  } { bx } { n  }
\SetMathAlphabet { \mathsf } { bold   } { OT1 } { lmss } { bx } { n  }
\SetMathAlphabet { \mathit } { bold   } { OT1 } { lmr  } { bx } { it }
\SetMathAlphabet { \mathtt } { bold   } { OT1 } { lmtt } { m  } { n  }
\bool_if:NT \g_@@_upright_integral_bool
  { \RequirePackage { cmupint } }
\RequirePackage { bm }
\@@_set_slanted_greek:
\@@_set_unimath_symbol:
%</math>
%</lm>
%<*times>
%<*math>
\RequirePackage { amssymb, upgreek }
\tl_set_eq:NN \g_@@_save_rmdefault_tl \rmdefault
  \RequirePackage { mathptmx }
\tl_set_eq:NN \rmdefault \g_@@_save_rmdefault_tl
\tl_set:Nn \Hv@scale { 0.94 }
\DeclareMathAlphabet { \mathsf } { OT1 } { phv } { m } { n }
\DeclareMathAlphabet { \mathtt } { OT1 } { pcr } { m } { n }
\SetMathAlphabet { \mathsf } { bold } { OT1 } { phv } { b } { n }
\SetMathAlphabet { \mathtt } { bold } { OT1 } { pcr } { b } { n }
\bool_if:NT \g_@@_upright_integral_bool
  { \RequirePackage { cmupint } }
\RequirePackage { bm }
\@@_set_unimath_symbol:
%</math>
%<*text>
\@@_fontset_case:nn
  {
    \tl_set:Nn \rmdefault { ptm }
    \tl_set:Nn \Hv@scale { 0.94 }
    \tl_set:Nn \sfdefault { phv }
    \tl_set:Nn \ttdefault { pcr }
  }
  {
    \setmainfont { Times~New~Roman } [ Ligatures = Rare ]
    \setsansfont { Arial } [ Scale = 0.94 ]
    \setmonofont { Courier~New }
  }
%</text>
%</times>
%<*newcm>
\@@_fontset_case:nn
%<math>  { \@@_fontset_error:nn { math } { newcm } }
%<text>  { \@@_fontset_error:nn { text } { newcm } }
  {
%<*math>
    \RequirePackage { unicode-math }
    \bool_if:NTF \g_@@_upright_integral_bool
      {
        \setmathfont { NewCMMath-Book.otf }
          [ StylisticSet = 2 ]
      }
      { \setmathfont { NewCMMath-Book.otf } }
    \setmathfont { NewCMMath-Book.otf }
      [
        range        = { scr, bfscr },
        StylisticSet = 1
      ]
%</math>
%<math>    \setmathrm
%<text>    \setmainfont
      { NewCM10 }
      [
        Extension    = .otf,
        SizeFeatures =
          {
            {
              Size        = -9,
              Font        = NewCM08-Book,
              ItalicFont  = NewCM08-BookItalic,
              SlantedFont = NewCM08-Book,
            },
            { Size        = 9- }
          },
        UprightFont         = *-Book,
        BoldFont            = *-Bold,
        ItalicFont          = *-BookItalic,
        BoldItalicFont      = *-BoldItalic,
        SlantedFont         = *-Book,
        BoldSlantedFont     = *-Bold,
        SlantedFeatures     = { FakeSlant = 0.25 },
        BoldSlantedFeatures = { FakeSlant = 0.25 }
      ]
%<math>    \setmathsf
%<text>    \setsansfont
      { NewCMSans10 }
      [
        Extension    = .otf,
        SizeFeatures =
          {
            {
              Size       = -9,
              Font       = NewCMSans08-Book,
              ItalicFont = NewCMSans08-BookOblique,
            },
            { Size       = 9- }
          },
        UprightFont    = *-Book,
        BoldFont       = *-Bold,
        ItalicFont     = *-BookOblique,
        BoldItalicFont = *-BoldOblique
      ]
%<math>    \setmathtt
%<text>    \setmonofont
      { NewCMMono10 }
      [
        Extension           = .otf,
        UprightFont         = *-Book,
        BoldFont            = *-Bold,
        ItalicFont          = *-BookItalic,
        BoldItalicFont      = *-BoldOblique,
        SlantedFont         = *-Book,
        SlantedFeatures     = { FakeSlant = 0.25 },
        BoldSlantedFont     = *-Bold,
        BoldSlantedFeatures = { FakeSlant = 0.25 }
      ]
  }
%</newcm>
%<*cambria>
\@@_fontset_case:nn
%<math>  { \@@_fontset_error:nn { math } { cambria } }
%<text>  { \@@_fontset_error:nn { text } { cambria } }
  {
%<*math>
    \RequirePackage { unicode-math }
    \setmathfont { Cambria~Math }
    \setmathrm { Cambria }
    \setmathsf { Calibri }
    \setmathtt { Consolas } [ Scale = 0.95 ]
%</math>
%<*text>
    \setmainfont { Cambria }
    \setsansfont { Calibri }
    \setmonofont { Consolas } [ Scale = 0.95 ]
%</text>
  }
%</cambria>
%</font&(math|text)>
%    \end{macrocode}
%
% \pkg{unicode-math} 宏包
%    \begin{macrocode}
%<*class>
\ctex_at_end_package:nn { unicode-math }
  {
    \DeclareDocumentCommand \bm { m }
      { { \symbf {#1} } }
    \DeclareDocumentCommand \boldsymbol { m }
      { { \symbf {#1} } }
    \bool_if:NTF \g_@@_slanted_uppercase_greek_bool
      { \keys_set:nn { unicode-math } { math-style = ISO } }
      { \keys_set:nn { unicode-math } { math-style = TeX } }
    \bool_if:NTF \g_@@_integral_limits_bool
      { \removenolimits } { \addnolimits }
      {
        \int\iint\iiint\iiiint\oint\oiint\oiiint
        \intclockwise\varointclockwise\ointctrclockwise\sumint
        \intbar\intBar\fint\cirfnint\awint\rppolint
        \scpolint\npolint\pointint\sqint\intlarhk\intx
        \intcap\intcup\upint\lowint
      }
  }
%</class>
%    \end{macrocode}
%
% \subsubsection{中文字体}
%
% 在字体未提供对应粗体的情况下，允许使用伪粗。
%    \begin{macrocode}
%<*font&cjk>
%<*windows>
\@@_fontset_case:nn
  {
    \ctex_load_zhmap:nnnn { zhsong } { zhhei } { zhfs } { windows }
    \ctex_punct_set:n { windows }
    \ctex_punct_map_family:nn   { \CJKrmdefault } { zhsong }
    \ctex_punct_map_bfseries:nn { \CJKrmdefault } { zhhei  }
    \ctex_punct_map_itshape:nn  { \CJKrmdefault } { zhkai  }
  }
  {
    \setCJKmainfont { SimSun   }
      [ AutoFakeBold = 3, ItalicFont = KaiTi ]
    \setCJKsansfont { SimHei   } [ BoldFont = * ]
    \setCJKmonofont { FangSong }
    \setCJKfamilyfont { zhsong } { SimSun   }
      [ AutoFakeBold = 3, ItalicFont = KaiTi ]
    \setCJKfamilyfont { zhhei  } { SimHei   } [ BoldFont = * ]
    \setCJKfamilyfont { zhkai  } { KaiTi    }
    \setCJKfamilyfont { zhfs   } { FangSong }
  }
%</windows>
%<*mac>
\@@_fontset_case:nnn
  { \@@_fontset_error:nn { cjk } { mac } }
  {
    \ctex_load_zhmap:nnnn { zhsong } { zhhei } { zhfs } { mac }
    \ctex_punct_set:n { mac }
    \ctex_punct_map_family:nn   { \CJKrmdefault } { zhsong }
    \ctex_punct_map_family:nn   { \CJKsfdefault } { zhpf   }
    \ctex_punct_map_bfseries:nn { \CJKrmdefault } { zhpf   }
    \ctex_punct_map_itshape:nn  { \CJKrmdefault } { zhkai  }
  }
  {
    \setCJKmainfont { Songti~SC  }
      [
        UprightFont    = *~Light,
        BoldFont       = *~Bold,
        ItalicFont     = Kaiti~SC~Regular,
        BoldItalicFont = Kaiti~SC~Bold
      ]
    \setCJKsansfont { Heiti~SC   }
      [
        UprightFont    = *~Medium,
        BoldFont       = *~Medium
      ]
    \setCJKmonofont { STFangsong }
    \setCJKfamilyfont { zhsong } { Songti~SC  }
      [
        UprightFont    = *~Light,
        BoldFont       = *~Bold
      ]
    \setCJKfamilyfont { zhhei  } { Heiti~SC   }
      [
        UprightFont    = *~Medium,
        BoldFont       = *~Medium
      ]
    \setCJKfamilyfont { zhfs   } { STFangsong }
    \setCJKfamilyfont { zhkai  } { Kaiti~SC   }
      [
        UprightFont    = *~Regular,
        BoldFont       = *~Bold
      ]
  }
%</mac>
%<*ubuntu>
\@@_fontset_case:nnn
  { \@@_fontset_error:nn { cjk } { ubuntu } }
  {
    \ctex_load_zhmap:nnnn { zhsong } { zhhei } { zhsong } { ubuntu }
    \ctex_punct_set:n { ubuntu }
    \ctex_punct_map_family:nn   { \CJKrmdefault } { zhsong }
    \ctex_punct_map_bfseries:nn { \CJKrmdefault } { zhhei  }
    \ctex_punct_map_itshape:nn  { \CJKrmdefault } { zhkai  }
  }
  {
    \setCJKmainfont { Noto~Serif~CJK~SC     }
      [
        UprightFont = *~Light,
        BoldFont    = *~Bold,
        ItalicFont  = AR~PL~KaitiM~GB
      ]
    \setCJKsansfont { Noto~Sans~CJK~SC      }
      [
        UprightFont = *~Medium,
        BoldFont    = *~Medium
      ]
    \setCJKmonofont { Noto~Sans~Mono~CJK~SC }
    \setCJKfamilyfont { zhsong } { Noto~Serif~CJK~SC }
      [
        UprightFont = *~Light,
        BoldFont    = *~Bold,
        ItalicFont  = AR~PL~KaitiM~GB
      ]
    \setCJKfamilyfont { zhhei  } { Noto~Sans~CJK~SC  }
      [
        UprightFont = *~Medium,
        BoldFont    = *~Medium
      ]
    \setCJKfamilyfont { zhkai  } { AR~PL~KaitiM~GB   }
  }
%</ubuntu>
%<*adobe>
\@@_fontset_case:nnn
  { \@@_fontset_error:nn { cjk } { adobe } }
  {
    \ctex_load_zhmap:nnnn { zhsong } { zhhei } { zhfs } { adobe }
    \ctex_punct_set:n { adobe }
    \ctex_punct_map_family:nn   { \CJKrmdefault } { zhsong }
    \ctex_punct_map_bfseries:nn { \CJKrmdefault } { zhhei  }
    \ctex_punct_map_itshape:nn  { \CJKrmdefault } { zhkai  }
  }
  {
    \setCJKmainfont { AdobeSongStd-Light       }
      [ AutoFakeBold = 3, ItalicFont = AdobeKaitiStd-Regular ]
    \setCJKsansfont { AdobeHeitiStd-Regular    } [ BoldFont = * ]
    \setCJKmonofont { AdobeFangsongStd-Regular }
    \setCJKfamilyfont { zhsong } { AdobeSongStd-Light       }
      [ AutoFakeBold = 3, ItalicFont = AdobeKaitiStd-Regular ]
    \setCJKfamilyfont { zhhei  } { AdobeHeitiStd-Regular    } [ BoldFont = * ]
    \setCJKfamilyfont { zhfs   } { AdobeFangsongStd-Regular }
    \setCJKfamilyfont { zhkai  } { AdobeKaitiStd-Regular    }
  }
%</adobe>
%<*fandol>
\@@_fontset_case:nnn
  { \@@_fontset_error:nn { cjk } { fandol } }
  {
    \ctex_load_zhmap:nnnn { zhsong } { zhhei } { zhfs } { fandol }
    \ctex_punct_set:n { fandol }
    \ctex_punct_map_family:nn   { \CJKrmdefault } { zhsong }
    \ctex_punct_map_bfseries:nn { \CJKrmdefault } { zhhei  }
    \ctex_punct_map_itshape:nn  { \CJKrmdefault } { zhkai  }
  }
  {
    \setCJKmainfont { FandolSong }
      [
        Extension   = .otf,
        UprightFont = *-Regular,
        BoldFont    = *-Bold,
        ItalicFont  = FandolKai-Regular
      ]
    \setCJKsansfont { FandolHei  }
      [
        Extension   = .otf,
        UprightFont = *-Regular,
        BoldFont    = *-Regular,
      ]
    \setCJKmonofont { FandolFang }
      [
        Extension   = .otf,
        UprightFont = *-Regular,
      ]
    \setCJKfamilyfont { zhsong } { FandolSong }
      [
        Extension   = .otf,
        UprightFont = *-Regular,
        BoldFont    = *-Bold
      ]
    \setCJKfamilyfont { zhhei  } { FandolHei  }
      [
        Extension   = .otf,
        UprightFont = *-Regular,
        BoldFont    = *-Regular
      ]
    \setCJKfamilyfont { zhfs   } { FandolFang }
      [
        Extension   = .otf,
        UprightFont = *-Regular
      ]
    \setCJKfamilyfont { zhkai  } { FandolKai  }
      [
        Extension   = .otf,
        UprightFont = *-Regular
      ]
  }
%</fandol>
%<*founder>
\@@_fontset_case:nn
  {
    \ctex_load_zhmap:nnnn { zhsong } { zhhei } { zhfs } { founder }
    \ctex_punct_set:n { founder }
    \ctex_punct_map_family:nn   { \CJKrmdefault } { zhsong }
    \ctex_punct_map_bfseries:nn { \CJKrmdefault } { zhhei  }
    \ctex_punct_map_itshape:nn  { \CJKrmdefault } { zhkai  }
  }
  {
    \setCJKmainfont { FZShuSong-Z01  }
      [ AutoFakeBold = 3, ItalicFont = FZKai-Z03 ]
    \setCJKsansfont { FZHei-B01      } [ BoldFont = * ]
    \setCJKmonofont { FZFangSong-Z02 }
    \setCJKfamilyfont { zhsong } { FZShuSong-Z01  }
      [ AutoFakeBold = 3, ItalicFont = FZKai-Z03 ]
    \setCJKfamilyfont { zhhei  } { FZHei-B01      } [ BoldFont = * ]
    \setCJKfamilyfont { zhkai  } { FZKai-Z03      }
    \setCJKfamilyfont { zhfs   } { FZFangSong-Z02 }
  }
%</founder>
\NewDocumentCommand \songti   { } { \CJKfamily { zhsong  } }
\NewDocumentCommand \heiti    { } { \CJKfamily { zhhei   } }
%<!ubuntu>\NewDocumentCommand \fangsong { } { \CJKfamily { zhfs    } }
\NewDocumentCommand \kaishu   { } { \CJKfamily { zhkai   } }
%</font&cjk>
%    \end{macrocode}
%
% 带圈数字使用中文字体。
%    \begin{macrocode}
%<*class>
\@@_unicode_engine_case:nn
  {
    \xeCJK_declare_char_class:nn { CJK }
      { "24EA, "2460->"2473, "3251->"32BF, "25A1 }
  }
  {
    \ltjdefcharrange { 99 }
      { "24EA, "2460-"2473, "3251-"32BF, "25A1 }
    \ltjsetparameter { jacharrange = { +99 } }
  }
%    \end{macrocode}
%
% \subsection{页面布局}
%
% 利用 \pkg{geometry} 宏包设置页面边距以及页眉高度。
%    \begin{macrocode}
\geometry
  {
    top           = 3.5 cm,
    bottom        = 4.0 cm,
    left          = 2.5 cm,
    right         = 2.5 cm,
%<thesis>    bindingoffset = 0.5 cm,
    headheight    = 1.5 cm,
    headsep       = 0.5 cm,
    footskip      = 1.0 cm
  }
%    \end{macrocode}
%
% \subsection{页眉页脚}
%
% \pkg{ctex} 宏包使用 \opt{heading} 选项后，会把页面格式设置为 |headings|。
% 因此必须在 \pkg{ctex} 调用之后重新设置 \cs{pagestyle} 为 |fancy|。
%    \begin{macrocode}
\pagestyle { fancy }
%    \end{macrocode}
%
% 页码格式。
%    \begin{macrocode}
\cs_new:Nn \@@_thepage: { \thepage }
%    \end{macrocode}
%
% 设置页眉页脚。
%    \begin{macrocode}
\fancyhf { }
%<*!thesis>
\tl_set:Nn \l_@@_header_logo_tl
  {
    \includegraphics [ height = 1.2 cm ]
      { sjtu-vi-logo- \l_@@_style_header_logo_color_tl .pdf }
  }
%</!thesis>
\bool_if:NTF \g_@@_twoside_bool
  {
    \fancyhead [ RE, LO ]
%<thesis>      { \l_@@_style_header_font_tl \l_@@_info_subject_zh_tl   }
%<*!thesis>
      { \l_@@_header_logo_tl }
    \fancyhead [ RO ]
      {
        \l_@@_style_header_font_tl
%<report>        \@@_nouppercase:n { \rightmark }
%<article>        \@@_nouppercase:n
%<article>          { \MakeUppercase \l_@@_info_running_title_zh_tl }
      }
    \fancyhead [ LE ]
      {
%<report>        \@@_nouppercase:n { \leftmark  }
%<article>        \@@_nouppercase:n
%<article>          { \MakeUppercase \l_@@_info_subject_zh_tl       }
      }
%</!thesis>
%<thesis>    \fancyhead [ RO, LE ]
%<thesis>      { \l_@@_style_header_font_tl \@@_nouppercase:n { \leftmark } }
  }
  {
    \fancyhead [ L ]
%<thesis>      { \l_@@_style_header_font_tl \l_@@_info_subject_zh_tl   }
%<!thesis>      { \l_@@_header_logo_tl }
    \fancyhead [ R ]
      {
        \l_@@_style_header_font_tl
%<!article>        \@@_nouppercase:n { \leftmark }
%<article>        \@@_nouppercase:n
%<article>          { \MakeUppercase \l_@@_info_running_title_zh_tl }
      }
  }
\fancyfoot [ C ]
  {
    \l_@@_style_footer_font_tl
    \@@_page:n { \@@_thepage: }
  }
%    \end{macrocode}
%
% \cls{sjtuthesis} 的页眉线。
%    \begin{macrocode}
%<*thesis>
\cs_set:Npn \headrule
  {
    \hrule height 2.25 pt width \headwidth
    \skip_vertical:n {  0.75 pt }
    \hrule height 0.75 pt width \headwidth
    \skip_vertical:n { -3.75 pt }
  }
%</thesis>
%    \end{macrocode}
%
% 重定义 |plain| 样式。
%    \begin{macrocode}
%<*!thesis>
\bool_if:NTF \g_@@_twoside_bool
  {
    \fancypagestyle { plain }
      {
        \fancyhead [ RE, LO ] { }
        \tl_set:Nn \headrulewidth { 0 pt }
      }
  }
  {
    \fancypagestyle { plain }
      {
        \fancyhead [ R ] { }
        \tl_set:Nn \headrulewidth { 0 pt }
      }
  }
%</!thesis>
%    \end{macrocode}
%
% |SJTU@null| 样式，不对当前页面样式做任何修改。
%    \begin{macrocode}
\cs_new_eq:NN \ps@SJTU@null \prg_do_nothing:
%    \end{macrocode}
%
% |SJTU@fund@zh| 和 |SJTU@fund@en| 样式，页脚添加资助基金信息。
%    \begin{macrocode}
%<*thesis>
\clist_map_inline:nn
  { zh, en }
  {
    \cs_new:cpn { ps@SJTU@fund@ #1 }
      {
        \ps@empty
        \cs_set:Npn \@oddfoot
          {
            \begin{minipage} { \textwidth }
              \centering \zihao { - 5 }
              \clist_use:cn { l_@@_info_fund_ #1 _clist } { \par }
            \end{minipage}
          }
        \cs_set_eq:NN \@evenfoot \@oddfoot
      }
  }
%</thesis>
%    \end{macrocode}
%
% 空白页清空页眉页脚。
%    \begin{macrocode}
\RenewDocumentCommand \cleardoublepage { }
  {
    \clearpage
    \bool_if:NT \g_@@_twoside_bool
      {
        \int_if_odd:nF \c@page
          { \hbox:n { } \thispagestyle { empty } \newpage }
      }
  }
%    \end{macrocode}
%
% \subsection{页码设置}
%
% 文档初始页码编码设置。
%    \begin{macrocode}
%<thesis>\pagenumbering { Alph }
%    \end{macrocode}
%
% \begin{macro}{\frontmatter}
% 前置部分使用大写罗马数字编码。
%    \begin{macrocode}
%<*thesis>
\RenewDocumentCommand \frontmatter { }
  {
    \cleardoublepage
    \@mainmatterfalse
    \pagenumbering { Roman }
  }
%</thesis>
%    \end{macrocode}
% \end{macro}
%
% \subsection{章节标题结构}
%
% 设置章节标题样式。
%    \begin{macrocode}
%<*!article>
\ctex_set:nn { chapter }
  {
    pagestyle   = SJTU@null ,
    fixskip     = true ,
    beforeskip  = 24 bp ,
    afterskip   = 18 bp ,
    lofskip     = \c_zero_skip ,
    lotskip     = \c_zero_skip ,
    format      = \zihao { 3 } \bfseries \heiti \centering ,
    nameformat  = ,
    titleformat = ,
    aftername   = \quad ,
    afterindent = true
  }
%</!article>
%</class>
%<*lang&zh&(!article)>
\ctex_set:nn { chapter }
  {
    name        = { 第 , 章 } ,
    number      = \chinese { chapter }
  }
%</lang&zh&(!article)>
%<*class>
\ctex_set:nn { section }
  {
    beforeskip  = 24 bp ,
    afterskip   =  6 bp ,
    format      = \zihao { 4 } \bfseries \heiti ,
    afterindent = true
  }
\ctex_set:nn { subsection }
  {
    beforeskip  = 12 bp ,
    afterskip   =  6 bp ,
    format      = \zihao { -4 } \bfseries \heiti ,
    afterindent = true
  }
\ctex_set:nn { subsubsection }
  {
    beforeskip  =  6 bp ,
    afterskip   =  6 bp ,
    format      = \zihao { -4 } \normalfont ,
    afterindent = true
  }
\ctex_set:nn { paragraph }
  { afterindent = true }
\ctex_set:nn { subparagraph }
  { afterindent = true }
\ctex_set:n { secnumdepth = 3 }
%    \end{macrocode}
%
% \begin{macro}{\SJTU@head,\@@_pdf_bookmark:nn,\@@_phantom_section:}
% 定义一个灵活的章节标题命令专门处理不同的需求。
%    \begin{macrocode}
\NewDocumentCommand \SJTU@head { s O{#3} m O{#2} }
  {
%<!article>    \CTEX@chapter@break
    \IfBooleanTF {#1}
      { \tl_if_empty:nF {#4} { \@@_pdf_bookmark:nn { 0 } {#4} } }
      {
        \@@_phantom_section:
%<!article>        \addcontentsline { toc } { chapter } {#4}
%<article>        \addcontentsline { toc } { section } {#4}
      }
    \cs_set_eq:NN \@@_orig_ctex_gettitle:n \CTEX@gettitle
    \cs_set:Npn \CTEX@gettitle ##1 { \@@_orig_ctex_gettitle:n {#2} }
%<!article>    \chapter* {#3}
%<article>    \section* {#3}
    \cs_set_eq:NN \CTEX@gettitle \@@_orig_ctex_gettitle:n
    \@mkboth { \MakeUppercase {#2} } { \MakeUppercase {#2} }
  }
\cs_new:Npn \@@_head_aux:n   #1
  { \SJTU@head  {#1} }
\cs_new:Npn \@@_head_aux_s:n #1
  { \SJTU@head* {#1} }
\cs_new:Npn \@@_head_auxa_s:nn #1#2
  { \SJTU@head* {#1} [#2] }
\cs_new:Npn \@@_head_auxb_s:nn #1#2
  { \SJTU@head* [#1] {#2} }
\cs_generate_variant:Nn \@@_head_auxa_s:nn { Vn, VV }
\cs_generate_variant:Nn \@@_head_auxb_s:nn { no }
\cs_new_eq:NN \@@_pdf_bookmark:nn \use_none:nn
\cs_new_eq:NN \@@_phantom_section: \prg_do_nothing:
%    \end{macrocode}
% \end{macro}
%
% \subsection{段落}
%
% 全文首行缩进 2 字符。
%    \begin{macrocode}
\ctex_if_autoindent_touched:F
  { \ctex_set:n { autoindent = true } }
%    \end{macrocode}
%
% \begin{macro}[int]{\verse,\quotation}
% 修改诗歌和引用环境的缩进。
%    \begin{macrocode}
\ctex_patch_cmd:Nnn \verse { -1.5em } { -2 \ccwd }
\ctex_patch_cmd:Nnn \verse {  1.5em } {  2 \ccwd }
\ctex_patch_cmd:Nnn \quotation { 1.5em } { 2 \ccwd }
%    \end{macrocode}
% \end{macro}
%
% 使用 \pkg{enumitem} 调整默认列表环境的间距。
%    \begin{macrocode}
\setlist { nosep }
%    \end{macrocode}
%
% \subsection{浮动体}
%
% 下面这组命令使浮动对象的缺省值稍微宽松一点，从而防止幅度对象占据过多的
% 文本页面，也可以防止在很大空白的浮动页上放置很小的图形。
%    \begin{macrocode}
\tl_set:Nn \textfraction      { 0.15 }
\tl_set:Nn \topfraction       { 0.85 }
\tl_set:Nn \bottomfraction    { 0.65 }
\tl_set:Nn \floatpagefraction { 0.60 }
%    \end{macrocode}
%
% 设置浮动体内的字体。
%    \begin{macrocode}
\ctex_patch_cmd:Nnn \@floatboxreset
  { \normalsize } { \SJTU@style@float@font }
%    \end{macrocode}
%
% 题注格式。
%    \begin{macrocode}
\DeclareCaptionLabelSeparator { enskip } { \enskip }
\captionsetup
  {
    labelsep      = enskip ,
    justification = centering ,
    font          = SJTU@font
  }
\captionsetup [ sub ]
  {
    format        = hang ,
    justification = justified ,
    font          = SJTU@sub@font
  }
%    \end{macrocode}
%
% 双语题注。
%    \begin{macrocode}
\DeclareCaptionOption { aux-names } [ ]
  {
    \tl_set:Nn \figurename { \SJTU@figurename@aux }
    \tl_set:Nn \tablename  { \SJTU@tablename@aux  }
  }
\captionsetup [ bi-second ] { aux-names }
%    \end{macrocode}
%
% \begin{macro}{\SJTUcounterwithin}
%    \begin{macrocode}
\NewDocumentCommand \SJTUcounterwithin
  { s O{ \l_@@_style_fl_num_sep_tl } O{ \arabic } m m }
  {
    \@ifbothcounters {#4} {#5}
      {
        \@addtoreset {#4} {#5}
        \IfBooleanF {#1}
          {
            \cs_gset:cpo { the #4 }
              { \cs:w the #5 \cs_end: #2 #3 {#4} }
          }
      }
  }
%    \end{macrocode}
% \end{macro}
%
% 定义图、表、公式的编号格式。
%    \begin{macrocode}
%<*!article>
\cs_set:Npn \thefigure
  { \thechapter \l_@@_style_fl_num_sep_tl \arabic { figure   } }
\cs_set:Npn \thetable
  { \thechapter \l_@@_style_fl_num_sep_tl \arabic { table    } }
\cs_set:Npn \theequation
  { \thechapter \l_@@_style_eq_num_sep_tl \arabic { equation } }
%</!article>
%    \end{macrocode}
%
% \begin{macro}[int]{\@@_counter_without_chapter:}
% 特殊环境各计数器不随章编号。
%    \begin{macrocode}
%<*thesis>
\cs_new_protected:Nn \@@_counter_without_chapter:
  {
    \counterwithout { section } { chapter }
    \setcounter     { section } { 0 }
    \counterwithout { figure  } { chapter }
    \setcounter     { figure  } { 0 }
    \counterwithout { table   } { chapter }
    \setcounter     { table   } { 0 }
  }
%</thesis>
%    \end{macrocode}
% \end{macro}
%
% \subsection{脚注}
%
% \begin{macro}[int]{\@makefntext}
% 重定义内部脚注文字命令，使脚注编号不使用上标。
% 见 \url{https://www.zhihu.com/question/53030087}。
%    \begin{macrocode}
\cs_new_protected:Nn \@@_make_fnmark:
  { \hbox:n { \@thefnmark } }
\ctex_at_end_preamble:n {
  \cs_set_eq:NN \@@_orig_make_fntext:n \@makefntext
  \cs_set:Npn \@makefntext #1
    {
      \group_begin:
        \cs_set_eq:NN \@makefnmark \@@_make_fnmark:
        \@@_orig_make_fntext:n {#1}
      \group_end:
    }
}
\cs_new:Npn \@@_footnote_number:N #1
  {
    \int_compare:nNnTF {#1} < { 21 }
      { \@@_unicode_char:n { \int_eval:n { "2460 - 1 + #1 } } }
      {
        \int_compare:nNnTF {#1} < { 36 }
          { \@@_unicode_char:n { \int_eval:n { "3251 - 21 + #1 } } }
          {
            \int_compare:nNnTF {#1} < { 51 }
              { \@@_unicode_char:n { \int_eval:n { "32B1 - 36 + #1 } } }
              { \msg_warning:nn { sjtutex } { too-many-footnotes } }
          }
      }
  }
\msg_new:nnn { sjtutex } { too-many-footnotes }
  { Too~ many~ footnotes. }
\cs_set:Npn \thefootnote
  {
    \hbox:n { }
    { \l_@@_style_fnmark_font_tl \@@_footnote_number:N \c@footnote   }
  }
\cs_set:Npn \thempfootnote
  {
    \hbox:n { }
    { \l_@@_style_fnmark_font_tl \@@_footnote_number:N \c@mpfootnote }
  }
%    \end{macrocode}
% \end{macro}
%
% \subsection{标题页}
%
%    \begin{macrocode}
\DeclareObjectType { sjtu } { 0 }
\DeclareTemplateInterface { sjtu } { component } { 0 }
  {
    format      : tokenlist = \c_empty_tl ,
    content     : tokenlist = \c_empty_tl ,
    bottom-skip : skip      = \c_zero_skip ,
    align       : choice { left, right, center, normal } = center
  }
\DeclareTemplateCode { sjtu } { component } { 0 }
  {
    format      = \l_@@_component_format_tl ,
    content     = \l_@@_component_content_tl ,
    bottom-skip = \l_@@_component_bottom_skip ,
    align       =
      {
        left    =
          \cs_set_eq:NN \l_@@_component_align: \raggedright ,
        right   =
          \cs_set_eq:NN \l_@@_component_align: \raggedleft ,
        center  =
          \cs_set_eq:NN \l_@@_component_align: \centering ,
        normal  =
          \cs_set_eq:NN \l_@@_component_align: \prg_do_nothing:
      }
  }
  {
    \AssignTemplateKeys
    \group_begin:
      \l_@@_component_align:
      \l_@@_component_format_tl
      \l_@@_component_content_tl
      \par
    \group_end:
    \@@_vspace:N \l_@@_component_bottom_skip
  }
\DeclareTemplateInterface { sjtu } { page } { 0 }
  {
    bookmark      : boolean   = false ,
    bookmark-text : tokenlist = \c_empty_tl ,
    style         : tokenlist = empty ,
    format        : tokenlist = \linespread { 1 } \selectfont ,
    prefix        : tokenlist ,
    components    : commalist ,
    top-skip      : skip      = \c_zero_skip ,
    bottom-skip   : skip      = \c_zero_skip
  }
\DeclareTemplateCode { sjtu } { page } { 0 }
  {
    bookmark      = \l_@@_page_bookmark_bool ,
    bookmark-text = \l_@@_page_bookmark_text_tl ,
    style         = \l_@@_page_style_tl ,
    format        = \l_@@_page_format_tl ,
    prefix        = \l_@@_page_prefix_tl ,
    components    = \l_@@_page_components_clist ,
    top-skip      = \l_@@_page_top_skip ,
    bottom-skip   = \l_@@_page_bottom_skip
  }
  {
    \AssignTemplateKeys
%<!article>    \bool_if:NTF \g_@@_openright_bool
%<!article>      { \cleardoublepage } { \clearpage }
%<article>    \clearpage
    \bool_if:NT \l_@@_page_bookmark_bool
      { \@@_pdf_bookmark:nn { 0 } { \l_@@_page_bookmark_text_tl } }
    \exp_args:No \thispagestyle { \l_@@_page_style_tl }
%    \end{macrocode}
% 移除页面顶部 \tn{vspace*} 的多余空白。
% 见 \url{https://tex.stackexchange.com/questions/247513}。
%    \begin{macrocode}
    \@@_vspace_r:N \l_@@_page_top_skip
    \@@_vspace:n { - \tex_parskip:D      }
    \@@_vspace:n { - \tex_baselineskip:D }
    \group_begin:
      \l_@@_page_format_tl
      \clist_map_inline:Nn \l_@@_page_components_clist
        { \UseInstance { sjtu } { \l_@@_page_prefix_tl / ##1 } }
    \group_end:
    \@@_vspace:N \l_@@_page_bottom_skip
    \clearpage
  }
\cs_new:Npn \@@_declare_component:nnn #1#2#3
  { \DeclareInstance { sjtu } {#1/#2} { component } {#3} }
\cs_new:Npn \@@_declare_page:nn #1#2
  { \DeclareInstance { sjtu } {#1} { page } {#2} }
\cs_new:Npn \@@_title_page_info:nnn #1#2#3
  {
    \group_begin:
      \cs_set:Npn \l_@@_info_output_format:NNN ##1##2##3 {#3}
      \clist_clear:N \l_@@_tmpa_clist
      \clist_clear:N \l_@@_tmpb_clist
      \dim_set:Nn \l_@@_tmpb_dim { 5 em }
      \clist_map_inline:nn {#2}
        {
          \clist_put_right:No \l_@@_tmpa_clist
            { \cs:w c_@@_name_ ##1 _ #1 _tl \cs_end: }
          \clist_put_right:No \l_@@_tmpb_clist
            { \cs:w l_@@_info_ ##1 _ #1 _tl \cs_end: }
          \@@_dim_set_to_wd:Nv \l_@@_tmpa_dim { l_@@_info_ ##1 _ #1 _tl }
          \dim_set:Nn \l_@@_tmpb_dim
            { \dim_max:nn { \l_@@_tmpa_dim } { \l_@@_tmpb_dim } }
        }
      \bool_until_do:nn
        { \clist_if_empty_p:N \l_@@_tmpa_clist }
        {
          \clist_pop:NN \l_@@_tmpa_clist \l_@@_tmpa_tl
          \clist_pop:NN \l_@@_tmpb_clist \l_@@_tmpb_tl
          \l_@@_info_output_format:NNN
            \l_@@_tmpa_tl \l_@@_tmpb_dim \l_@@_tmpb_tl
          \skip_vertical:N \c_zero_dim
        }
    \group_end:
  }
\cs_generate_variant:Nn \@@_title_page_info:nnn { nxn }
\clist_map_inline:nn
  {
    { logo    }
      {
        content     =
          {
            \includegraphics [ width = 3 cm ]
              { sjtu-vi-badge- \l_@@_style_title_logo_color_tl .pdf }
%<*!thesis>
            \skip_vertical:n { 0.3 cm }
            \includegraphics [ width = 6.81 cm ]
              { sjtu-vi-name- \l_@@_style_title_logo_color_tl .pdf }
%</!thesis>
          }
      },
    { subject }
      {
        format      = \zihao { -2 } \fixedlineskip { 31.2 bp } ,
        content     = \l_@@_info_subject_zh_tl ,
        bottom-skip = \c_zero_dim plus 2 fill
      },
    { title   }
      {
        format      = \zihao { 2 } \bfseries \fixedlineskip { 31.2 bp } ,
        content     = \l_@@_info_display_title_zh_tl ,
        bottom-skip = \c_zero_dim plus 3 fill
      },
    { info    }
      {
        format      = \zihao { 4 } \fixedlineskip { 31.2 bp } ,
        content     =
          {
            \@@_title_page_info:nxn { zh }
              {
                author,
                id,
                supervisor,
                \tl_if_empty:NF \l_@@_info_assoc_supervisor_zh_tl
                  { assoc_supervisor },
%<thesis>                \tl_if_empty:NF \l_@@_info_co_supervisor_zh_tl
%<thesis>                  { co_supervisor },
                department,
%<thesis>                major,
%<thesis>                \int_compare:nNnF { \g_@@_thesis_type_int } = { 1 }
%<thesis>                  { degree }
              }
              {
                \@@_cjk_spread_box:nn { 5 em } { \heiti #1 }
                \c_@@_name_info_sep_zh_tl
                \@@_left_aligned_box:nn {#2} {#3}
              }
          } ,
        bottom-skip = 31.2 bp
      },
    { date    }
      {
        format      = \zihao { 4 } \bfseries \fixedlineskip { 31.2 bp } ,
        content     = \l_@@_info_date_zh_tl
      }
  }
  {
    \@@_declare_component:nnn { title / zh } #1
  }
\@@_declare_page:nn { title / zh }
  {
    bookmark      = true ,
    bookmark-text = \c_@@_name_title_page_tl ,
%<thesis>    style         = SJTU@fund@zh ,
    prefix        = title / zh ,
    components    = { logo, subject, title, info, date }
  }
%<*thesis>
\clist_map_inline:nn
  {
    { subject }
      {
        format      = \zihao { 4 } \bfseries \fixedlineskip { 31.2 bp } ,
        content     = \l_@@_info_subject_en_tl ,
        bottom-skip = \c_zero_dim plus 2 fill
      },
    { title   }
      {
        format      = \zihao { -2 } \bfseries \fixedlineskip { 31.2 bp } ,
        content     = \MakeUppercase \l_@@_info_display_title_en_tl ,
        bottom-skip = \c_zero_dim plus 2 fill
      },
    { info    }
      {
        format      = \zihao { 3 } \fixedlineskip { 31.2 bp } ,
        content     =
          {
            \@@_title_page_info:nxn { en }
              {
                author, supervisor,
                \tl_if_empty:NF \l_@@_info_assoc_supervisor_en_tl
                  { assoc_supervisor },
                \tl_if_empty:NF \l_@@_info_co_supervisor_en_tl
                  { co_supervisor }
              }
              { { \bfseries #1 \c_@@_name_info_sep_en_tl } {#3} }
          } ,
        bottom-skip = \c_zero_dim plus 3 fill
      },
    { date    }
      {
        format      = \zihao { 3 } \fixedlineskip { 31.2 bp } ,
        content     =
          {
            \l_@@_info_department_en_tl
            \skip_vertical:N \c_zero_skip
            \c_@@_name_univ_en_tl
            \skip_vertical:N \c_zero_skip
            \c_@@_name_address_en_tl
            \skip_vertical:N \c_zero_skip
            \l_@@_info_date_en_tl
          }
      },
  }
  {
    \@@_declare_component:nnn { title / en } #1
  }
\@@_declare_page:nn { title / en }
  {
    style       = SJTU@fund@en ,
    prefix      = title / en ,
    components  = { subject, title, info, date }
  }
\RenewDocumentCommand \maketitle { }
  {
    \UseInstance { sjtu } { title / zh }
    \UseInstance { sjtu } { title / en }
  }
%</thesis>
%<*!thesis>
\bool_if:NT \g_@@_titlepage_bool
  {
    \RenewDocumentCommand \maketitle { }
      { \UseInstance { sjtu } { title / zh } }
  }
%</!thesis>
%    \end{macrocode}
%
% \subsection{原创性声明及使用授权书}
%
%    \begin{macrocode}
%<*thesis>
\cs_new_protected:Npn \@@_signature:N #1
  {
    \parbox [ t ] { 12 em }
      { #1 \c_@@_signature_text_zh_tl }
  }
\clist_map_inline:nn
  {
    { orig / title }
      {
        format      = \zihao { 3 } \heiti \fixedlineskip { 31.2 bp } ,
        content     =
          {
            \c_@@_name_univ_zh_tl
            \skip_vertical:N \c_zero_skip
            \c_@@_name_thesis_zh_tl
            \c_@@_name_orig_decl_zh_tl
          } ,
        bottom-skip = 15.6 bp
      },
    { orig / text  }
      {
        format      = \zihao { -4 } \fixedlineskip { 23.4 bp } ,
        content     = \c_@@_orig_decl_text_zh_tl ,
        bottom-skip = 15.6 bp ,
        align       = normal
      },
    { orig / sign  }
      {
        format      = \zihao { 4 } \fixedlineskip { 31.2 bp } ,
        content     =
          {
            \@@_signature:N \c_@@_name_decl_author_zh_tl
            \skip_horizontal:n { 4 em } \hbox:n { }
          } ,
        bottom-skip = \c_zero_dim plus 2 fill ,
        align       = right
      },
    { auth / title }
      {
        format      = \zihao { 3 } \heiti \fixedlineskip { 31.2 bp } ,
        content     =
          {
            \c_@@_name_univ_zh_tl
            \skip_vertical:N \c_zero_skip
            \c_@@_name_thesis_zh_tl
            \c_@@_name_auth_decl_zh_tl
          } ,
        bottom-skip = 15.6 bp
      },
    { auth / text  }
      {
        format      = \zihao { -4 } \fixedlineskip { 23.4 bp } ,
        content     = \c_@@_auth_decl_text_zh_tl ,
        bottom-skip = 15.6 bp ,
        align       = normal
      },
    { auth / sign  }
      {
        format      = \zihao { 4 } \fixedlineskip { 31.2 bp } ,
        content     =
          {
            \@@_signature:N \c_@@_name_decl_author_zh_tl
            \hfill
            \@@_signature:N \c_@@_name_decl_supervisor_zh_tl
          } ,
        bottom-skip = \c_zero_dim plus 1 fill ,
        align       = normal
      }
  }
  {
    \@@_declare_component:nnn { copyright } #1
  }
\@@_declare_page:nn { copyright }
  {
    bookmark      = true ,
    bookmark-text = \c_@@_name_decl_tl ,
    prefix        = copyright ,
    components    =
      {
        orig / title, orig / text, orig / sign,
        auth / title, auth / text, auth / sign
      }
  }
\msg_new:nnn { sjtutex } { require-pdfpages }
  {
    Add~"\token_to_str:N \usepackage{pdfpages}"~ in~ your~ preamble \\
    before~ inserting~ pages~ of~ external~ PDF.
  }
\NewDocumentCommand \copyrightpage { O{ } }
  {
    \bool_if:NF \g_@@_review_bool
      {
        \tl_if_blank:nTF {#1}
          { \UseInstance { sjtu } { copyright } }
          {
            \cs_if_exist:NTF \includepdf
              {
                \bool_if:NTF \g_@@_openright_bool
                  { \cleardoublepage } { \clearpage }
                \@@_pdf_bookmark:nn { 0 } { \c_@@_name_decl_tl }
                \includepdf {#1}
              }
              {
                \msg_warning:nn { sjtutex } { require-pdfpages }
                \UseInstance { sjtu } { copyright }
              }
          }
      }
  }
%</thesis>
%    \end{macrocode}
%
% \subsection{摘要}
%
%    \begin{macrocode}
\cs_new:Nn \@@_output_keywords:Nnn
  {
    \clist_if_empty:NF #1
      {
        \par \mode_leave_vertical: \par \noindent
        { \bfseries #2 } \clist_use:Nn #1 {#3}
      }
  }
%<*thesis>
\DeclareDocumentEnvironment { abstract  } { }
  { \@@_head_auxa_s:VV \c_@@_name_abstract_zh_tl \c_@@_name_abstract_tl }
  {
    \@@_output_keywords:Nnn \l_@@_info_keywords_zh_clist
      { \c_@@_name_keywords_zh_tl } { \c_@@_name_item_sep_zh_tl }
  }
\DeclareDocumentEnvironment { abstract* } { }
  { \@@_head_auxa_s:Vn \c_@@_name_abstract_en_tl { } }
  {
    \@@_output_keywords:Nnn \l_@@_info_keywords_en_clist
      { \c_@@_name_keywords_en_tl } { \c_@@_name_item_sep_en_tl }
  }
%</thesis>
%<*!thesis>
\bool_if:NTF \g_@@_titlepage_bool
  {
    \DeclareDocumentEnvironment { abstract } { }
      {
%<article>        \clearpage
        \@@_head_aux_s:n { \abstractname }
      }
      {
        \@@_output_keywords:Nnn \l_@@_info_keywords_zh_clist
          { \c_@@_name_keywords_tl } { \c_@@_name_item_sep_tl }
        \clearpage
      }
  }
  {
    \@@_preto_cmd:Nn \endabstract
      {
        \@@_output_keywords:Nnn \l_@@_info_keywords_zh_clist
          { \c_@@_name_keywords_tl } { \c_@@_name_item_sep_tl }
      }
  }
%</!thesis>
%    \end{macrocode}
%
% \subsection{目录}
%
% \begin{macro}{\tableofcontents}
% \begin{macro}{\listoffigures}
% \begin{macro}{\listoffigures*}
% \begin{macro}{\listoftables}
% \begin{macro}{\listoftables*}
% 目录以及图表索引。
%    \begin{macrocode}
\DeclareDocumentCommand \tableofcontents { }
  {
    \@@_head_aux_s:n { \contentsname }
    \@starttoc { toc }
  }
\NewDocumentCommand \SJTU@listof { m m s }
  {
    \IfBooleanTF {#3}
      { \@@_head_aux_s:n {#1} }
      { \@@_head_aux:n   {#1} }
    \exp_args:Nv \@starttoc { ext@ #2 }
  }
\DeclareDocumentCommand \listoffigures { }
  { \SJTU@listof { \listfigurename } { figure } }
\DeclareDocumentCommand \listoftables  { }
  { \SJTU@listof { \listtablename  } { table  } }
%    \end{macrocode}
% \end{macro}
% \end{macro}
% \end{macro}
% \end{macro}
% \end{macro}
%
%    \begin{macrocode}
%<zh>\tl_set:Nn \cftdot { \textperiodcentered }
\tl_set:Nn \cftdotsep { 1 }
%<!article>\tl_set:Nn \cftchapleader { \normalfont \cftdotfill { \cftdotsep } }
%    \end{macrocode}
%
% 图表清单标题前添加名称。
%    \begin{macrocode}
\cs_new_protected:Nn \@@_update_cft_presnum:
  {
    \tl_set:Nn \cftfigpresnum { \figurename \c_space_tl }
    \@@_dim_add_to_wd:Nn \cftfignumwidth { \cftfigpresnum }
    \tl_set:Nn \cfttabpresnum { \tablename  \c_space_tl }
    \@@_dim_add_to_wd:Nn \cfttabnumwidth { \cftfigpresnum }
  }
\ctex_at_end_preamble:n
  { \@@_update_cft_presnum: }
%    \end{macrocode}
%
% \subsection{预定义环境}
%
% 缩略语对照表。
%    \begin{macrocode}
%<*thesis>
\NewDocumentEnvironment { abbreviation  } { O{ \SJTU@abbrname } }
  {
    \@@_head_aux:n   {#1}
    \tl_clear:N \SJTU@style@float@font
  } { }
\NewDocumentEnvironment { abbreviation* } { O{ \SJTU@abbrname } }
  {
    \@@_head_aux_s:n {#1}
    \tl_clear:N \SJTU@style@float@font
  } { }
%    \end{macrocode}
%
% 符号对照表。
%    \begin{macrocode}
\NewDocumentEnvironment { nomenclature  } { O{ \SJTU@nomname } }
  {
    \@@_head_aux:n   {#1}
    \tl_clear:N \SJTU@style@float@font
  } { }
\NewDocumentEnvironment { nomenclature* } { O{ \SJTU@nomname } }
  {
    \@@_head_aux_s:n {#1}
    \tl_clear:N \SJTU@style@float@font
  } { }
%    \end{macrocode}
%
% 全文总结。
%    \begin{macrocode}
\NewDocumentEnvironment { summary } { O{ \SJTU@summaryname } }
  { \@@_head_aux:n {#1} } { }
%    \end{macrocode}
%
% 致谢，盲审模式下隐藏致谢。
%    \begin{macrocode}
\NewDocumentEnvironment { acknowledgements } { O{ \SJTU@ackname } +b }
  {
    \bool_if:NF \g_@@_review_bool
      {
        \@@_head_aux:n {#1}
        #2
      }
  } { }
%    \end{macrocode}
%
% 发表论文与学术成果。
%    \begin{macrocode}
\newcounter { SJTU@bib }
\NewDocumentEnvironment { @bibliolist } { m }
  {
    \cs_if_exist_use:N \bibfont
    \list
      { \@biblabel { \arabic{ SJTU@bib } } }
      {
        \@@_dim_set_to_wd:Nn \labelwidth { \@biblabel {#1} }
        \dim_set_eq:NN \leftmargin \labelwidth
        \dim_add:Nn    \leftmargin { \labelsep }
        \dim_if_exist:NTF \bibitemsep
          {
            \dim_set_eq:NN \itemsep \bibitemsep
            \dim_if_exist:NT \bibparsep
              { \dim_set_eq:NN \parsep \bibparsep }
          }
          {
            \dim_if_exist:NT \bibsep
              {
                \dim_set_eq:NN \itemsep \bibsep
                \dim_zero:N    \parsep
              }
          }
        \@nmbrlisttrue
        \tl_set:Nn  \@listctr    { SJTU@bib }
        \cs_set:Npn \p@SJTU@bib  { }
        \cs_set:Npn \theSJTU@bib { \arabic { SJTU@bib } }
      }
      \sloppy
      \int_set:Nn \clubpenalty  { 4000 }
      \int_set_eq:NN \@clubpenalty \clubpenalty
      \int_set:Nn \widowpenalty { 4000 }
      \char_set_sfcode:nn { `\. } { 1000 }
  }
  {
    \cs_set:Npn \@noitemerr
      { \msg_warning:nnn { sjtutex } { empty-environment } { bibliolist } }
    \endlist
  }
\msg_new:nnn { sjtutex } { empty-environment }
  { Empty~ `#1'~ environment. }
\NewDocumentEnvironment { achievements } { O{ \SJTU@achvname } }
  { \@@_head_aux:n {#1} } { }
\NewDocumentEnvironment { bibliolist  } { m +b }
  {
    \bool_if:NF \g_@@_review_bool
      {
        \cs_set:Npn \@noitemerr { }
        \begin { @bibliolist } {#1}
        #2
        \end { @bibliolist }
      }
  } { }
\NewDocumentEnvironment { bibliolist* } { m +b }
  {
    \bool_if:NT \g_@@_review_bool
      {
        \cs_set:Npn \@noitemerr { }
        \begin { @bibliolist } {#1}
        #2
        \end { @bibliolist }
      }
  } { }
%    \end{macrocode}
%
% 简历。
%    \begin{macrocode}
\NewDocumentEnvironment { resume } { O{ \SJTU@resumename } +b }
  {
    \bool_if:NF \g_@@_review_bool
      {
        \@@_head_aux:n {#1}
        #2
      }
  } { }
%    \end{macrocode}
%
% 大摘要。
%    \begin{macrocode}
\NewDocumentEnvironment { digest } { +b }
  {
    \AtEndDocument
      {
        \bool_if:NTF \g_@@_openright_bool
          { \cleardoublepage } { \clearpage }
        \pagenumbering { roman }
        \cs_gset:Nn \@@_thepage: { \arabic { page } }
        \cs_gset_eq:NN \addcontentsline \use_none:nnn
        \@@_counter_without_chapter:
        \@@_head_auxb_s:no { \SJTU@digestname }
          { \exp_args:NV \MakeUppercase \l_@@_info_title_aux_tl }
        #1
      }
  } { }
%</thesis>
%    \end{macrocode}
%
% \subsection{其他宏包的设置}
%
% 这些宏包并非格式要求，但是为了方便同学们使用，在这里进行简单设置。
%
% \subsubsection{\pkg{hyperref} 宏包}
%
%    \begin{macrocode}
\ctex_at_end_package:nn { hyperref }
  {
    \hypersetup
      {
        linktoc            = all,
        bookmarksdepth     = 2,
        bookmarksnumbered  = true,
        bookmarksopen      = true,
        bookmarksopenlevel = 1,
        unicode            = true,
        psdextra           = true,
        breaklinks         = true,
        pdfdisplaydoctitle = true
      }
    \int_new:N \g_@@_bookmark_int
    \cs_gset_protected:Npn \@@_pdf_bookmark:nn #1#2
      {
        \phantomsection
        \int_gincr:N \g_@@_bookmark_int
        \pdfbookmark [#1] {#2}
          { sjtubookmark. \int_use:N \g_@@_bookmark_int }
      }
    \cs_gset_eq:NN \@@_phantom_section: \phantomsection
    \pdfstringdefDisableCommands
      {
        \cs_set_eq:NN \\       \prg_do_nothing:
        \cs_set_eq:NN \quad    \c_empty_tl
        \cs_set_eq:NN \qquad   \c_empty_tl
        \cs_set_eq:NN \hspace  \use_none:n
      }
    \ctex_after_end_preamble:n
      {
        \hypersetup
          {
            pdftitle    = \l_@@_info_title_zh_tl,
            pdfsubject  = \l_@@_info_subject_zh_tl,
            pdfkeywords = \l_@@_info_keywords_zh_clist,
            pdfauthor   = \l_@@_info_author_zh_tl
          }
      }
  }
%    \end{macrocode}
%
% \subsubsection{\pkg{threeparttable} 宏包}
%
%    \begin{macrocode}
\ctex_at_end_package:nn { threeparttable }
  { \tl_put_right:Nn \TPTnoteSettings { \footnotesize } }
%    \end{macrocode}
%
% \subsubsection{\pkg{longtable} 宏包}
%
%    \begin{macrocode}
\ctex_at_end_package:nn { longtable }
  { \AtBeginEnvironment { longtable } { \SJTU@style@float@font } }
%    \end{macrocode}
%
% \subsubsection{\pkg{amsthm} 宏包和 \pkg{ntheorem} 宏包}
%
%    \begin{macrocode}
\cs_new_protected:Nn \@@_new_theorems:
  {
    \clist_map_inline:nn
      {
        assumption, axiom, conjecture, corollary, definition, example,
        exercise, lemma, problem, proposition, theorem
      }
%<!article>      { \exp_args:Nnv  \newtheorem  {##1} { c_@@_name_ ##1 _tl } [ chapter ] }
%<article>      { \exp_args:Nnv  \newtheorem  {##1} { c_@@_name_ ##1 _tl } }
    \clist_map_inline:nn
      { remark, solution }
      { \exp_args:NNnv \newtheorem* {##1} { c_@@_name_ ##1 _tl } }
  }
%    \end{macrocode}
%
% \pkg{amsthm} 宏包
%    \begin{macrocode}
\ctex_at_begin_package:nn { amsthm }
  {
    \cs_if_exist:NT \openbox
      {
        \cs_new_eq:NN \@@_save_openbox: \openbox
        \cs_undefine:N \openbox
      }
  }
\ctex_at_end_package:nn { amsthm }
  {
    \cs_if_exist:NT \@@_save_openbox:
      { \cs_set_eq:NN \openbox \@@_save_openbox: }
    \tl_set:Nn \qedsymbol { \ensuremath { \QED } }
    \RenewDocumentEnvironment { proof } { O{ \proofname } }
      {
        \par \pushQED { \qed }
        \normalfont \dim_zero:N \topsep
        \trivlist
        \item
          [
            \skip_horizontal:N \labelsep
            \bfseries \heiti #1 \@addpunct { \enskip }
          ]
        \ignorespaces
      }
      { \popQED \endtrivlist \legacy_if_set_false:n { @endpe } }
    \newtheoremstyle { sjtu }
      { } { } { \normalfont } { } { \bfseries \heiti } { } { \ccwd } { }
    \theoremstyle { sjtu }
    \@@_new_theorems:
  }
%    \end{macrocode}
%
% \pkg{ntheorem} 宏包
%    \begin{macrocode}
\ctex_at_end_package:nn { ntheorem }
  {
    \theoremheaderfont { \bfseries \heiti }
    \theorembodyfont   { \normalfont      }
    \theoremseparator  { \enskip          }
    \theoremsymbol { \ensuremath { \QED } }
    \qedsymbol     { \ensuremath { \QED } }
    \newtheorem* { proof } { \proofname }
    \theoremsymbol { }
    \@@_new_theorems:
  }
%    \end{macrocode}
%
% \subsubsection{\pkg{algorithm} 宏包和 \pkg{algorithm2e} 宏包}
%
%    \begin{macrocode}
\cs_new_protected:Npn \@@_newlistof:nnnnn #1#2#3#4#5
  {
    \exp_args:Nnv \newlistentry {#2} { ext@ #3 } { 0 }
    \exp_args:Ne \newcounter { \tl_use:c { ext@ #3 } depth }
    \exp_args:Ne \setcounter { \tl_use:c { ext@ #3 } depth } { 1 }
    \dim_set:cn { cft #2 indent   } { 1.5 em }
    \dim_set:cn { cft #2 numwidth } { 2.3 em }
    \cs_set_eq:cc { l@ #3 } { l@ #2 }
    \@@_appto_cmd:Nn \@@_update_cft_presnum:
      {
        \tl_set:cn { cft #2 presnum } { #4 \c_space_tl }
        \@@_dim_add_to_wd:cv { cft #2 numwidth } { cft #2 presnum }
      }
    \exp_args:Nc \DeclareDocumentCommand { listof #1 s } { }
      { \SJTU@listof {#5} {#3} }
%<!article>    \cs_set:cpn { the #3 }
%<!article>      { \thechapter \l_@@_style_fl_num_sep_tl \arabic {#3} }
%<*thesis>
    \@@_appto_cmd:Nn \@@_counter_without_chapter:
      {
        \counterwithout {#3} { chapter }
        \setcounter     {#3} { 0 }
      }
%</thesis>
  }
%    \end{macrocode}
%
% \pkg{algorithm} 宏包
%    \begin{macrocode}
\ctex_at_end_package:nn { algorithm }
  {
    \tl_set:Nn \fname@algorithm   { \SJTU@algorithmname     }
    \tl_set:Nn \listalgorithmname { \SJTU@listalgorithmname }
    \@@_newlistof:nnnnn { algorithm } { alg } { algorithm }
      { \fname@algorithm } { \listalgorithmname }
  }
%    \end{macrocode}
%
% \pkg{algorithm2e} 宏包
%    \begin{macrocode}
%<!article>\ctex_at_begin_package:nn { algorithm2e }
%<!article>  { \cs_set_eq:NN \@@_save_chapter:w \@chapter }
\ctex_at_end_package:nn { algorithm2e }
  {
%<!article>    \cs_set_eq:NN \@chapter \@@_save_chapter:w
    \SetAlgorithmName { \SJTU@algorithmname     }
                      { \SJTU@algorithmname     }
                      { \SJTU@listalgorithmname }
    \SetAlgoCaptionSeparator { \enskip }
    \@@_newlistof:nnnnn { algorithm } { alg } { algocf }
      { \algorithmcfname } { \listalgorithmcfname }
    \ctex_patch_cmd:Nnn \algocf@latexcaption
      { \addcontentsline }
      { \caption@iflist { \addcontentsline } { \@gobblethree } }
  }
%    \end{macrocode}
%
% \subsubsection{\pkg{listings} 宏包}
%    \begin{macrocode}
\ctex_at_end_package:nn { listings }
  {
    \lstdefinestyle { lstStyleCode }
      {
        aboveskip         = \medskipamount ,
        belowskip         = \medskipamount ,
        basicstyle        = \ttfamily \zihao { 6 } ,
        commentstyle      = \slshape \color { black!60 } ,
        stringstyle       = \color { green!40!black!100 } ,
        keywordstyle      = \bfseries \color { blue!50!black } ,
        extendedchars     = false ,
        upquote           = true ,
        tabsize           = 2 ,
        showstringspaces  = false ,
        xleftmargin       = 1 em ,
        xrightmargin      = 1 em ,
        breaklines        = false ,
        framexleftmargin  = 1 em ,
        framexrightmargin = 1 em ,
        backgroundcolor   = \color { gray!10 } ,
        columns           = flexible ,
        keepspaces        = true ,
        texcl             = true ,
        mathescape        = true
      }
  }
%    \end{macrocode}
%
% \subsubsection{\pkg{nomencl} 宏包}
%    \begin{macrocode}
\ctex_at_end_package:nn { nomencl }
  { \tl_set:Nn \nomname { \SJTU@nomname } }
%    \end{macrocode}
%
%    \begin{macrocode}
%</class>
%    \end{macrocode}
%
% \subsection{名称配置}
%    \begin{macrocode}
%<*name>
%<*thesis>
\@@_define_symbol:nn { white_square } { "25A1 }
\@@_define_name_from_clist:nNnn { degree_level }
  \g_@@_thesis_type_int
  { 学士    , 硕士  , 博士   }
  { Bachelor, Master, Doctor }
%</thesis>
\clist_map_inline:nn
  {
%<!thesis>    { author           } { 姓名         } ,
    { id               } { 学号         } ,
%<!thesis>    { supervisor       } { 指导教师     } ,
%<!thesis>    { assoc_supervisor } { 副指导教师   } ,
    { department       } { 院系         } ,
%<*thesis>
    { major            } { 学科 / 专业  } ,
    { degree           } { 申请学位     } ,
    { thesis           } { 学位论文     } ,
    { decl_author      } { 学位论文作者 } ,
    { decl_supervisor  } { 指导教师     }
%</thesis>
  }
  { \@@_define_name:nn #1 }
%<*thesis>
\clist_map_inline:nn
  {
    { author           } { 姓名     } { Author             } ,
    { supervisor       } { 导师     } { Supervisor         } ,
    { assoc_supervisor } { 副导师   } { Assoc.~ Supervisor } ,
    { co_supervisor    } { 联合导师 } { Co-supervisor      }
  }
  { \@@_define_name:nnn #1 }
%</thesis>
\clist_map_inline:nn
  {
    { univ       } { 上海交通大学    } { Shanghai~ Jiao~ Tong~ University } ,
    { address    } { 中国 \quad 上海 } { Shanghai,~ P.R.~ China           } ,
    { title_page } { 题名页          } { Title~ Page                } ,
%<*thesis>
    { orig_decl  } { 原创性声明      } { Statement~ of~ Originality } ,
    { auth_decl  } { 使用授权书      } { Copyright~ Permission      } ,
    { decl       }
      {
        \c_@@_name_orig_decl_zh_tl
        及
        \c_@@_name_auth_decl_zh_tl
      }
      {
        { \c_@@_name_orig_decl_en_tl }~
        and~
        { \c_@@_name_auth_decl_en_tl }
      } ,
    { abstract } { 摘 \quad 要 } { Abstract    } ,
%</thesis>
    { keywords } { 关键词：    } { Key~words:~ } ,
    { info_sep } { ： } { :~ } ,
    { item_sep } { ， } { ,~ }
  }
  { \@@_define_name_g:nnn #1 }
%<*thesis>
\tl_const:Nn \c_@@_orig_decl_text_zh_tl
  {
    本人郑重声明：所呈交的学位论文，是本人在导师的指导下，独立进行研究工
    作所取得的成果。除文中已经注明引用的内容外，本论文不包含任何其他个人
    或集体已经发表或撰写过的作品成果。对本文的研究做出重要贡献的个人和集
    体，均已在文中以明确方式标明。本人完全知晓本声明的法律后果由本人承
    担。
  }
\tl_const:Nn \c_@@_auth_decl_text_zh_tl
  {
    本人同意学校保留并向国家有关部门或机构送交论文的复印件和电子版，允许
    论文被查阅和借阅。 \par
    \vskip 6 bp
    \noindent
    本学位论文属于： \par
    { \c_@@_symbol_white_square_tl } \textbf { 公开论文 } \par
    { \c_@@_symbol_white_square_tl } \textbf { 内部论文 }，
      保密 { \c_@@_symbol_white_square_tl }~ 1~ 年 /
           { \c_@@_symbol_white_square_tl }~ 2~ 年 /
           { \c_@@_symbol_white_square_tl }~ 3~ 年，
      过保密期后适用本授权书。 \par
    { \c_@@_symbol_white_square_tl } \textbf { 秘密论文 }，
      保密 \underline { \hspace { 2 em } } 年（不超过~ 10~ 年），
      过保密期后适用本授权书。 \par
    { \c_@@_symbol_white_square_tl } \textbf { 机密论文 }，
      保密 \underline { \hspace { 2 em } } 年（不超过~ 20~ 年），
      过保密期后适用本授权书。 \par
    \hspace { 6 em }（请在以上方框内选择打“ \ensuremath { \checkmark } ”）
  }
\tl_const:Nn \c_@@_signature_text_zh_tl
  {
    签名： \\
    日期： \hspace { \stretch { 3 } } 年
           \hspace { \stretch { 2 } } 月
           \hspace { \stretch { 2 } } 日
  }
%</thesis>
%</name>
%    \end{macrocode}
%
%    \begin{macrocode}
%<*lang>
\clist_map_inline:nn
  {
    { assumption  }
%<zh>    { 假设        } ,
%<en>    { Assumption  } ,
    { axiom       }
%<zh>    { 公理        } ,
%<en>    { Axiom       } ,
    { conjecture  }
%<zh>    { 猜想        } ,
%<en>    { Conjecture  } ,
    { corollary   }
%<zh>    { 推论        } ,
%<en>    { Corollary   } ,
    { definition  }
%<zh>    { 定义        } ,
%<en>    { Definition  } ,
    { example     }
%<zh>    { 例          } ,
%<en>    { Example     } ,
    { exercise    }
%<zh>    { 练习        } ,
%<en>    { Exercise    } ,
    { lemma       }
%<zh>    { 引理        } ,
%<en>    { Lemma       } ,
    { problem     }
%<zh>    { 问题        } ,
%<en>    { Problem     } ,
    { proposition }
%<zh>    { 命题        } ,
%<en>    { Proposition } ,
    { remark      }
%<zh>    { 注          } ,
%<en>    { Remark      } ,
    { solution    }
%<zh>    { 解          } ,
%<en>    { Solution    } ,
    { theorem     }
%<zh>    { 定理        } ,
%<en>    { Theorem     } ,
  }
  { \@@_define_name_g:nn #1 }
%    \end{macrocode}
%
%    \begin{macrocode}
%</lang>
%    \end{macrocode}
%
% \end{implementation}
%
% \Finale
%
\endinput
